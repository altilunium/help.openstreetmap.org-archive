<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/19925/overpass-get-relation-and-node-in-one-query-for-city">Overpass: Get relation and node in one query for city?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/19925/up/" id="post-19925-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-19925-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/19925/down/" id="post-19925-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/19925/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello,</p>
<p>I use the Overpass-API to get cities from some area. As an example I use this simple query:</p>
<pre><code>node
["place"~"village|city|town|metropolis"]
["name"~"^A"]
(area:3602145268);
out body;
</code></pre>
<p>So I get a lot of villages/cities/towns/metropolises which starts with "A" which is fine so far.</p>
<p>What I need now are - besides the information the query above delivers in the node - all relation-ids to that found cities. How can it be done? Can the query above be modified to deliever all relation-ids as well? It would avoid sending a query for every city I got.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-overpass" href="/tags/overpass/" rel="tag" title="see questions tagged 'overpass'">overpass</a>
<a class="post-tag tag-link-nodes" href="/tags/nodes/" rel="tag" title="see questions tagged 'nodes'">nodes</a>
<a class="post-tag tag-link-relations" href="/tags/relations/" rel="tag" title="see questions tagged 'relations'">relations</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>14 Feb '13, 12:49</strong>
</p>
<img alt="wuschba's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/12f399704c1d69150128133157881125?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/5576/wuschba">wuschba</a><br/>
<span class="score" title="41 reputation points">41</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="wuschba has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/19925/">
                edited
                <strong>14 Feb '13, 12:49</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-19925">
</div>
<div class="comment-tools" id="comment-tools-19925">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-19925-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/19925/overpass-get-relation-and-node-in-one-query-for-city?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/19925/overpass-get-relation-and-node-in-one-query-for-city?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/19925/overpass-get-relation-and-node-in-one-query-for-city?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/19925/overpass-get-relation-and-node-in-one-query-for-city?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="19943"></a>
<div class="answer accepted-answer" id="answer-container-19943">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/19943/up/" id="post-19943-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-19943-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/19943/down/" id="post-19943-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/19943/" rel="nofollow" title="wuschba has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>In principle, it is possible to get with <a href="http://overpass-turbo.eu/?Q=area(3602145268)%3B%0Arel%0A%20%20%5Badmin_level~%226%7C7%7C8%22%5D%0A%20%20(area)%3B%0Aout%20ids%3B%0A&amp;C=50.84858;7.10726;16">this request</a> all city boundaries in bavaria.</p>
<p>In detail, there are two things to consider: First, it also returns cities that have a common boundary with bavaria, although they are actually outside bavaria. This is a side effect of the query semantics I have not thought about: Ways are considered inside an area if they are completely on the border (which makes sense), and relations are considered inside if one or more of its elements are inside (which also makes sense on its own), but both together is a little bit odd.</p>
<p>Second, there is no connection between the place nodes and the boundary relations. In some cases, they may be contained as members in the boundary relations, but not always.</p>
<p>edit:</p>
<p>Ahh, now I understand your question better. <a href="http://overpass-turbo.eu/?Q=%5Btimeout%3A900%5D%3B%0Aarea%5Bname%3D%22Bayern%22%5D%3B%0Anode(area)%5Bplace~%22%5E(town%7Ccity)%24%22%5D%5Bname~%22%5EA%22%5D%3B%0Aforeach(%0A%20%20out%3B%0A%20%20is_in%3B%0A%20%20area._%5Badmin_level~%226%7C8%22%5D%5B%22de%3Aplace%22!%3D%22county%22%5D%3B%0A%20%20out%3B%0A)%3B%0A&amp;C=48.77067;11.02478;8">This query</a> finds all place nodes (I added those of type town to cover more places) and for each the area it belongs to. To simplify testing, I have restricted these again to "A..". Feel free to remove that condition, but the query then runs for several minutes.</p>
<p>You can in principle deduce the relation ids from the area ids: just substract 3.6 billion. However, if you want to query for postcodes and so on afterwards, it is likely that you anyway still need the area and not the relation. I've written about the issue in <a href="http://forum.openstreetmap.org/viewtopic.php?id=20090">this forum thread</a>.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/19943/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>15 Feb '13, 08:53</strong>
</p>
<img alt="Roland%20Olbricht's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/fcfdb0825826fd13d2ff0d83d58819c6?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3480/roland-olbricht">Roland Olbricht</a><br/>
<span class="score" title="6666 reputation points"><span class="">6.7k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="64 badges"><span class="silver">●</span><span class="badgecount">64</span></span><span title="89 badges"><span class="bronze">●</span><span class="badgecount">89</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Roland Olbricht has 40 accepted answers">36%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/19943/">
                edited
                <strong>15 Feb '13, 18:45</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-19943">
<a name="19961"></a>
<div class="comment" id="comment-19961">
<div class="comment-score" id="post-19961-score">1</div>
<div class="comment-text"><p>Thanks for your reply. When looking at:</p>
<p><a href="http://nominatim.openstreetmap.org/details.php?place_id=97345357">http://nominatim.openstreetmap.org/details.php?place_id=97345357</a></p>
<p>or</p>
<p><a href="http://nominatim.openstreetmap.org/details.php?place_id=3676853724">http://nominatim.openstreetmap.org/details.php?place_id=3676853724</a>
it seems I always get somewhere an "relation" for a city:</p>
<p>Munich: 62428</p>
<p>Ingolstadt: 62381</p>
<p>I need that to query all postcodes or streets for example via overpass to be used in the area-part of the request.</p>
<p>So I have nodes (cities) and need the relations like shown in nominatim - how would you do that with overpass?</p></div>
<div class="comment-info" id="comment-19961-info">
<span class="comment-age">(15 Feb '13, 14:45)</span>
<a class="comment-user userinfo" href="/users/5576/wuschba">wuschba</a>
</div>
</div>
<a name="19963"></a>
<div class="comment" id="comment-19963">
<div class="comment-score" id="post-19963-score"></div>
<div class="comment-text"><p>Hello wuschba,
your aims seem to be a bit more than an FAQ for this site .. come to forum.openstreetmap.org, there is even a very active German sub forum if my assumption is right and you are from there.</p>
<p>If you get a solution for your aims, you can add it as an overpassAPI example in the collection in the OSM wiki, so others can benefit, too.</p></div>
<div class="comment-info" id="comment-19963-info">
<span class="comment-age">(15 Feb '13, 15:31)</span>
<a class="comment-user userinfo" href="/users/99/stephan75">stephan75</a>
</div>
</div>
<a name="19969"></a>
<div class="comment" id="comment-19969">
<div class="comment-score" id="post-19969-score"></div>
<div class="comment-text"><p>Hi Stephan, thanks for your reply. So you suggest discussing this in "users:Germany" on forum.openstreetmal.org?! Or is it more something for "Developers"?</p></div>
<div class="comment-info" id="comment-19969-info">
<span class="comment-age">(15 Feb '13, 17:01)</span>
<a class="comment-user userinfo" href="/users/5576/wuschba">wuschba</a>
</div>
</div>
<a name="19971"></a>
<div class="comment" id="comment-19971">
<div class="comment-score" id="post-19971-score"></div>
<div class="comment-text"><p>I suggest "users:Germany".</p></div>
<div class="comment-info" id="comment-19971-info">
<span class="comment-age">(15 Feb '13, 18:31)</span>
<a class="comment-user userinfo" href="/users/3480/roland-olbricht">Roland Olbricht</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-19943">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-19943-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/19925/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="4LzMC2AJzVOghONDxbq9plh6XzQof43k"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>