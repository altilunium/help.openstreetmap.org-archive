<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/73414/russian-states-are-missing-in-the-whole-asia-map">Russian states are missing in the whole asia map</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/73414/up/" id="post-73414-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-73414-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/73414/down/" id="post-73414-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/73414/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Can someone give any suggestion how can I append missing states (everything left of Moscow, including Moscow) to the russian map in the whole asian file?
I tried </p>
<pre><code>osmium merge ./asia-latest.osm.pbf ./northwestern-fed-district-latest.osm.pbf ./central-fed-district-latest.osm.pbf -o merged.pbf
</code></pre>
<p>and it crashed when porting nodes to the database:
    Processing: Node(1255048k 1457.7k/s) Way(156069k 11.50k/s) Relation(0 0.00/s)result COPY END for planet_osm_ways failed: ERROR: duplicate key value violates unique constraint "planet_osm_ways_pkey" DETAIL: Key (id)=(23535867) already exists. CONTEXT: COPY planet_osm_ways, line 119375 DB copy thread failed: Ending COPY mode</p>
<p>Then I tried converting all files to "o5m" extension and run:</p>
<pre><code>osmconvert centr.o5m sev_zapad.o5m asia.o5m -o=merge_again.osm.pbf
</code></pre>
<p>Now it all just turned out to give me the same asia map with no tiles added.</p>
<p>Update:</p>
<p>it turned out that when I manually zoomed closer, some mssing tiles were served, but at lower (0-6) zooms I still get empty tiles.
Another thing:
after I cleared "/var/lib/mod_tile" folder of rendered tiles and tried to draw the map,
there didn't seem to be any rendering done, linke there is another place where already rendered tiles are stored. Is it possible that Mapnik keeps some separate cache for it tiles? How can I clear it?</p>
<p>And another problem, after I run:</p>
<pre><code>render_list -a -Z 10 -n 5 --socket=/var/run/renderd/renderd.sock -m ajt -f
</code></pre>
<p>the systems starts doing something very hard (all 5 cores are loaded at 100%) but new maps in "/var/lib/mod_tile" appear at a very slow rate. I have already run this command with the previous map and it took less then a couple seconds to render 0-8 zoom levels, and now it took about 10 minutes and the processor was left covered in sweat. Why is that?</p>
<p>Another update:</p>
<p>Actually the command </p>
<pre><code>osmconvert centr.o5m sev_zapad.o5m asia.o5m -o=merge_again.osm.pbf
</code></pre>
<p>worked ok. It was just that I had to use -f with a render_list to rerender all prevous blank tiles so they get updated with new data.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-osmium" href="/tags/osmium/" rel="tag" title="see questions tagged 'osmium'">osmium</a>
<a class="post-tag tag-link-merge" href="/tags/merge/" rel="tag" title="see questions tagged 'merge'">merge</a>
<a class="post-tag tag-link-osmconvert" href="/tags/osmconvert/" rel="tag" title="see questions tagged 'osmconvert'">osmconvert</a>
<a class="post-tag tag-link-asia" href="/tags/asia/" rel="tag" title="see questions tagged 'asia'">asia</a>
<a class="post-tag tag-link-map" href="/tags/map/" rel="tag" title="see questions tagged 'map'">map</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>06 Mar '20, 08:36</strong>
</p>
<img alt="kartman1's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/7d9dea8db6c9981b45d28f28bb29f49d?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/17942/kartman1">kartman1</a><br/>
<span class="score" title="38 reputation points">38</span><span title="6 badges"><span class="badge1">●</span><span class="badgecount">6</span></span><span title="7 badges"><span class="silver">●</span><span class="badgecount">7</span></span><span title="11 badges"><span class="bronze">●</span><span class="badgecount">11</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="kartman1 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/73414/">
                reverted
                <strong>06 Mar '20, 12:23</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-73414">
</div>
<div class="comment-tools" id="comment-tools-73414">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-73414-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/73414/russian-states-are-missing-in-the-whole-asia-map?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/73414/russian-states-are-missing-in-the-whole-asia-map?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/73414/russian-states-are-missing-in-the-whole-asia-map?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/73414/russian-states-are-missing-in-the-whole-asia-map?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="73418"></a>
<div class="answer accepted-answer" id="answer-container-73418">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/73418/up/" id="post-73418-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-73418-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/73418/down/" id="post-73418-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/73418/" rel="nofollow" title="kartman1 has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p><code>osmium merge</code> is supposed to handle duplicates but there may be corner cases where this will fail, especially if you are using files that were not downloaded at the same time.</p>
<p>What I would suggest that you do is, rather than using an Asia extract and trying to add pieces to it, create your own extract from the planet file:</p>
<ol>
<li>download <code>planet-latest.osm.pbf</code></li>
<li>create an extract with <code>osmium extract</code></li>
<li>feed that into <code>osm2pgsql</code></li>
</ol>
<p>The extract creation is documented on <a href="https://docs.osmcode.org/osmium/latest/osmium-extract.html">https://docs.osmcode.org/osmium/latest/osmium-extract.html</a> - basically if you can work with a rectangular area you would call</p>
<pre><code>osmium extract --bbox 24.52,7.64,172.88,77.15 -s smart planet-latest.osm.pbf -o myfile.osm.pbf
</code></pre>
<p>and if you'd rather cut out a polygon you would have to define a simple outline first e.g. using QGIS (save as GeoJSON) or JOSM (save as poly file), then use the <code>--polygon</code> flag instead of <code>--bbox</code>.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/73418/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>06 Mar '20, 09:28</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/73418/">
                edited
                <strong>06 Mar '20, 10:42</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-73418">
<a name="73422"></a>
<div class="comment" id="comment-73422">
<div class="comment-score" id="post-73422-score"></div>
<div class="comment-text"><p>Thanks. I'll mark it as an answer though I didn't try it, because the command from the question actually worked.</p></div>
<div class="comment-info" id="comment-73422-info">
<span class="comment-age">(06 Mar '20, 12:21)</span>
<a class="comment-user userinfo" href="/users/17942/kartman1">kartman1</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-73418">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-73418-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/73414/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="vOktWAjeGRaMgpioCl5RYkZj7PUOnNRO"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>