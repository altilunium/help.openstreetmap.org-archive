<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/52242/needleleaved-inner-forest-polygon-not-rendered-rendering-or-modelling-problem">Needleleaved inner forest polygon not rendered: rendering or modelling problem?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/52242/up/" id="post-52242-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-52242-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/52242/down/" id="post-52242-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/52242/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello, there.</p>
<p>I modeled <a href="https://www.openstreetmap.org/#map=18/48.24100/6.17774" title="Problem map">here</a> a <a href="https://www.openstreetmap.org/way/444365950" title="inner parcel">needle-leaved forest parcel</a> in a bigger broad-leaved forest as an inner multipolygon, but this inner parcel is not rendered, as if there was nothing here, a big hole, full of nothing, in the middle of the forest. I'm wondering: did I messed up the modelling, or is the area misrendered?</p>
<p>Awaiting your answers,</p>
<p>Regards.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-rendering" href="/tags/rendering/" rel="tag" title="see questions tagged 'rendering'">rendering</a>
<a class="post-tag tag-link-forest" href="/tags/forest/" rel="tag" title="see questions tagged 'forest'">forest</a>
<a class="post-tag tag-link-multipolygon" href="/tags/multipolygon/" rel="tag" title="see questions tagged 'multipolygon'">multipolygon</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>27 Sep '16, 08:58</strong>
</p>
<img alt="Penegal's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/03b6014ac927da400a55374bbbe5152a?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/11353/penegal">Penegal</a><br/>
<span class="score" title="631 reputation points">631</span><span title="31 badges"><span class="badge1">●</span><span class="badgecount">31</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="47 badges"><span class="bronze">●</span><span class="badgecount">47</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Penegal has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-52242">
<a name="62920"></a>
<div class="comment" id="comment-62920">
<div class="comment-score" id="post-62920-score"></div>
<div class="comment-text"><p>This issue has been fixed, and such inner polygons are now rendered correctly.</p></div>
<div class="comment-info" id="comment-62920-info">
<span class="comment-age">(05 Apr '18, 18:55)</span>
<a class="comment-user userinfo" href="/users/11353/penegal">Penegal</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-52242">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-52242-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/52242/needleleaved-inner-forest-polygon-not-rendered-rendering-or-modelling-problem?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/52242/needleleaved-inner-forest-polygon-not-rendered-rendering-or-modelling-problem?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/52242/needleleaved-inner-forest-polygon-not-rendered-rendering-or-modelling-problem?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/52242/needleleaved-inner-forest-polygon-not-rendered-rendering-or-modelling-problem?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="52371"></a>
<div class="answer" id="answer-container-52371">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/52371/up/" id="post-52371-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-52371-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/52371/down/" id="post-52371-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Hard to believe but: "Not a bug, it's a feature"<br/>
Assume that also means, it's not going to be "fixed" anytime soon.<br/>
At least there are workarounds possible, more or less complicated.</p>
<p>As I've learned only recently too, after years of struggling and wasting endless time with this and other "mysterious forest bugs", those empty forest-in-forest inners are not a bug at all. This behavior is fully intentional! </p>
<p>The reason is that otherwise the old legacy style to create multipolygons would not work anymore. Way back when MPs were first invented, things worked completely different: the forest tag HAD to be given on all outers AND all inners too, not in the relation itself. Therefore it was decided, when the "new" method was introduced years later, that if inners contain the same tags as the relation itself, renderers SHALL keep ignoring such "duplicate" tags on inners. To keep compatibility with that legacy method.<br/>
And of course that creates all sorts of rendering probs now, especially when people mix up old and new styles in the same relation (like tagging outer ways directly instead of tagging the relation)</p>
<p>Can't remember anymore where exactly this was explained by one of the osm history experts... Have read it on some discussion page, perhaps in a forum or the Talk mailing list. And the wiki contains a giant quotes collection of multipolygon discussions, some 30 pages filled with MP discussions going back some 10 years! Perhaps it was in that huge heap somewhere:<br/>
<a href="http://wiki.openstreetmap.org/wiki/Talk:Relation:multipolygon">http://wiki.openstreetmap.org/wiki/Talk:Relation:multipolygon</a></p>
<p>The recommanded workaround for this non-bug with different leaftypes was to either <br/>
- create a new MP relation for each forest-in-forest inner, just 1 member, and move the forest tag from the way into the new relation<br/>
- or else to create duplicate ways for such inners: way-1 to stamp the hole into the big forest, and way-2 (NOT in any relation) to fill that hole with the smaller forest again. This also seems to be what those Corine-landcover monsters do.</p>
<p>The prob is, hardly anyone is aware of that issue, myself included until only recently, and therefore have occasionally "fixed" such "nonsense 1-member-relations" or "nonsense duplicate ways" :-(</p>
<p>Anyway, the example in the first post above contains 2 mini-forest inners.<br/>
Have fixed the 2nd by using the first method, and left the first as is for comparison.</p>
<p>PS: of course this affects not only forests but all sorts of MULTIPOLYGONs, incl. meadows, water etc. </p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/52371/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>04 Oct '16, 21:48</strong>
</p>
<img alt="wycbtma's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/1d0a9b10a28fd4ae36b38b5fbcc534d2?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/12848/wycbtma">wycbtma</a><br>
<span class="score" title="116 reputation points">116</span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="wycbtma has one accepted answer">33%</span>
</br></br></p>
</div>
</div>
<div class="comments-container" id="comments-container-52371">
</div>
<div class="comment-tools" id="comment-tools-52371">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-52371-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="52270"></a>
<div class="answer" id="answer-container-52270">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/52270/up/" id="post-52270-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-52270-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/52270/down/" id="post-52270-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I dont expect to see much difference. Forest areas have a minor casing and the rendering does not distinguish between areas with different leaf_type tags (at least in part because this depends on a major refactoring of the osm2pgsql database schema). At best one might expect However I think you would expect to see narrow green lines outlining the parcels.</p>
<p>SomeoneElse has mapped an area of mixed woodland in Nottinghamshire in detail: <a href="http://www.openstreetmap.org/#map=16/53.1443/-1.0733&amp;layers=C">http://www.openstreetmap.org/#map=16/53.1443/-1.0733&amp;layers=C</a>. You can also view the area in Overpass-turbo <a href="http://overpass-turbo.eu/s/iCL">here</a>. This area is a useful testbed for creating a reasonably sized data set for extending the cartography, but perhaps more importantly understanding what is involved in mapping such places. You can make out the thin lines separating the different compartments, which should also be there in your case.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/52270/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>28 Sep '16, 10:26</strong>
</p>
<img alt="SK53's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/06cd84075f1adc2870ad102c7233e661?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/647/sk53">SK53 ♦</a><br>
<span class="score" title="28084 reputation points"><span class="">28.1k</span></span><span title="48 badges"><span class="badge1">●</span><span class="badgecount">48</span></span><span title="268 badges"><span class="silver">●</span><span class="badgecount">268</span></span><span title="433 badges"><span class="bronze">●</span><span class="badgecount">433</span></span><br>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SK53 has 121 accepted answers">22%</span>
</br></br></p>
</div>
</div>
<div class="comments-container" id="comments-container-52270">
<a name="52272"></a>
<div class="comment" id="comment-52272">
<div class="comment-score" id="post-52272-score">2</div>
<div class="comment-text"><p>My vague recollection is that there's a known issue (possibly historical, possibly with osm2pgsql) with a multipolygon inner having the same area tag as an outer which causes the inner tag to "disappear".</p>
<p>If someone can find the same situation (inner forest or wood polygon within an outer) in the UK or Ireland I can investigate further.</p></div>
<div class="comment-info" id="comment-52272-info">
<span class="comment-age">(28 Sep '16, 11:08)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="52276"></a>
<div class="comment" id="comment-52276">
<div class="comment-score" id="post-52276-score">1</div>
<div class="comment-text"><p>For info I've reproduced the issue here, with a "mixed" inner in a "broadleaved" outer:</p>
<p><a href="http://www.openstreetmap.org/#map=19/53.18662/-1.34311">http://www.openstreetmap.org/#map=19/53.18662/-1.34311</a></p>
<p>My own rendering, which treats broadleaved wood as different to mixed wood doesn't show the hole (it renders a mixed area inside a broadleaved area) but OSM-Carto does.</p>
<p>Issues have been raised at <a href="https://github.com/gravitystorm/openstreetmap-carto/issues/973">https://github.com/gravitystorm/openstreetmap-carto/issues/973</a> and <a href="https://github.com/openstreetmap/osm2pgsql/issues/185">https://github.com/openstreetmap/osm2pgsql/issues/185</a> .  That osm2pgsql issue seems to have been closed because it was an "old-style" multipolygon, which isn't the case in my example.  It probably needs raising again at osm2pgsql's github (I can't see a current issue describing it).</p>
<p>A workaround would be to avoid the use of multipolygons where possible (which makes sense from an "ease of mapping" perspective if your dealing with multipolygons that are "most of Thailand" or "most of Quebec") but in a simple example like yours a multipolygon should be a sensible way to map it.</p></div>
<div class="comment-info" id="comment-52276-info">
<span class="comment-age">(28 Sep '16, 13:16)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="52281"></a>
<div class="comment" id="comment-52281">
<div class="comment-score" id="post-52281-score">1</div>
<div class="comment-text"><p>I didn't expect to see a difference either: I knew that different rendering for broad-leaved and needle-leaved wasn't effective because of some database issue, but I mapped it anyway for the day it will be rendered. Besides, I expected the inner polygon to be rendered, even if it is rendered the same way than the outer one; its disappearance is unexpected, and a bug IMO, as the underlying data is, AFAIK, valid, unless one can explain me why the data is malformed, or unoptimized, and why it causes the rendering bug.</p>
<p>I opened an issue on Github for that: <a href="https://github.com/gravitystorm/openstreetmap-carto/issues/2381">https://github.com/gravitystorm/openstreetmap-carto/issues/2381</a></p></div>
<div class="comment-info" id="comment-52281-info">
<span class="comment-age">(28 Sep '16, 15:38)</span>
<a class="comment-user userinfo" href="/users/11353/penegal">Penegal</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-52270">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-52270-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/52242/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="7KvXcRNvCk7Gfx8K67AjJICi4JdmQTxW"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>