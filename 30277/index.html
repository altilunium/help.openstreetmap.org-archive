<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/30277/how-to-export-a-rectangle-from-planetosmpbf-to-pbf">How to export a rectangle from planet.osm.pbf to pbf</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/30277/up/" id="post-30277-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-30277-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/30277/down/" id="post-30277-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/30277/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi! I'm having a goal to be able to use osm data offline, if I travel somewhere - I just get a small rectangle part (a city - about 4 square degrees of latitude/longitude) from a big planet.osm.pbf and load it in some program (for now I came to Maperitive, but not sure if it would work).
I wonder how fast such map would render on an average notebook, how long would it take to export a city from planet file, what should I write in osmosis console and if maybe there are better solutions.</p>
<p>I'm asking about exact code to write, because I've already tried<br/>
    bin\osmosis.bat --read-pbf file=planet-140122.osm.pbf enableDateParsing=no --log-progress interval=30 --bounding-box top=60.5700 left=29.1900 bottom 58.5700 right=31.1900 --write-pbf file=sanktpeterburg.osm.pbf</p>
<p>and got errors. 
Thanks for help in advance.</p>
<pre><code>F:\osmosis&gt;bin\osmosis.bat -v --read-pbf file=planet-140122.osm.pbf enableDatePa
rsing=no --buffer --log-progress interval=30 --bounding-box clipIncompleteEntiti
es=true top=60.5700 left=29.1900 bottom=58.5700 right=31.1900 --write-pbf file=s
anktpeterburg2.osm.pbf
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.Osmosis run
INFO: Osmosis Version 0.43.1
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.TaskRegistrar loadJPFPlug
ins
FINE: Searching for JPF plugins.
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.TaskRegistrar loadJPFPlug
ins
FINE: Registering the core plugin.
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.TaskRegistrar loadJPFPlug
ins
FINE: Registering the extension plugins.
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.Osmosis run
INFO: Preparing pipeline.
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.pipeline.common.Pipeline
prepare
FINE: Building tasks.
 эт 29, 2014 1:12:31 AM org.openstreetmap.osmosis.core.Osmosis main
SEVERE: Execution aborted.
org.openstreetmap.osmosis.core.OsmosisRuntimeException: Argument enableDateParsi
ng for task 1-read-pbf was not recognised.
        at org.openstreetmap.osmosis.core.pipeline.common.TaskManagerFactory.cre
ateTaskManager(TaskManagerFactory.java:64)
        at org.openstreetmap.osmosis.core.pipeline.common.Pipeline.buildTasks(Pi
peline.java:50)
        at org.openstreetmap.osmosis.core.pipeline.common.Pipeline.prepare(Pipel
ine.java:112)
        at org.openstreetmap.osmosis.core.Osmosis.run(Osmosis.java:86)
        at org.openstreetmap.osmosis.core.Osmosis.main(Osmosis.java:37)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
        at java.lang.reflect.Method.invoke(Unknown Source)
        at org.codehaus.plexus.classworlds.launcher.Launcher.launchStandard(Laun
cher.java:329)
        at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.jav
a:239)
        at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(La
uncher.java:409)
        at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:
352)
        at org.codehaus.classworlds.Launcher.main(Launcher.java:47)
</code></pre>
<p>Added:</p>
<pre><code>F:\osmosis&gt;bin\osmosis.bat --read-pbf file=planet-140122.osm.pbf --log-progress
interval=30 --bounding-box clipIncompleteEntities=true top=60.5700 left=29.1900
bottom=58.5700 right=31.1900 --write-pbf file=sanktpeterburg2.osm.pbf
 эт 29, 2014 1:06:08 PM org.openstreetmap.osmosis.core.Osmosis run
INFO: Osmosis Version 0.43.1
 эт 29, 2014 1:06:09 PM org.openstreetmap.osmosis.core.Osmosis run
INFO: Preparing pipeline.
 эт 29, 2014 1:06:09 PM org.openstreetmap.osmosis.core.Osmosis run
INFO: Launching pipeline execution.
 эт 29, 2014 1:06:09 PM org.openstreetmap.osmosis.core.Osmosis run
INFO: Pipeline executing, waiting for completion.
java.util.zip.DataFormatException: incorrect data check
        at java.util.zip.Inflater.inflateBytes(Native Method)
        at java.util.zip.Inflater.inflate(Unknown Source)
        at java.util.zip.Inflater.inflate(Unknown Source)
        at org.openstreetmap.osmosis.osmbinary.file.FileBlockPosition.parseData(
FileBlockPosition.java:57)
        at org.openstreetmap.osmosis.osmbinary.file.FileBlockHead.readContents(F
ileBlockHead.java:95)
        at org.openstreetmap.osmosis.osmbinary.file.FileBlock.process(FileBlock.
java:135)
        at org.openstreetmap.osmosis.osmbinary.file.BlockInputStream.process(Blo
ckInputStream.java:34)
        at crosby.binary.osmosis.OsmosisReader.run(OsmosisReader.java:45)
        at java.lang.Thread.run(Unknown Source)
 эт 29, 2014 1:06:10 PM org.openstreetmap.osmosis.core.pipeline.common.ActiveTas
kManager waitForCompletion
SEVERE: Thread for task 1-read-pbf failed
java.lang.Error: java.util.zip.DataFormatException: incorrect data check
        at org.openstreetmap.osmosis.osmbinary.file.FileBlockPosition.parseData(
FileBlockPosition.java:60)
        at org.openstreetmap.osmosis.osmbinary.file.FileBlockHead.readContents(F
ileBlockHead.java:95)
        at org.openstreetmap.osmosis.osmbinary.file.FileBlock.process(FileBlock.
java:135)
        at org.openstreetmap.osmosis.osmbinary.file.BlockInputStream.process(Blo
ckInputStream.java:34)
        at crosby.binary.osmosis.OsmosisReader.run(OsmosisReader.java:45)
        at java.lang.Thread.run(Unknown Source)
Caused by: java.util.zip.DataFormatException: incorrect data check
        at java.util.zip.Inflater.inflateBytes(Native Method)
        at java.util.zip.Inflater.inflate(Unknown Source)
        at java.util.zip.Inflater.inflate(Unknown Source)
        at org.openstreetmap.osmosis.osmbinary.file.FileBlockPosition.parseData(
FileBlockPosition.java:57)
        ... 5 more

 эт 29, 2014 1:06:10 PM org.openstreetmap.osmosis.core.Osmosis main
SEVERE: Execution aborted.
org.openstreetmap.osmosis.core.OsmosisRuntimeException: One or more tasks failed
.
        at org.openstreetmap.osmosis.core.pipeline.common.Pipeline.waitForComple
tion(Pipeline.java:146)
        at org.openstreetmap.osmosis.core.Osmosis.run(Osmosis.java:92)
        at org.openstreetmap.osmosis.core.Osmosis.main(Osmosis.java:37)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
        at java.lang.reflect.Method.invoke(Unknown Source)
        at org.codehaus.plexus.classworlds.launcher.Launcher.launchStandard(Laun
cher.java:329)
        at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.jav
a:239)
        at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(La
uncher.java:409)
        at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:
352)
        at org.codehaus.classworlds.Launcher.main(Launcher.java:47)
</code></pre>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-export" href="/tags/export/" rel="tag" title="see questions tagged 'export'">export</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>28 Jan '14, 19:45</strong>
</p>
<img alt="kuzma1's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/5fc3bac4d90cde97ca55f8bcb5536bb2?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/8241/kuzma1">kuzma1</a><br>
<span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="kuzma1 has no accepted answers">0%</span>
</br></p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/30277/">
                edited
                <strong>29 Jan '14, 10:57</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-30277">
<a name="30278"></a>
<div class="comment" id="comment-30278">
<div class="comment-score" id="post-30278-score"></div>
<div class="comment-text"><p>I might be tempted to start with an extract of <a href="http://download.geofabrik.de/europe/russia-european-part.html">the European part of Russia</a> rather than the whole planet.</p></div>
<div class="comment-info" id="comment-30278-info">
<span class="comment-age">(28 Jan '14, 20:02)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="30279"></a>
<div class="comment" id="comment-30279">
<div class="comment-score" id="post-30279-score"></div>
<div class="comment-text"><p>Also, what version of Osmosis are you running (i.e. how old is it) and what errors do you actually get?</p></div>
<div class="comment-info" id="comment-30279-info">
<span class="comment-age">(28 Jan '14, 20:04)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="30280"></a>
<div class="comment" id="comment-30280">
<div class="comment-score" id="post-30280-score"></div>
<div class="comment-text"><p>How can I make such exports myself from a planet.pbf? Can you just provide me with WORKING code? I'm using the latest versions of all programs.</p></div>
<div class="comment-info" id="comment-30280-info">
<span class="comment-age">(28 Jan '14, 20:23)</span>
<a class="comment-user userinfo" href="/users/8241/kuzma1">kuzma1</a>
</div>
</div>
<a name="30281"></a>
<div class="comment" id="comment-30281">
<div class="comment-score" id="post-30281-score">2</div>
<div class="comment-text"><p>The last time I ran osmosis I did:</p>
<pre><code>osmosis  --read-pbf great-britain-latest.osm.pbf  --bounding-box top=54.623 left=-4.807 bottom=51.737 right=0.906 --write-pbf cut.pbf
</code></pre>
<p>and it produced just what I wanted.  That was on Linux rather than Windows, but should be otherwise the same.  I notice that your example has "bottom 58.5700" - did you really miss the "=" sign out?</p></div>
<div class="comment-info" id="comment-30281-info">
<span class="comment-age">(28 Jan '14, 20:42)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-30277">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-30277-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/30277/how-to-export-a-rectangle-from-planetosmpbf-to-pbf?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/30277/how-to-export-a-rectangle-from-planetosmpbf-to-pbf?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/30277/how-to-export-a-rectangle-from-planetosmpbf-to-pbf?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/30277/how-to-export-a-rectangle-from-planetosmpbf-to-pbf?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="30295"></a>
<div class="answer accepted-answer" id="answer-container-30295">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/30295/up/" id="post-30295-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-30295-score" title="current number of votes">
    3
</div>
<a class="ajax-command post-vote down" href="/vote/30295/down/" id="post-30295-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/30295/" rel="nofollow" title="kuzma1 has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The error</p>
<pre><code>java.util.zip.DataFormatException: incorrect data check
</code></pre>
<p>suggests that there's a problem with the pbf file that you're trying to read.  If you run md5sum on it (you'll need to download a version of that for Windows) does it match the values in the .md5 file on <a href="http://planet.openstreetmap.org/pbf/">http://planet.openstreetmap.org/pbf/</a> ?</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/30295/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>29 Jan '14, 11:05</strong>
</p>
<img alt="SomeoneElse's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0bf1aa22f7f5e045b0eb8beb79fe7907?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/387/someoneelse">SomeoneElse ♦</a><br/>
<span class="score" title="36866 reputation points"><span class="">36.9k</span></span><span title="71 badges"><span class="badge1">●</span><span class="badgecount">71</span></span><span title="370 badges"><span class="silver">●</span><span class="badgecount">370</span></span><span title="866 badges"><span class="bronze">●</span><span class="badgecount">866</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SomeoneElse has 228 accepted answers">16%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-30295">
<a name="30298"></a>
<div class="comment" id="comment-30298">
<div class="comment-score" id="post-30298-score">1</div>
<div class="comment-text"><p>Yeah, that was a problem. Now it executes, quite slow (the file sanktpetersburg2.osm.pbf grows about 100kbytes in minute - in console it tells ~95000 objects per second). Is it normal for 4gb ram on ultrabook? I already changed xmx in java settings to three quarters of my ram.</p></div>
<div class="comment-info" id="comment-30298-info">
<span class="comment-age">(29 Jan '14, 13:26)</span>
<a class="comment-user userinfo" href="/users/8241/kuzma1">kuzma1</a>
</div>
</div>
<a name="30301"></a>
<div class="comment" id="comment-30301">
<div class="comment-score" id="post-30301-score"></div>
<div class="comment-text"><p>Alright, it's nice, it took a little more than an hour. Map renders quite slow, guess it would be better to use other map formats, but I guess my question resolved, how can I accept an answer?</p></div>
<div class="comment-info" id="comment-30301-info">
<span class="comment-age">(29 Jan '14, 15:56)</span>
<a class="comment-user userinfo" href="/users/8241/kuzma1">kuzma1</a>
</div>
</div>
<a name="30302"></a>
<div class="comment" id="comment-30302">
<div class="comment-score" id="post-30302-score"></div>
<div class="comment-text"><p>I've changed the "comment" suggesting that there might be a problem with the data to an "answer" - you should be able to accept that now.</p></div>
<div class="comment-info" id="comment-30302-info">
<span class="comment-age">(29 Jan '14, 16:00)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="30307"></a>
<div class="comment" id="comment-30307">
<div class="comment-score" id="post-30307-score"></div>
<div class="comment-text"><p>Thanks for help</p></div>
<div class="comment-info" id="comment-30307-info">
<span class="comment-age">(29 Jan '14, 17:03)</span>
<a class="comment-user userinfo" href="/users/8241/kuzma1">kuzma1</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-30295">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-30295-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/30277/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="f7xXaho4YWU9plcN5x8YErM8vhFzEjiu"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>