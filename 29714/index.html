<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/29714/how-can-i-generate-npi-file-from-database-nominatim">How can I generate npi file from database "Nominatim"?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/29714/up/" id="post-29714-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-29714-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/29714/down/" id="post-29714-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/29714/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I want to delete some data from database "Nominatim". </p>
<ul>
<li>One way is to generate nominatim pre-indexed file from database "Nominatim". </li>
<li>Next, remove some data from this file. </li>
<li>After all, create new database from this npi file.</li>
</ul>
<p>The problem is that npi service is being deprecated <a href="http://open.mapquestapi.com/npi/">http://open.mapquestapi.com/npi/</a></p>
<p>How can I generate npi file from database "Nominatim"?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-npi" href="/tags/npi/" rel="tag" title="see questions tagged 'npi'">npi</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>09 Jan '14, 12:20</strong>
</p>
<img alt="amshegar's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/aea8cdb05518a630ebad09bd7c777dc3?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/8014/amshegar">amshegar</a><br/>
<span class="score" title="46 reputation points">46</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="amshegar has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-29714">
</div>
<div class="comment-tools" id="comment-tools-29714">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-29714-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/29714/how-can-i-generate-npi-file-from-database-nominatim?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/29714/how-can-i-generate-npi-file-from-database-nominatim?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/29714/how-can-i-generate-npi-file-from-database-nominatim?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/29714/how-can-i-generate-npi-file-from-database-nominatim?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="29718"></a>
<div class="answer" id="answer-container-29718">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/29718/up/" id="post-29718-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-29718-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/29718/down/" id="post-29718-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The NPI format is no longer supported. The code that still exists is not maintained and might be changed or removed at some point in the future.</p>
<p>If you want to filter data from the database you should filter your OSM file before importing it into Nominatim.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/29718/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>09 Jan '14, 14:37</strong>
</p>
<img alt="lonvia's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d888b712d85dee0aa304297f2dc697c7?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2921/lonvia">lonvia</a><br/>
<span class="score" title="6213 reputation points"><span class="">6.2k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="89 badges"><span class="bronze">●</span><span class="badgecount">89</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="lonvia has 43 accepted answers">40%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-29718">
</div>
<div class="comment-tools" id="comment-tools-29718">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-29718-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="29716"></a>
<div class="answer" id="answer-container-29716">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/29716/up/" id="post-29716-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-29716-score" title="current number of votes">
    -2
</div>
<a class="ajax-command post-vote down" href="/vote/29716/down/" id="post-29716-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Hi, did you followed III's suggestions ? 'There is currently no DB schema description of Nominatim available: <a href="http://wiki.openstreetmap.org/wiki/Category:Nominatim">http://wiki.openstreetmap.org/wiki/Category:Nominatim</a>
So you might ask at the OSM-TALK or OSM-DEV mailinglist or in wiki at the Nominatim disc. A documentation at the wiki would be nice for the community :)
Maybe it's easier to export your dump to preprocessed nomiatim NPI files and filter this files before reimporting to get a light DB?'
And the result ? Since your asking it here again ?</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/29716/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>09 Jan '14, 13:19</strong>
</p>
<img alt="Hendrikklaas's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/742e93034cd38ad243f7ab26f350b659?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3443/hendrikklaas">Hendrikklaas</a><br/>
<span class="score" title="9286 reputation points"><span class="">9.3k</span></span><span title="207 badges"><span class="badge1">●</span><span class="badgecount">207</span></span><span title="238 badges"><span class="silver">●</span><span class="badgecount">238</span></span><span title="387 badges"><span class="bronze">●</span><span class="badgecount">387</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Hendrikklaas has 39 accepted answers">5%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-29716">
<a name="29742"></a>
<div class="comment" id="comment-29742">
<div class="comment-score" id="post-29742-score"></div>
<div class="comment-text"><blockquote>
<p>Hi, did you followed III's suggestions...</p>
</blockquote>
<p>Hello. No. This is a task from my work. Before this day I had other tasks and goals, but today all tasks were done. This is the last task: I must significantly improve the speed of geocoding (for example, ** requests per second)</p>
<p>I'm not a very good specialist in the geocoding or database design. But in our company there are no  other specialists. So I ask this question on the forum. </p>
<p>So,
 1) extract planet-latest.osm from planet-latest.osm.pbf or  planet-latest.osm.bz2 
 2) write scripts for removing some data from planet-latest.osm
 3) make planet-latest.osm.bz2 from planet-latest.osm using winRAR</p>
<ul>
<li>
<p>Is it a good idea?</p>
</li>
<li>
<p>Can I use OsmSharp for parsing data? <a href="http://www.osmsharp.com/wiki/data-processing">http://www.osmsharp.com/wiki/data-processing</a></p>
</li>
</ul></div>
<div class="comment-info" id="comment-29742-info">
<span class="comment-age">(10 Jan '14, 06:48)</span>
<a class="comment-user userinfo" href="/users/8014/amshegar">amshegar</a>
</div>
</div>
<a name="29747"></a>
<div class="comment" id="comment-29747">
<div class="comment-score" id="post-29747-score">1</div>
<div class="comment-text"><p>We usually use Osmosis to process .PBF or .OSM files, so it's the most reliable tool. You might also <a href="http://wiki.openstreetmap.org/wiki/OSM_file_formats#Map-data">try others</a>.<br/>
AFAIK you can use osmosis without needing to extract the full planet (saves disk space and increases speed).<br/>
Yes, sounds like a plan :) But I suggest to start playing with filtering with smaller extracts, so you save time and get a better feeling about the results and see possible problems fast enough. Your home area is always a good idea.</p></div>
<div class="comment-info" id="comment-29747-info">
<span class="comment-age">(10 Jan '14, 17:51)</span>
<a class="comment-user userinfo" href="/users/4984/iii">iii</a>
</div>
</div>
<a name="29749"></a>
<div class="comment" id="comment-29749">
<div class="comment-score" id="post-29749-score">2</div>
<div class="comment-text"><p>To be honest it sounds as if you are very much out of your depth, and anything you try will be fishing in muddy waters. Are you even sure that removing some data will speed things up? Have you tuned your PostGIS database as recommended? Is your database on an SSD, and does the machine have enough RAM? -- We have programs that can filter OSM data, like osmosis or osmfilter, there's no need to write your own. You could even run the import normally and <em>then</em> remove data from PostGIS by issuing DELETE statements for what you don't need. But as I said, it's not even sure that this will help.</p></div>
<div class="comment-info" id="comment-29749-info">
<span class="comment-age">(11 Jan '14, 00:15)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
<a name="29794"></a>
<div class="comment" id="comment-29794">
<div class="comment-score" id="post-29794-score"></div>
<div class="comment-text"><p>I already tuned all software (I read official documentation on each program). The database is on an SSD. The hardware is good.</p>
<p>I think I finish this task successfully if I significantly reduce the size of database  "nominatim" (in this case I also save some SSD). For example, I want to delete all data, which level is less than 17. <a href="http://wiki.openstreetmap.org/wiki/Nominatim/Development_overview#Indexing_.2F_Address_Calculation">http://wiki.openstreetmap.org/wiki/Nominatim/Development_overview#Indexing_.2F_Address_Calculation</a></p>
<p>Does such command in osmosis exist?</p></div>
<div class="comment-info" id="comment-29794-info">
<span class="comment-age">(13 Jan '14, 11:44)</span>
<a class="comment-user userinfo" href="/users/8014/amshegar">amshegar</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-29716">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-29716-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/29714/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="SBUPPbuGtNM204Q9SXLXRMFWeG54rwFC"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>