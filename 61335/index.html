<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/61335/how-to-submit-a-complex-query-on-overpass-turbo">How to submit a complex query on Overpass-Turbo?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/61335/up/" id="post-61335-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-61335-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/61335/down/" id="post-61335-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/61335/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I'm trying to submitting a query on <a href="http://overpass-turbo.eu/s/tYr">Overpass-Turbo</a> site that seems to be complex.
I would like to get some historical data so I'm using <code>date</code> property.</p>
<p>The problem is I always get the following error:</p>
<p><strong>An error occured during the execution of the overpass query! This is what overpass API returned:
runtime error: Query run out of memory using about 2048 MB of RAM.</strong></p>
<p>I even tried to add <code>maxsize</code> property, according to <a href="https://github.com/drolbr/Overpass-API/issues/319">this issue</a>, but It didn't work.</p>
<p>Someone on IRC tells me that I should use <a href="http://download.geofabrik.de/">offline data</a> to make my query, but I cannot figure out how can I use it.</p>
<p>I would like to see how many italian hotels are on OSM every month since 2010 and how they grew, so I can make some statistics about them.
How can I reach that purpose with OSM data?</p>
<p>Thank you.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-date" href="/tags/date/" rel="tag" title="see questions tagged 'date'">date</a>
<a class="post-tag tag-link-statistics" href="/tags/statistics/" rel="tag" title="see questions tagged 'statistics'">statistics</a>
<a class="post-tag tag-link-overpass-turbo" href="/tags/overpass-turbo/" rel="tag" title="see questions tagged 'overpass-turbo'">overpass-turbo</a>
<a class="post-tag tag-link-historical" href="/tags/historical/" rel="tag" title="see questions tagged 'historical'">historical</a>
<a class="post-tag tag-link-history" href="/tags/history/" rel="tag" title="see questions tagged 'history'">history</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>23 Dec '17, 18:12</strong>
</p>
<img alt="Andreanovenove's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/50334ab2e351e4f5af1917f7f6ef8dc8?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/9763/andreanovenove">Andreanovenove</a><br/>
<span class="score" title="126 reputation points">126</span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="11 badges"><span class="silver">●</span><span class="badgecount">11</span></span><span title="18 badges"><span class="bronze">●</span><span class="badgecount">18</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Andreanovenove has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/61335/">
                edited
                <strong>23 Dec '17, 18:12</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-61335">
</div>
<div class="comment-tools" id="comment-tools-61335">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-61335-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/61335/how-to-submit-a-complex-query-on-overpass-turbo?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/61335/how-to-submit-a-complex-query-on-overpass-turbo?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/61335/how-to-submit-a-complex-query-on-overpass-turbo?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/61335/how-to-submit-a-complex-query-on-overpass-turbo?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="61338"></a>
<div class="answer accepted-answer" id="answer-container-61338">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/61338/up/" id="post-61338-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-61338-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/61338/down/" id="post-61338-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/61338/" rel="nofollow" title="Andreanovenove has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I've tried the following query with no problem:</p>
<pre><code>[timeout:250];
(
  node(area:3600365331)(newer:"2017-12-01T00:00:00Z")["tourism"="hotel"];
  way(area:3600365331)(newer:"2017-12-01T00:00:00Z")["tourism"="hotel"];
  relation(area:3600365331)(newer:"2017-12-01T00:00:00Z")["tourism"="hotel"];  
);
out meta;
</code></pre>
<p>It gives you all nodes, ways and relations tagged as tourism=hotel inside Italy created from the beginning of December 2017. As for now, they are 106 nodes, 53 ways and 1 relation, so 160 new hotels in Italy since 1st December 2017.</p>
<p>If you run the same query with <code>(newer:"2017-11-01T00:00:00Z")</code>, you get all hotels from the beginning of November. Running now the query gave me 223 nodes, 163 ways and 8 relations, so 394 hotels. That means that in November there have been created 394 - 160 = 234 hotels.</p>
<p>Maybe that helps you?</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/61338/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>24 Dec '17, 03:56</strong>
</p>
<img alt="edvac's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d45c161edd4b471fd947a7ec574274ca?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3339/edvac">edvac</a><br/>
<span class="score" title="665 reputation points">665</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="19 badges"><span class="bronze">●</span><span class="badgecount">19</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="edvac has 4 accepted answers">15%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-61338">
<a name="61382"></a>
<div class="comment" id="comment-61382">
<div class="comment-score" id="post-61382-score"></div>
<div class="comment-text"><p>Yes, it could be a solution, anyway it is not responding to my question.</p></div>
<div class="comment-info" id="comment-61382-info">
<span class="comment-age">(27 Dec '17, 11:00)</span>
<a class="comment-user userinfo" href="/users/9763/andreanovenove">Andreanovenove</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-61338">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-61338-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="61384"></a>
<div class="answer" id="answer-container-61384">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/61384/up/" id="post-61384-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-61384-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/61384/down/" id="post-61384-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Hi:</p>
<p>Sorry, I just focused in solving your task, not your problem with your query and that runtime error. But in fact I hadn't noticed that the query was linked in the first tense of your message...</p>
<p>I was guessing the error with your query was with line</p>
<pre><code>{{geocodeArea:Italy}}-&gt;.searchArea;
</code></pre>
<p>That the line gets all Italy data before processing it, that is a lot of data. But I am not sure...</p>
<p>Note also that you shouldn't add the last 2 lines:</p>
<pre><code>&gt;;
out meta qt;
</code></pre>
<p>Those lines get the nodes and the ways of all relations as well, and the nodes of all ways. But you are interested in nodes, ways and relations that are tagged as <strong>tourism=hotel</strong> only.</p>
<p>Anyway, I found a good solution for you, much better than my previous answer:</p>
<p>With the following query you get all hotels in Italy at present:</p>
<pre><code>[out:csv(::timestamp)][timeout:150];
(
node["tourism"="hotel"](area:3600365331);
way["tourism"="hotel"](area:3600365331);
relation["tourism"="hotel"](area:3600365331);
);
out meta;
</code></pre>
<p>You save the data into a file that you may name like <strong>italianHotels.csv</strong> for example.</p>
<p>Then, to check all hotels created in May 2009 for example, you run this UNIX command:</p>
<pre><code>cat italianHotels.csv | grep "2009-05" | wc -l
</code></pre>
<p>That will give you the hotels whose last version is timestamped in May 2009. In our case, we get <strong>24</strong> hotels.</p>
<p>Or you can open the .csv file in a spreadsheet and get all hotels by month and year with functions.</p>
<p>Note that all these gives you the hotels with the last version, not the hotels when they were first created (version=1). For that I don't think it is possible to do it with Overpass...</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/61384/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>27 Dec '17, 15:36</strong>
</p>
<img alt="edvac's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d45c161edd4b471fd947a7ec574274ca?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3339/edvac">edvac</a><br/>
<span class="score" title="665 reputation points">665</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="19 badges"><span class="bronze">●</span><span class="badgecount">19</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="edvac has 4 accepted answers">15%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-61384">
</div>
<div class="comment-tools" id="comment-tools-61384">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-61384-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/61335/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="PAuub4fKfaEIf1V2mThU0W9vDgNIPib8"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>