<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/43835/c-how-to-calculate-route-between-two-points-offline">[c#] How to calculate route between two points offline?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/43835/up/" id="post-43835-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-43835-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/43835/down/" id="post-43835-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/43835/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi,</p>
<p>I've downloaded my regional map from <a href="http://download.geofabrik.de/">http://download.geofabrik.de/</a> and now I only want to calculate distance between two point (coordinates) using C#</p>
<p>I've read about BruTile and OSM, but I've no found any piece of code which implements my needs.</p>
<p>Map Rendering is not necessary for me, duration either. I mean, input: two coordinates, output: XX KM. That's all.</p>
<p>Could anybody please help me?</p>
<p>Thanks in advance.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-c#" href="/tags/c%2523/" rel="tag" title="see questions tagged 'c#'">c#</a>
<a class="post-tag tag-link-distance" href="/tags/distance/" rel="tag" title="see questions tagged 'distance'">distance</a>
<a class="post-tag tag-link-offline" href="/tags/offline/" rel="tag" title="see questions tagged 'offline'">offline</a>
<a class="post-tag tag-link-routing" href="/tags/routing/" rel="tag" title="see questions tagged 'routing'">routing</a>
<a class="post-tag tag-link-c#.net" href="/tags/c%2523.net/" rel="tag" title="see questions tagged 'c#.net'">c#.net</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>29 Jun '15, 10:01</strong>
</p>
<img alt="doShare's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/4d0d01a465818284bd2d9cd38905b402?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/11160/doshare">doShare</a><br/>
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="doShare has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/43835/">
                edited
                <strong>29 Jun '15, 10:15</strong>
</a>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-43835">
<a name="43868"></a>
<div class="comment" id="comment-43868">
<div class="comment-score" id="post-43868-score"></div>
<div class="comment-text"><p>Hi again,</p>
<p>I've found a solution consisting in import map to mySQL:</p>
<ul>
<li><a href="http://wiki.openstreetmap.org/wiki/Osm.pm">http://wiki.openstreetmap.org/wiki/Osm.pm</a></li>
<li><a href="http://wiki.openstreetmap.org/wiki/OsmDB.pm">http://wiki.openstreetmap.org/wiki/OsmDB.pm</a></li>
</ul>
<p>I also have installed: MySQL and PERL</p>
<p>The instructions are not clear for me...I dont know how to, import my .osm/.osm.bz2 maps into MySQL and, moreover, how to test distances/routes between two coordinates...</p>
<p>I have installed all the packages into Perl Package Manager, but i am not sure that my installation was fine.</p>
<p>Thanks in advance</p></div>
<div class="comment-info" id="comment-43868-info">
<span class="comment-age">(30 Jun '15, 16:33)</span>
<a class="comment-user userinfo" href="/users/11160/doshare">doShare</a>
</div>
</div>
<a name="43873"></a>
<div class="comment" id="comment-43873">
<div class="comment-score" id="post-43873-score"></div>
<div class="comment-text"><p>That's a completely different question. And why would you want to use MySQL instead of PostgreSQL? There are dozens of instructions for how to import OSM data into a PostgreSQL database. Don't choose a different database unless you have very good reasons for this decision.</p></div>
<div class="comment-info" id="comment-43873-info">
<span class="comment-age">(30 Jun '15, 20:03)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="43875"></a>
<div class="comment" id="comment-43875">
<div class="comment-score" id="post-43875-score"></div>
<div class="comment-text"><p>Thanks,</p>
<p>Maybe the question sounds different, but my goal is the same: Obtain real distance (route) between two points offline using OSM. Firstly, I've tried with .NET c# but, because the map size (arround 400MB) the solution doesnt work. So, I am trying to obtain results migrating the map into DataBase. I've tried with mySQL because my .NET application runs over MySQL but, if PostgreSQL is easier, I will look for information / how to. Any suggestion?</p>
<p>Thanks in advance</p></div>
<div class="comment-info" id="comment-43875-info">
<span class="comment-age">(01 Jul '15, 07:44)</span>
<a class="comment-user userinfo" href="/users/11160/doshare">doShare</a>
</div>
</div>
<a name="43876"></a>
<div class="comment" id="comment-43876">
<div class="comment-score" id="post-43876-score">2</div>
<div class="comment-text"><p>If OsmSharp can't handle large maps then you could think about installing a separate routing service, such as <a href="https://wiki.openstreetmap.org/wiki/GraphHopper">GraphHopper</a> or <a href="https://wiki.openstreetmap.org/wiki/Open_Source_Routing_Machine">OSRM</a>.</p></div>
<div class="comment-info" id="comment-43876-info">
<span class="comment-age">(01 Jul '15, 08:02)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="43880"></a>
<div class="comment not_top_scorer" id="comment-43880">
<div class="comment-score" id="post-43880-score"></div>
<div class="comment-text"><p>I thought it was Postgis which is Postgres + a GIS extension. The latter provides functionality to work with point, lines and areas.</p></div>
<div class="comment-info" id="comment-43880-info">
<span class="comment-age">(01 Jul '15, 12:38)</span>
<a class="comment-user userinfo" href="/users/5390/escada">escada</a>
</div>
</div>
<a name="43918"></a>
<div class="comment" id="comment-43918">
<div class="comment-score" id="post-43918-score">2</div>
<div class="comment-text"><p>Thanks for your help. I've implemented my .NET Solution with GraphHopper. Now, I'm looking for an option to avoid running Terminal Cygwin64 permanently (It starts a local map website)</p></div>
<div class="comment-info" id="comment-43918-info">
<span class="comment-age">(02 Jul '15, 12:27)</span>
<a class="comment-user userinfo" href="/users/11160/doshare">doShare</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-43835">
<span class="comments-showing">
            showing 5 of 6
        </span>
<a class="show-all-comments-link" href="#">show 1 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-43835-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/43835/c-how-to-calculate-route-between-two-points-offline?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/43835/c-how-to-calculate-route-between-two-points-offline?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/43835/c-how-to-calculate-route-between-two-points-offline?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/43835/c-how-to-calculate-route-between-two-points-offline?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="43836"></a>
<div class="answer" id="answer-container-43836">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/43836/up/" id="post-43836-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-43836-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/43836/down/" id="post-43836-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Did you already read the <a href="https://wiki.openstreetmap.org/wiki/Routing">routing</a> wiki page? It even mentions some tools for C#, for example <a href="https://wiki.openstreetmap.org/wiki/OsmSharp">OsmSharp</a>.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/43836/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>29 Jun '15, 10:14</strong>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="scai has 168 accepted answers">23%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/43836/">
                edited
                <strong>29 Jun '15, 10:15</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-43836">
<a name="43837"></a>
<div class="comment" id="comment-43837">
<div class="comment-score" id="post-43837-score"></div>
<div class="comment-text"><p>Hi,</p>
<p>Now, i am testing <a href="https://github.com/OsmSharp/OsmSharp/wiki/A-getting-started-example">https://github.com/OsmSharp/OsmSharp/wiki/A-getting-started-example</a> but, because my map size is about 500MB it fails (memory exception). </p>
<p>I am also trying "https://github.com/OsmSharp/OsmSharpDataProcessor/wiki" but I can't do anything with it...</p></div>
<div class="comment-info" id="comment-43837-info">
<span class="comment-age">(29 Jun '15, 11:02)</span>
<a class="comment-user userinfo" href="/users/11160/doshare">doShare</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-43836">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-43836-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="49306"></a>
<div class="answer" id="answer-container-49306">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/49306/up/" id="post-49306-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-49306-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/49306/down/" id="post-49306-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I was able to get a result in meters from the code below...  however, it took 3.5 minutes to calculate the distance between two points that are 12357 meters apart.</p>
<p>I used the osm.pbf for Oklahoma that is 116mb.</p>
<p>Install VS 2012, Install NuGet Extension, Install OSMSharp via NuGet.
Start a new windows app for C#:</p>
<pre><code>using OsmSharp.Osm.PBF.Streams;
using OsmSharp.Routing.Osm.Interpreter;
using OsmSharp.Routing.TSP.Genetic;
using OsmSharp.Math.Geo;
using OsmSharp.Routing;

using System;
using System.IO;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)
        {

            var frCoord = new GeoCoordinate(35.5275684, -97.5691736);
            var toCoord = new GeoCoordinate(35.5575105, -97.6740397);
            var f = new FileInfo("C:\\OSM\\oklahoma-latest\\oklahoma-latest.osm.pbf").OpenRead();
            var p = new PBFOsmStreamSource(f);
            var ri = new OsmRoutingInterpreter();

            var router = Router.CreateLiveFrom(p, ri);

            var resolved1 = router.Resolve(Vehicle.Car, frCoord);
            var resolved2 = router.Resolve(Vehicle.Car, toCoord);

            var route = router.Calculate(Vehicle.Car, resolved1, resolved2);

            label1.Text= Convert.ToString(route.TotalDistance);
        }


    }
}
</code></pre>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/49306/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>20 Apr '16, 19:22</strong>
</p>
<img alt="kttii's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/4b6da62da13bebd16eca37184773fb59?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/12202/kttii">kttii</a><br/>
<span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="bronze">●</span><span class="badgecount">1</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="kttii has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/49306/">
                edited
                <strong>20 Apr '16, 19:36</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-49306">
</div>
<div class="comment-tools" id="comment-tools-49306">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-49306-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/43835/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="0qyh73v2ytr15geSMqFezxYszp7sOdlD"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>