<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/11405/xmlpostgresql-rendering">XML/Postgresql Rendering</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/11405/up/" id="post-11405-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-11405-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/11405/down/" id="post-11405-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/11405/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Heyho!</p>
<p>I try to render my map from a Postgresql/PostGIS Database.
I use a simple XML-Stylesheet.</p>
<p>Can somebody please tell me, what this error-message means and how I can fix it?
That would be really kind!</p>
<p>The error-massage is quoted at the end of this post.
If needed, I can quote/upload my code as well.</p>
<p>Greetings
Matze</p>
<hr/>
<pre><code>Traceback (most recent call last):
  File "C:/0A/run_python", line 3, in &lt;module&gt;
    execfile(r"C:\0A\7\schwentine.py")
  File "C:\0A\7\schwentine.py", line 57, in &lt;module&gt;
    render_image()
  File "C:\0A\7\schwentine.py", line 21, in render_image
    mapnik.load_map(m,r"C:\0A\7\schwentine.xml")
RuntimeError: Postgis Plugin: PSQL error:
ERROR:  syntax error at or near "planet_osm_line"
LINE 1: ... srid FROM geometry_columns WHERE f_table_name=' 'planet_osm...
                                                             ^
Full sql was: 'SELECT f_geometry_column, srid FROM geometry_columns WHERE f_table_name=' 'planet_osm_line' ''
 (encountered during parsing of layer 'tutorial' in map 'C:\0A\7\schwentine.xml')
</code></pre>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-xml" href="/tags/xml/" rel="tag" title="see questions tagged 'xml'">xml</a>
<a class="post-tag tag-link-geometry" href="/tags/geometry/" rel="tag" title="see questions tagged 'geometry'">geometry</a>
<a class="post-tag tag-link-postgresql" href="/tags/postgresql/" rel="tag" title="see questions tagged 'postgresql'">postgresql</a>
<a class="post-tag tag-link-postgis" href="/tags/postgis/" rel="tag" title="see questions tagged 'postgis'">postgis</a>
<a class="post-tag tag-link-database" href="/tags/database/" rel="tag" title="see questions tagged 'database'">database</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>22 Mar '12, 08:19</strong>
</p>
<img alt="MHein's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/cc0198a02af3c41ad04b61e028c3b126?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3139/mhein">MHein</a><br/>
<span class="score" title="141 reputation points">141</span><span title="11 badges"><span class="badge1">●</span><span class="badgecount">11</span></span><span title="11 badges"><span class="silver">●</span><span class="badgecount">11</span></span><span title="16 badges"><span class="bronze">●</span><span class="badgecount">16</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="MHein has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-11405">
</div>
<div class="comment-tools" id="comment-tools-11405">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-11405-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/11405/xmlpostgresql-rendering?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/11405/xmlpostgresql-rendering?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/11405/xmlpostgresql-rendering?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/11405/xmlpostgresql-rendering?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="11457"></a>
<div class="answer accepted-answer" id="answer-container-11457">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/11457/up/" id="post-11457-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-11457-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/11457/down/" id="post-11457-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/11457/" rel="nofollow" title="MHein has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>What is the last line of your inc/settings.xml.inc file? If you are running the default setup it should be &lt;!ENTITY prefix "planet_osm"&gt;</p>
<p>It looks like you might have put in extra quotes.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/11457/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>23 Mar '12, 06:48</strong>
</p>
<img alt="pnorman's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/5634c46072077e10f5b7c0da9b4bbb62?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/290/pnorman">pnorman</a><br/>
<span class="score" title="2352 reputation points"><span class="">2.4k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="21 badges"><span class="silver">●</span><span class="badgecount">21</span></span><span title="40 badges"><span class="bronze">●</span><span class="badgecount">40</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="pnorman has 9 accepted answers">18%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-11457">
<a name="11458"></a>
<div class="comment" id="comment-11458">
<div class="comment-score" id="post-11458-score"></div>
<div class="comment-text"><p>This is my XML-Stylesheet:</p>
<p></p><hr/>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;<p></p>
<p>&lt;!DOCTYPE Map
[
       &lt;!ENTITY world_boundaries_dir   "/home/foo/mapnik/world_boundaries/"&gt;
       &lt;!ENTITY dbtype "postgis"&gt;
       &lt;!ENTITY dbhost "localhost"&gt;
       &lt;!ENTITY dbuser "Hein"&gt;
       &lt;!ENTITY dbname "gis_schwentine"&gt;
       &lt;!ENTITY dbprefix "planet_osm"&gt;
       &lt;!ENTITY tutorial-casing SYSTEM "/home/foo/spreadnik/tutorial-casing.sty"&gt;
]&gt;</p>
<p>&lt;Map bgcolor="#b5d0d0" &gt;</p>
<pre><code>&amp;lt;Style name="world"&amp;gt;&amp;lt;/Style&amp;gt;
&amp;lt;Style name="coast-poly"&amp;gt;&amp;lt;/Style&amp;gt;
&amp;lt;Style name="builtup"&amp;gt;&amp;lt;/Style&amp;gt;

&amp;lt;Layer name="world"&amp;gt;&amp;lt;/Layer&amp;gt;
&amp;lt;Layer name="coast-poly"&amp;gt;&amp;lt;/Layer&amp;gt;
&amp;lt;Layer name="builtup"&amp;gt;&amp;lt;/Layer&amp;gt;

&amp;lt;Layer name="tutorial"&amp;gt;
&amp;lt;StyleName&amp;gt;tutorial-fill&amp;lt;/StyleName&amp;gt;
    &amp;lt;Datasource&amp;gt;
        &amp;lt;Parameter name="type"&amp;gt;&amp;amp;dbtype;&amp;lt;/Parameter&amp;gt;
        &amp;lt;Parameter name="user"&amp;gt;&amp;amp;dbuser;&amp;lt;/Parameter&amp;gt;
        &amp;lt;Parameter name="dbname"&amp;gt;&amp;amp;dbname;&amp;lt;/Parameter&amp;gt;
        &amp;lt;Parameter name="table"&amp;gt; 'planet_osm_points' &amp;lt;/Parameter&amp;gt;
        &amp;lt;Parameter name="estimate_extent"&amp;gt;false&amp;lt;/Parameter&amp;gt;
        &amp;lt;Parameter name="extent"&amp;gt;-20037508,-19929239,20037508,19929239&amp;lt;/Parameter&amp;gt;
    &amp;lt;/Datasource&amp;gt;
&amp;lt;/Layer&amp;gt;
</code></pre>
</code><p><code>&lt;/Map&gt;
</code></p></pre><p></p></div>
<div class="comment-info" id="comment-11458-info">
<span class="comment-age">(23 Mar '12, 06:53)</span>
<a class="comment-user userinfo" href="/users/3139/mhein">MHein</a>
</div>
</div>
<a name="11459"></a>
<div class="comment" id="comment-11459">
<div class="comment-score" id="post-11459-score"></div>
<div class="comment-text"><p>This is my Python-file</p>
<p></p><hr/>
<pre><code>    #!/usr/bin/python<p></p>
<p>import mapnik 
from mapnik import Layer, PostGIS
import sys, os</p>
<p>def render_image():</p>
<pre><code>ll = (-180.0,-90.0, 180.0,90.0)
prj = mapnik.Projection("+proj=utm +zone=32U +ellps=GRS80 +datum=WGS84 +units=m +no_defs")
#prj = mapnik.Projection("+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.999601 +x_0=400000 +y_0=-100000 +ellps=airy  +units=m +towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894 +units=m +nodefs")
#prj = mapnik.Projection("+proj=latlong +datum=WGS84")
c0 = prj.forward(mapnik.Coord(ll[0],ll[1]))
c1 = prj.forward(mapnik.Coord(ll[2],ll[3]))

z = 3
imgx = 336 * z
imgy = 450 * z

m = mapnik.Map(imgx,imgy)
mapnik.load_map(m,r"C:\0A\7\schwentine.xml")

db_params = dict(
  dbname = 'gis_schwentine',
  user = 'Hein',
  password = '1234',
  host = 'localhost',
  port = 5432,
  estimate_extent = False,
  extent = "3390650.221286806, -3163145.87245787, 3609898.596229789, -2956043.104540316"
)

lyr = Layer('points',"+init=epsg:900913")
db_params['table'] = (planet_osm_point)
lyr.datasource = PostGIS(**db_params)
lyr.styles.append('points')
m.layers.append(lyr)

if hasattr(mapnik,'mapnik_version') and mapnik.mapnik_version() &amp;gt;= 800:
    bbox = mapnik.Box2d(c0.x,c0.y,c1.x,c1.y)
else:
    bbox = mapnik.Envelope(c0.x,c0.y,c1.x,c1.y)
m.zoom_to_box(bbox)
im = mapnik.Image(imgx,imgy)
mapnik.render(m, im)
view = im.view(0,0,imgx,imgy) # x,y,width,height
view.save("schwentine.png",'png')
</code></pre>
</code><p><code>if <strong>name</strong> == "<strong>main</strong>":
  render_image()
</code></p></pre><p></p></div>
<div class="comment-info" id="comment-11459-info">
<span class="comment-age">(23 Mar '12, 07:41)</span>
<a class="comment-user userinfo" href="/users/3139/mhein">MHein</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-11457">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-11457-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/11405/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="HplJx0b3UwE9peroOSmn3l9c4PWL7EdS"/>
<div style="clear:both">
</div>
</form>
</hr></div>
</div>
</div>