<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/75856/when-building-tile-server-can-not-download-shapefile">when building tile server, can not download Shapefile</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/75856/up/" id="post-75856-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-75856-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/75856/down/" id="post-75856-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/75856/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Shapefile download</p>
<pre><code># cd ~/src/openstreetmap-carto/
# scripts/get-external-data.py

INFO:root:Checking table water_polygons
</code></pre>
<p>why cannot download the shapefiel?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-building" href="/tags/building/" rel="tag" title="see questions tagged 'building'">building</a>
<a class="post-tag tag-link-tile" href="/tags/tile/" rel="tag" title="see questions tagged 'tile'">tile</a>
<a class="post-tag tag-link-download" href="/tags/download/" rel="tag" title="see questions tagged 'download'">download</a>
<a class="post-tag tag-link-shapefile" href="/tags/shapefile/" rel="tag" title="see questions tagged 'shapefile'">shapefile</a>
<a class="post-tag tag-link-server" href="/tags/server/" rel="tag" title="see questions tagged 'server'">server</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>23 Jul '20, 02:42</strong>
</p>
<img alt="%E5%BC%A0%E6%B2%BB%E9%9F%B3's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/4637c543421eb586aa1807010f43b39d?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/18724/">张治音</a><br/>
<span class="score" title="90 reputation points">90</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="张治音 has 2 accepted answers">100%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/75856/">
                edited
                <strong>23 Jul '20, 06:44</strong>
</a>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-75856">
</div>
<div class="comment-tools" id="comment-tools-75856">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-75856-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/75856/when-building-tile-server-can-not-download-shapefile?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/75856/when-building-tile-server-can-not-download-shapefile?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/75856/when-building-tile-server-can-not-download-shapefile?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/75856/when-building-tile-server-can-not-download-shapefile?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="75871"></a>
<div class="answer accepted-answer answered-by-owner" id="answer-container-75871">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/75871/up/" id="post-75871-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-75871-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/75871/down/" id="post-75871-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/75871/" rel="nofollow" title="scai has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I have solved the problem that can not download the shapefile .
As network is not good and the shapefile is too big, we can not download the shapefile zip .
So we open the shell file 'openstreetmap-carto/external-data.yml', and get the info,as following,</p>
<pre><code>settings:
  temp_schema: loading
  schema: public
  data_dir: data
  database: gis
  metadata_table: external_data
sources:
  simplified_water_polygons:
    # The type of file this source is
    type: shp
    # Where to get it
    url: <a href="https://osmdata.openstreetmap.de/download/simplified-water-polygons-split-3857.zip">https://osmdata.openstreetmap.de/download/simplified-water-polygons-split-3857.zip</a>
    # The location within the archive
    file: simplified-water-polygons-split-3857/simplified_water_polygons.shp
    archive:
      format: zip
      # Files to extract from the archive
      files:

  water_polygons:
    type: shp
    url: <a href="https://osmdata.openstreetmap.de/download/water-polygons-split-3857.zip">https://osmdata.openstreetmap.de/download/water-polygons-split-3857.zip</a>
    file: water-polygons-split-3857/water_polygons.shp
    archive:
      format: zip
      files:
        icesheet_polygons:
    type: shp
    url: <a href="https://osmdata.openstreetmap.de/download/antarctica-icesheet-polygons-3857.zip">https://osmdata.openstreetmap.de/download/antarctica-icesheet-polygons-3857.zip</a>
    file: antarctica-icesheet-polygons-3857/icesheet_polygons.shp
    archive:
      format: zip
      files:
        icesheet_outlines:
    type: shp
    url: <a href="https://osmdata.openstreetmap.de/download/antarctica-icesheet-outlines-3857.zip">https://osmdata.openstreetmap.de/download/antarctica-icesheet-outlines-3857.zip</a>
    file: antarctica-icesheet-outlines-3857/icesheet_outlines.shp
    ogropts:
      - "-explodecollections"
    archive:
      format: zip
      files:

  ne_110m_admin_0_boundary_lines_land:
    type: shp
    url: <a href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/ne_110m_admin_0_boundary_lines_land.zip">http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/ne_110m_admin_0_boundary_lines_land.zip</a>
    file: ne_110m_admin_0_boundary_lines_land.shp
    ogropts: &amp;ne_opts
      - "--config"
      - "SHAPE_ENCODING"
      - "WINDOWS-1252"
      - "-explodecollections"
      # needs reprojecting
      - '-t_srs'
      - 'EPSG:3857'
    archive:
      format: zip
      files:
</code></pre>
<p>Then we download all the 5 *zip files manually , and put them to your web server, for me ,
 The url is <a href="http://127.0.0.1/osm/">http://127.0.0.1/osm/</a></p>
<pre><code>  antarctica-icesheet-outlines-3857.zip 2020-07-24 09:37    51M  
  antarctica-icesheet-polygons-3857.zip 2020-07-24 09:37    51M  
  ne_110m_admin_0_boundary_lines_land.zip   2020-07-24 09:41    45K  
  simplified-water-polygons-split-3857.zip  2020-07-24 09:36    23M  
  water-polygons-split-3857.zip 2020-07-24 09:37    610M
</code></pre>
<p>At last, we modify the shell file 'openstreetmap-carto/external-data.yml' ，instead of the url download to ours. As following,</p>
<pre><code>settings:
  temp_schema: loading
  schema: public
  data_dir: data
  database: gis
  metadata_table: external_data
sources:
  simplified_water_polygons:
    # The type of file this source is
    type: shp
    # Where to get it
    #url: <a href="https://osmdata.openstreetmap.de/download/simplified-water-polygons-split-3857.zip">https://osmdata.openstreetmap.de/download/simplified-water-polygons-split-3857.zip</a>
    url: <a href="http://127.0.0.1/osm/simplified-water-polygons-split-3857.zip">http://127.0.0.1/osm/simplified-water-polygons-split-3857.zip</a>
    # The location within the archive
    file: simplified-water-polygons-split-3857/simplified_water_polygons.shp
    ...
</code></pre>
<p>It's OK.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/75871/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>24 Jul '20, 03:21</strong>
</p>
<img alt="%E5%BC%A0%E6%B2%BB%E9%9F%B3's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/4637c543421eb586aa1807010f43b39d?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/18724/">张治音</a><br/>
<span class="score" title="90 reputation points">90</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="张治音 has 2 accepted answers">100%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/75871/">
                edited
                <strong>24 Jul '20, 06:47</strong>
</a>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-75871">
</div>
<div class="comment-tools" id="comment-tools-75871">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-75871-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/75856/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="olGK3vkreQBqrb0AV192dg5uKVOirqTw"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>