<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/71682/private-tile-server-not-rendering">Private Tile Server not rendering</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/71682/up/" id="post-71682-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-71682-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/71682/down/" id="post-71682-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/71682/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I searched other topics but didn't found a post that used this version of Ubuntu (18.04), so I think it would be a good idea to don't merge this with other topics, despite similar problem.</p>
<p>I followed the tutorial available at <a href="https://switch2osm.org/manually-building-a-tile-server-18-04-lts/">https://switch2osm.org/manually-building-a-tile-server-18-04-lts/</a> to setup my own tile server.
I'm building the server in my computer and everything went fine. The <a href="http://localhost/hot/0/0/0.png">http://localhost/hot/0/0/0.png</a> showed the world map correctly, but <a href="http://localhost/hot/1/0/0.png">http://localhost/hot/1/0/0.png</a> gives Not Found error.</p>
<p>In the last step, where I should view the tiles, they aren't shown, but for some reason, when I put the zoom lv 0 it shows the map.</p>
<p>I'm opening the "sample_leaflet.html" file inside folder /src/mod_tile/extra/ using Firefox Browser.</p>
<p>Thanks in advance. Please ask me to post any other useful info that would help to debug this problem.</p>
<p><img src="https://i.imgur.com/o9T3yGZ.png" width="800"/></p>
<p><img src="https://i.imgur.com/ct5klJC.png" width="800"/></p>
<p>UPDATE #1: </p>
<p>The Browser Console shows the following errors.</p>
<p><img src="https://i.imgur.com/vabUeYR.png" width="800"/></p>
<p>This is my leaflet file</p>
<p><img src="https://i.imgur.com/JXVUMzX.png" width="800"/></p>
<p><code>systemctl status renderd</code> give the following:</p>
<p><img src="https://i.imgur.com/wkS9JA6.png" width="800"/></p>
<p>This is the result from <code>tail -f /var/log/syslog | grep " TILE "</code></p>
<p><img src="https://i.imgur.com/IbnLrrt.png" width="800"/></p>
<p>UPDATE #3: I checked folder "/var/lib/mod_tile/ajt/", where its supposed to store the tiles and it is occupying a total of 60.9 Kb, so clearly the tiles aren't being stored there.</p>
<p><img src="https://i.imgur.com/DEFQBB8.png" width="800"/></p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-rendering" href="/tags/rendering/" rel="tag" title="see questions tagged 'rendering'">rendering</a>
<a class="post-tag tag-link-mod_tile" href="/tags/mod_tile/" rel="tag" title="see questions tagged 'mod_tile'">mod_tile</a>
<a class="post-tag tag-link-osm" href="/tags/osm/" rel="tag" title="see questions tagged 'osm'">osm</a>
<a class="post-tag tag-link-tileserver" href="/tags/tileserver/" rel="tag" title="see questions tagged 'tileserver'">tileserver</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>17 Nov '19, 01:45</strong>
</p>
<img alt="carlosguedes's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/5f1f061e7e81f0e885227d27d95752f6?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/16880/carlosguedes">carlosguedes</a><br/>
<span class="score" title="91 reputation points">91</span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="10 badges"><span class="silver">●</span><span class="badgecount">10</span></span><span title="16 badges"><span class="bronze">●</span><span class="badgecount">16</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="carlosguedes has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/71682/">
                edited
                <strong>19 Nov '19, 16:09</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-71682">
</div>
<div class="comment-tools" id="comment-tools-71682">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-71682-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/71682/private-tile-server-not-rendering?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/71682/private-tile-server-not-rendering?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/71682/private-tile-server-not-rendering?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/71682/private-tile-server-not-rendering?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="71728"></a>
<div class="answer accepted-answer" id="answer-container-71728">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/71728/up/" id="post-71728-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-71728-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/71728/down/" id="post-71728-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/71728/" rel="nofollow" title="carlosguedes has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>You have a "failed to write metafile to file" error, so you need to check:</p>
<ul>
<li>What account you are running the command that is trying to write to that directory</li>
<li>What access rights are needed to write to that directory.</li>
</ul>
<p>Here's what it looks like on a server of mine:</p>
<pre><code>renderaccount@myserver:~$ cd /var/lib/mod_tile/ajt
renderaccount@myserver:/var/lib/mod_tile/ajt$ ls -ald .
drwxrwxr-x 27 renderaccount renderaccount 4096 Oct 23  2018 .
renderaccount@myserver:/var/lib/mod_tile/ajt$
</code></pre>
<p>The process that renders tiles runs as a user called "renderaccount" and that account has write access to that directory.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/71728/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>19 Nov '19, 15:08</strong>
</p>
<img alt="SomeoneElse's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0bf1aa22f7f5e045b0eb8beb79fe7907?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/387/someoneelse">SomeoneElse ♦</a><br/>
<span class="score" title="36866 reputation points"><span class="">36.9k</span></span><span title="71 badges"><span class="badge1">●</span><span class="badgecount">71</span></span><span title="370 badges"><span class="silver">●</span><span class="badgecount">370</span></span><span title="866 badges"><span class="bronze">●</span><span class="badgecount">866</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SomeoneElse has 228 accepted answers">16%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/71728/">
                edited
                <strong>19 Nov '19, 15:08</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-71728">
<a name="71736"></a>
<div class="comment" id="comment-71736">
<div class="comment-score" id="post-71736-score"></div>
<div class="comment-text"><p>I'm logging in OS using my root account, but in Terminal I do <code>su renderaccount</code> to run commands as the user renderaccount, is that correct?</p>
<p>I did the following commands:</p>
<p>sudo chown renderaccount /var/lib/mod_tile/</p>
<p>sudo chmod u+w /var/lib/mod_tile/</p>
<p>Isn't that enough to give write permisions for renderaccount?</p></div>
<div class="comment-info" id="comment-71736-info">
<span class="comment-age">(19 Nov '19, 16:08)</span>
<a class="comment-user userinfo" href="/users/16880/carlosguedes">carlosguedes</a>
</div>
</div>
<a name="71739"></a>
<div class="comment" id="comment-71739">
<div class="comment-score" id="post-71739-score"></div>
<div class="comment-text"><p>Now it worked! But I don't know exactly what solved it, because I did 2 things.</p>
<p>1) I did the chown command with : after the username, like this sudo chown renderaccount: /var/lib/mod_tile/ but I don't know if the : is needed (the switch2osm tutorial dont use it)</p>
<p>2) I did chown and chmod commands both in /var/lib/mod_tile/  and /var/lib/mod_tile/ajt/ but I'm not sure if an user having permision to write in a folder is enough to write in its subfolder.</p></div>
<div class="comment-info" id="comment-71739-info">
<span class="comment-age">(19 Nov '19, 16:43)</span>
<a class="comment-user userinfo" href="/users/16880/carlosguedes">carlosguedes</a>
</div>
</div>
<a name="71740"></a>
<div class="comment" id="comment-71740">
<div class="comment-score" id="post-71740-score">2</div>
<div class="comment-text"><p>Looking at the "drwxrwxr-x" in my comment above, the first "rwx" means that the owner of the directory has the right to read files, write files and cd into that directory.  The owner of the directory is "renderaccount".  The second "rwx" means that anyone in the group "renderaccount" can read, write, and enter into that directory.  The "r-x" at the end means that everyone else can read that directory and cd into it but not write files there.</p>
<p>The level of detail in the "switch2osm" guide is a compromise - it tries to assume no prior knowledge so that if you follow the instructions you'll get something working at the other end, but it doesn't go into so much detail about the various Unix concepts that you encounter on the way through.  If it did it'd be an awful lot longer, and all of that stuff is available elsewhere.</p></div>
<div class="comment-info" id="comment-71740-info">
<span class="comment-age">(19 Nov '19, 16:57)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-71728">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-71728-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="71684"></a>
<div class="answer" id="answer-container-71684">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/71684/up/" id="post-71684-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-71684-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/71684/down/" id="post-71684-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>First of all:</p>
<p>have you prerendered any tiles? Those metatiles on e.g. on zoom 6 can take up to 2 CPU-Hours to render for the first time, but you should at least see renderd showing up in the syslog, so there is sth. else not working between leaflet and your apache/renderd toolchain.</p>
<p>Do you see any errors in the js console of the firefox developer tab?</p>
<p>And please use grep renderd on your syslog to watch renderds work, not grep " TILE ".</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/71684/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>17 Nov '19, 09:26</strong>
</p>
<img alt="Spiekerooger's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/e06ed329df6032df14b5639de4d64782?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/17439/spiekerooger">Spiekerooger</a><br/>
<span class="score" title="3148 reputation points"><span class="">3.1k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="23 badges"><span class="silver">●</span><span class="badgecount">23</span></span><span title="56 badges"><span class="bronze">●</span><span class="badgecount">56</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Spiekerooger has 18 accepted answers">16%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/71684/">
                edited
                <strong>17 Nov '19, 14:03</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-71684">
<a name="71687"></a>
<div class="comment" id="comment-71687">
<div class="comment-score" id="post-71687-score"></div>
<div class="comment-text"><p>It's my first time rendering tiles.
I left my laptop on for all night long to check if its rendering but nothing appeared.
Its specs are 16 GB RAM, i7-8550U, MX150 2 GB and all running in SSD, should it take that long?
Geofabrik don't have OSM data of smaller parts of Brazil, like states or cities, that's why I used the whole country.
I updated my question with the screenshot of the Browser Console, is that the right console?
I did grep renderd also but didn't got any message.</p></div>
<div class="comment-info" id="comment-71687-info">
<span class="comment-age">(17 Nov '19, 16:33)</span>
<a class="comment-user userinfo" href="/users/16880/carlosguedes">carlosguedes</a>
</div>
</div>
<a name="71706"></a>
<div class="comment" id="comment-71706">
<div class="comment-score" id="post-71706-score"></div>
<div class="comment-text"><p>After reinstalling everything with the right account now it shows the tile messages in console, despite now showing the tiles itself. I updated my question.</p></div>
<div class="comment-info" id="comment-71706-info">
<span class="comment-age">(19 Nov '19, 02:48)</span>
<a class="comment-user userinfo" href="/users/16880/carlosguedes">carlosguedes</a>
</div>
</div>
<a name="71708"></a>
<div class="comment" id="comment-71708">
<div class="comment-score" id="post-71708-score"></div>
<div class="comment-text"><p>So it does look as if you don't have permission to write the metatiles into the file structure. Check the owner and rights or your ajt directory in a terminal and check renderd.conf settings for the internal tile path.</p></div>
<div class="comment-info" id="comment-71708-info">
<span class="comment-age">(19 Nov '19, 05:42)</span>
<a class="comment-user userinfo" href="/users/17439/spiekerooger">Spiekerooger</a>
</div>
</div>
<a name="71727"></a>
<div class="comment" id="comment-71727">
<div class="comment-score" id="post-71727-score"></div>
<div class="comment-text"><p>Correcting my last comment: After reinstalling everything with the right account now it shows the tile messages in console, despite not showing the tiles itself. I updated my question.</p></div>
<div class="comment-info" id="comment-71727-info">
<span class="comment-age">(19 Nov '19, 15:00)</span>
<a class="comment-user userinfo" href="/users/16880/carlosguedes">carlosguedes</a>
</div>
</div>
<a name="71729"></a>
<div class="comment" id="comment-71729">
<div class="comment-score" id="post-71729-score"></div>
<div class="comment-text"><p>But you syslog tells us that renderd is not able to write the metatiles to a file. Sou check (e.g. via top) the linux user that is running renderd and than check file permissions at the ajt directory.</p></div>
<div class="comment-info" id="comment-71729-info">
<span class="comment-age">(19 Nov '19, 15:09)</span>
<a class="comment-user userinfo" href="/users/17439/spiekerooger">Spiekerooger</a>
</div>
</div>
<a name="71738"></a>
<div class="comment not_top_scorer" id="comment-71738">
<div class="comment-score" id="post-71738-score"></div>
<div class="comment-text"><p>the command top -U renderaccount shows that renderaccount is indeed running renderd.</p></div>
<div class="comment-info" id="comment-71738-info">
<span class="comment-age">(19 Nov '19, 16:24)</span>
<a class="comment-user userinfo" href="/users/16880/carlosguedes">carlosguedes</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-71684">
<span class="comments-showing">
            showing 5 of 6
        </span>
<a class="show-all-comments-link" href="#">show 1 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-71684-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/71682/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="l3W3nODOnm4CUZpchBHdFgXWcq3nI5ZM"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>