<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/62113/not-getting-output-from-tileserver-when-i-reduce-the-aws-rds-memory-size-to-16gb">Not getting output from tileserver when I reduce the AWS RDS memory size to 16GB</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/62113/up/" id="post-62113-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-62113-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/62113/down/" id="post-62113-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/62113/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi all,
I was using RDS instance db.r4.xlarge (RAM - 32GB CPU-4 ) to store the database and do the SQL queries for tileserver. It was working perfectly and getting output. However, when I tried to downgrade the RDS instance  to db.r4.large (RAM-16GB and CPU-2vCPU), it is showing the following error.</p>
<p>DEBUG: START TILE ajt 0 0-0 0-0, new metatile
renderd[14721]: Rendering projected coordinates 0 0 0 -&gt; -20037508.342800|-20037508.342800 20037508.342800|20037508.342800 to a 1 x 1 tile
renderd[14721]: DEBUG: Connection 0, fd 6 closed, now 0 left</p>
<p>Please let me know if someone has any idea about this error.</p>
<p>Thanks
Subin</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-rendering" href="/tags/rendering/" rel="tag" title="see questions tagged 'rendering'">rendering</a>
<a class="post-tag tag-link-tileserver" href="/tags/tileserver/" rel="tag" title="see questions tagged 'tileserver'">tileserver</a>
<a class="post-tag tag-link-aws" href="/tags/aws/" rel="tag" title="see questions tagged 'aws'">aws</a>
<a class="post-tag tag-link-database" href="/tags/database/" rel="tag" title="see questions tagged 'database'">database</a>
<a class="post-tag tag-link-memory" href="/tags/memory/" rel="tag" title="see questions tagged 'memory'">memory</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>15 Feb '18, 10:17</strong>
</p>
<img alt="subinjp7's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/95e9674b7a67d58ada813e0c6bc38d84?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/14758/subinjp7">subinjp7</a><br/>
<span class="score" title="16 reputation points">16</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="subinjp7 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/62113/">
                edited
                <strong>16 Feb '18, 17:11</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-62113">
<a name="62114"></a>
<div class="comment" id="comment-62114">
<div class="comment-score" id="post-62114-score">2</div>
<div class="comment-text"><p>This is not an error message. Can you check if your postgresql log file or your syslog show any messages when you try to access the tile?</p></div>
<div class="comment-info" id="comment-62114-info">
<span class="comment-age">(15 Feb '18, 10:40)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
<a name="62117"></a>
<div class="comment" id="comment-62117">
<div class="comment-score" id="post-62117-score"></div>
<div class="comment-text"><p>I checked the sylog, but could not find anything specific. But in RDS instance, it shows that, connection to the client lost. But I am not sure, what is the reason behind losing the connection..Please help me. </p>
<p>Actually I used  EC2 instance:m4.xlarge with 32 GB RAM and RDS instance: db.r4.xlarge with 32GB RAM to run osm2pgsql to convert openstreetmap data in to postgres database.
I am currently using the following configuration for accessing full planet database for tileserver.
EC2 instance:t2.medium  with 4GB RAM for rendering purpose (front end) and RDS instance: db.r4.large with 16GB RAM to store database and run SQL queries.</p>
<p>Please let me know if it is enough to run tileserver for full planet or should I upgrade the configurations?</p></div>
<div class="comment-info" id="comment-62117-info">
<span class="comment-age">(15 Feb '18, 19:18)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
<a name="62126"></a>
<div class="comment" id="comment-62126">
<div class="comment-score" id="post-62126-score"></div>
<div class="comment-text"><p>Without any error information it's difficult to comment further...</p></div>
<div class="comment-info" id="comment-62126-info">
<span class="comment-age">(15 Feb '18, 21:26)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="62128"></a>
<div class="comment" id="comment-62128">
<div class="comment-score" id="post-62128-score"></div>
<div class="comment-text"><p>Sometimes it shows the tiles when requesting the tiles for multiple times. I am not sure what is the reason behind this.</p>
<p>In the RDS instance, the following errors are showing while requesting tiles,</p>
<p>:LOG: could not send data to client: Connection timed out
or 
LOG: could not receive data from client: Connection reset by peer</p></div>
<div class="comment-info" id="comment-62128-info">
<span class="comment-age">(15 Feb '18, 21:48)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
<a name="62150"></a>
<div class="comment" id="comment-62150">
<div class="comment-score" id="post-62150-score">1</div>
<div class="comment-text"><p>Does <code>dmesg</code> show "Out of memory" messages?</p></div>
<div class="comment-info" id="comment-62150-info">
<span class="comment-age">(16 Feb '18, 14:09)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="62151"></a>
<div class="comment not_top_scorer" id="comment-62151">
<div class="comment-score" id="post-62151-score"></div>
<div class="comment-text"><p>No such messages...But while uploading the database, I have got many warning messages such as </p>
<p>NOTICE: Self-intersection at or near point 0.68302757542791204 46.349042878781603.</p>
<p>Does it have any relation to the current situation.</p></div>
<div class="comment-info" id="comment-62151-info">
<span class="comment-age">(16 Feb '18, 14:42)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-62113">
<span class="comments-showing">
            showing 5 of 6
        </span>
<a class="show-all-comments-link" href="#">show 1 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-62113-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/62113/not-getting-output-from-tileserver-when-i-reduce-the-aws-rds-memory-size-to-16gb?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/62113/not-getting-output-from-tileserver-when-i-reduce-the-aws-rds-memory-size-to-16gb?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/62113/not-getting-output-from-tileserver-when-i-reduce-the-aws-rds-memory-size-to-16gb?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/62113/not-getting-output-from-tileserver-when-i-reduce-the-aws-rds-memory-size-to-16gb?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="62132"></a>
<div class="answer accepted-answer" id="answer-container-62132">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/62132/up/" id="post-62132-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-62132-score" title="current number of votes">
    4
</div>
<a class="ajax-command post-vote down" href="/vote/62132/down/" id="post-62132-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/62132/" rel="nofollow" title="subinjp7 has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>It sounds to me as if your system is working normally, but very slow. This means when you access a tile that has not been pre-rendered, renderd will attempt to render the tile on the fly, and that takes too long, then someone along the way gives up and closes the connection. For a world-wide database you must have your database on SSD, and ideally the database should be local to the rendering machine and not connected to over the network. Otherwise you incur too many latencies. </p>
<p>On a very slow system you can still make it work "a little" by pre-rendering lots of tiles (see render_list), however you cannot pre-render the world on all zoom levels.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/62132/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>16 Feb '18, 00:23</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-62132">
<a name="62141"></a>
<div class="comment" id="comment-62141">
<div class="comment-score" id="post-62141-score"></div>
<div class="comment-text"><p>Thanks for your answer. But I would like to ask one more question.
I upgraded my EC2 instance and tried to render it. 
When I tried to render following tiles with zoom level 10, it failed.
example.com/10/536/378.png</p>
<p>But when I tried again to render the same tiles with zoom level 12 it worked and then I could render the tiles with zoom level 10 also. I am not sure what is the problem with this.Do you have any idea about this?</p></div>
<div class="comment-info" id="comment-62141-info">
<span class="comment-age">(16 Feb '18, 09:48)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
<a name="62142"></a>
<div class="comment" id="comment-62142">
<div class="comment-score" id="post-62142-score">1</div>
<div class="comment-text"><p>You've said "it failed", but haven't said what messages occurred in the syslog of the tile server related to tile generation between the "TILE START" and "TILE DONE" messages.</p></div>
<div class="comment-info" id="comment-62142-info">
<span class="comment-age">(16 Feb '18, 10:00)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="62146"></a>
<div class="comment" id="comment-62146">
<div class="comment-score" id="post-62146-score"></div>
<div class="comment-text"><p>I am not getting TILE DONE message when it is getting failed.</p></div>
<div class="comment-info" id="comment-62146-info">
<span class="comment-age">(16 Feb '18, 11:12)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-62132">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-62132-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="62144"></a>
<div class="answer answered-by-owner" id="answer-container-62144">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/62144/up/" id="post-62144-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-62144-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/62144/down/" id="post-62144-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p><img alt="alt text" src="https://help.openstreetmap.org/upfiles/tiles000.PNG"/></p>
<p>Please find the attached image here with. 
This is the error message showing file rendering a world map(example.com/0/0/0.png). </p>
<p>Does it have anything to do with database upload? Database has been uploaded successfully.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/62144/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>16 Feb '18, 10:50</strong>
</p>
<img alt="subinjp7's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/95e9674b7a67d58ada813e0c6bc38d84?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/14758/subinjp7">subinjp7</a><br/>
<span class="score" title="16 reputation points">16</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="subinjp7 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/62144/">
                edited
                <strong>16 Feb '18, 10:52</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-62144">
<a name="62145"></a>
<div class="comment" id="comment-62145">
<div class="comment-score" id="post-62145-score"></div>
<div class="comment-text"><p>Moreover I would like to add some more points. While uploading the database, I have got many warning messages such as 
NOTICE:  Self-intersection at or near point 0.68302757542791204 46.349042878781603.</p>
<p>Does it have any relation to the current situation.</p></div>
<div class="comment-info" id="comment-62145-info">
<span class="comment-age">(16 Feb '18, 11:10)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
<a name="62147"></a>
<div class="comment" id="comment-62147">
<div class="comment-score" id="post-62147-score"></div>
<div class="comment-text"><p>Depending on the speed of the system the "DONE TILE" might be minutes or hours later.</p></div>
<div class="comment-info" id="comment-62147-info">
<span class="comment-age">(16 Feb '18, 13:11)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="62149"></a>
<div class="comment" id="comment-62149">
<div class="comment-score" id="post-62149-score"></div>
<div class="comment-text"><p>Thank you for your answer. </p>
<p>How can I make sure that, connection is not getting closed in a short period of time? If I change the ModTileMissingRequestTimeout to a large value, can I avoid that situation? </p>
<p>Do you have any idea about the reason behind failing happens at some zoom levels(most of the time, low zoom levels)?</p></div>
<div class="comment-info" id="comment-62149-info">
<span class="comment-age">(16 Feb '18, 13:38)</span>
<a class="comment-user userinfo" href="/users/14758/subinjp7">subinjp7</a>
</div>
</div>
<a name="62574"></a>
<div class="comment" id="comment-62574">
<div class="comment-score" id="post-62574-score"></div>
<div class="comment-text"><p>Yes, see Frederik's answer above.  You're trying to use a hammer as a screwdriver and are wondering why none of the screws are going in properly.  </p>
<p>Get it working on a local server or VPS first, then look for cloud services that actually meet the requirements.</p></div>
<div class="comment-info" id="comment-62574-info">
<span class="comment-age">(08 Mar '18, 10:49)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-62144">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-62144-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/62113/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="XXUWa3qJAbDVL6nFBUuZflmmC0m0sv9E"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>