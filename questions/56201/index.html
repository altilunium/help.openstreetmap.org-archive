<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/56201/turbo-overpass-buildings-with-nearest-building-over-1-km-away">Turbo Overpass buildings with nearest building over 1 km away</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/56201/up/" id="post-56201-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-56201-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/56201/down/" id="post-56201-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/56201/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
   1
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Can anyone help me get the query for all buildings which are 1 km or more away from any other building in Overpass Turbo?</p>
<p>The search area here is limited. All I have at the moment is </p>
<pre><code>area[admin_level=4][name=Zeeland];
node(area)[building];
out;
</code></pre>
<p>When I extend it to include also area buildings, I get a timeout one</p>
<pre><code>area[admin_level=4][name=Zeeland]-&gt;.a;
(
node(area.a)[building];
area(area.a)[building];
);
out;
</code></pre>
<p>How to solve that and secondly, how to add the restriction that each other building node or building area is 1 km or more away?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-overpassapi" href="/tags/overpassapi/" rel="tag" title="see questions tagged 'overpassapi'">overpassapi</a>
<a class="post-tag tag-link-overpass" href="/tags/overpass/" rel="tag" title="see questions tagged 'overpass'">overpass</a>
<a class="post-tag tag-link-overpass-turbo" href="/tags/overpass-turbo/" rel="tag" title="see questions tagged 'overpass-turbo'">overpass-turbo</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>16 May '17, 23:27</strong>
</p>
<img alt="pander's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/1fb0d12cfde0dfa6aa364a5758928ea8?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/13707/pander">pander</a><br/>
<span class="score" title="26 reputation points">26</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="pander has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/56201/">
                edited
                <strong>17 May '17, 11:41</strong>
</a>
</p>
<img alt="SK53's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/06cd84075f1adc2870ad102c7233e661?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/647/sk53">SK53 ♦</a><br/>
<span class="score" title="28084 reputation points"><span class="">28.1k</span></span><span title="48 badges"><span class="badge1">●</span><span class="badgecount">48</span></span><span title="268 badges"><span class="silver">●</span><span class="badgecount">268</span></span><span title="433 badges"><span class="bronze">●</span><span class="badgecount">433</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-56201">
</div>
<div class="comment-tools" id="comment-tools-56201">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-56201-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/56201/turbo-overpass-buildings-with-nearest-building-over-1-km-away?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/56201/turbo-overpass-buildings-with-nearest-building-over-1-km-away?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/56201/turbo-overpass-buildings-with-nearest-building-over-1-km-away?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/56201/turbo-overpass-buildings-with-nearest-building-over-1-km-away?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="56202"></a>
<div class="answer" id="answer-container-56202">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/56202/up/" id="post-56202-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-56202-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/56202/down/" id="post-56202-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I'll defer to the Overpass Pros but I think you are over-stretching what Overpass can do here.</p>
<p>If you say the search area is limited, import the area into a PostGIS database with osm2pgsql and then do this:</p>
<pre><code>SELECT building.osm_id 
FROM planet_osm_polygon building
WHERE 
   building.building IS NOT NULL AND
   (SELECT COUNT(*) FROM planet_osm_polygon other WHERE
   other.building IS NOT NULL AND 
   other.osm_id &lt;&gt; building.osm_id AND
   ST_DWITHIN(other.way,building.way,1000) LIMIT 1) = 0;
</code></pre>
<p>This searches in a "1000 mercator units" radius, you might have to adapt it to your particular area. Also, you might want to exclude "building=no", too. If you want to look for nodes with building tags too, then my recommendation would be to first create temporary table with the polygon centroids for all buildings and mix in the points. Will run much faster too.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/56202/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>16 May '17, 23:55</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-56202">
<a name="56206"></a>
<div class="comment" id="comment-56206">
<div class="comment-score" id="post-56206-score"></div>
<div class="comment-text"><p>Thanks for your reply. The eventual results should not be that many and I have seen similar examples in Overpass. (I will try to find them and post them here.) Setting up a PostGIS and importing is not favorable as I would like others to to the same query and tweak it. And I need otherwise set up a complete system with updates and security etc. In what way is this over-stretching Overpass?</p></div>
<div class="comment-info" id="comment-56206-info">
<span class="comment-age">(17 May '17, 09:19)</span>
<a class="comment-user userinfo" href="/users/13707/pander">pander</a>
</div>
</div>
<a name="56207"></a>
<div class="comment" id="comment-56207">
<div class="comment-score" id="post-56207-score"></div>
<div class="comment-text"><p>Here is a similar example in Overpass: <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_API_by_Example#Highway_around_schools_with_inappropriate_maxspeed_.28since_0.7.54.29">https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_API_by_Example#Highway_around_schools_with_inappropriate_maxspeed_.28since_0.7.54.29</a></p></div>
<div class="comment-info" id="comment-56207-info">
<span class="comment-age">(17 May '17, 09:31)</span>
<a class="comment-user userinfo" href="/users/13707/pander">pander</a>
</div>
</div>
<a name="56208"></a>
<div class="comment" id="comment-56208">
<div class="comment-score" id="post-56208-score"></div>
<div class="comment-text"><p><a href="https://nominatim.openstreetmap.org/details.php?place_id=158600066">Zeeland</a> is a large area containing thousands of buildings whereas the "highway around schools" query is limited to rather small areas around schools. I don't think these two queries are comparable.</p></div>
<div class="comment-info" id="comment-56208-info">
<span class="comment-age">(17 May '17, 10:22)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="56212"></a>
<div class="comment" id="comment-56212">
<div class="comment-score" id="post-56212-score"></div>
<div class="comment-text"><p>Simple query on a map that has three buildings results in 30 MB data and abort of query from my side.</p>
<p>[out:json][timeout:25];
(
  area<a href="{{bbox}}">"building"="house"</a>;
);
out body;</p>
<blockquote>
<p>;
out skel qt;</p>
</blockquote>
<p>Is there something wrong with Overpass? I did lots of tests today and for very small areas, it (I guess) tries to query the entire world. Also for </p>
<p>[out:json][timeout:25];
area[admin_level=10][name=Ottoland]-&gt;.a;
(
   area(area.a)[building="house"];
);
out;</p></div>
<div class="comment-info" id="comment-56212-info">
<span class="comment-age">(17 May '17, 15:01)</span>
<a class="comment-user userinfo" href="/users/13707/pander">pander</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-56202">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-56202-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/56201/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="ubW2uTOKDJhFj15mSUtmAICH6SVInU5a"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>