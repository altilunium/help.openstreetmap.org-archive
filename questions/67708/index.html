<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/67708/are-there-optimized-fast-and-minimal-osmpbf-files-available-for-creating-a-tile-server">Are there optimized (fast and minimal) osm.pbf files available for creating a tile server</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67708/up/" id="post-67708-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67708-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/67708/down/" id="post-67708-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/67708/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello there,</p>
<p>I am very inexperienced in the whole topic, however I managed to set up a tile server using postgresql and renderd following this tutorial: <a href="https://switch2osm.org/manually-building-a-tile-server-18-04-lts/">https://switch2osm.org/manually-building-a-tile-server-18-04-lts/</a></p>
<p>Since I want to use the map for cosmetic purposes only (application only displays the surrounding map; basic shape of streets, buildings and parks), I wonder if the osm.pbf files only contain these raw shape data or if there is a lot of meta data connected with it, to allow querying the postgres for special places etc.
If this is the case, is there a way to get only the "shape files" which would lead to the following:</p>
<ol>
<li>faster osm2psql imports (this is a real bottleneck if one wants to scale a tile server horizontally)</li>
<li>less disc space necessary</li>
<li>faster access times</li>
</ol>
<p>An other question I was really interested in is, if there are any scripts out there which do the steps described in the tutorial above automatically. I tried to make one by myself, but switching users (to postrges and back) does not really seem to work in a script. </p>
<p>I would be really happy if anyone could clear things up for me, maybe I completely misunderstood the kind of files that exist and how to use them.</p>
<p>Greetings,</p>
<p>Erik</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-geofabrik" href="/tags/geofabrik/" rel="tag" title="see questions tagged 'geofabrik'">geofabrik</a>
<a class="post-tag tag-link-ubuntu" href="/tags/ubuntu/" rel="tag" title="see questions tagged 'ubuntu'">ubuntu</a>
<a class="post-tag tag-link-osm2pgsql" href="/tags/osm2pgsql/" rel="tag" title="see questions tagged 'osm2pgsql'">osm2pgsql</a>
<a class="post-tag tag-link-tileserver" href="/tags/tileserver/" rel="tag" title="see questions tagged 'tileserver'">tileserver</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>24 Jan '19, 14:00</strong>
</p>
<img alt="Erik1988osm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/5eabcf32b6244f650e286d308d9341e4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/16206/erik1988osm">Erik1988osm</a><br/>
<span class="score" title="21 reputation points">21</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Erik1988osm has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/67708/">
                edited
                <strong>24 Jan '19, 14:40</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67708">
</div>
<div class="comment-tools" id="comment-tools-67708">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67708-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    3 Answers:
                    </div>
<div class="tabsA"><a href="/questions/67708/are-there-optimized-fast-and-minimal-osmpbf-files-available-for-creating-a-tile-server?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/67708/are-there-optimized-fast-and-minimal-osmpbf-files-available-for-creating-a-tile-server?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/67708/are-there-optimized-fast-and-minimal-osmpbf-files-available-for-creating-a-tile-server?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/67708/are-there-optimized-fast-and-minimal-osmpbf-files-available-for-creating-a-tile-server?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="67711"></a>
<div class="answer accepted-answer" id="answer-container-67711">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67711/up/" id="post-67711-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67711-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/67711/down/" id="post-67711-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/67711/" rel="nofollow" title="Erik1988osm has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>One answer to the "cosmetic purposes only" part of the question might be to significantly cut down the data that load load into the database (which obviously will mean that it is smaller and will load quicker).  <a href="https://www.openstreetmap.org/user/SomeoneElse/diary/47027">This diary entry</a> and the one that it lnks to describe doing that for boundaries; you'd want to include a few more features I expect but the principal should still work.</p>
<p>It still might not be the best solution for what you want though; something involving tailored shapefiles might be better, and I'm sure there's a write-up of that somewhere.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67711/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>24 Jan '19, 14:46</strong>
</p>
<img alt="SomeoneElse's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0bf1aa22f7f5e045b0eb8beb79fe7907?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/387/someoneelse">SomeoneElse ♦</a><br/>
<span class="score" title="36866 reputation points"><span class="">36.9k</span></span><span title="71 badges"><span class="badge1">●</span><span class="badgecount">71</span></span><span title="370 badges"><span class="silver">●</span><span class="badgecount">370</span></span><span title="866 badges"><span class="bronze">●</span><span class="badgecount">866</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SomeoneElse has 228 accepted answers">16%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67711">
<a name="67713"></a>
<div class="comment" id="comment-67713">
<div class="comment-score" id="post-67713-score"></div>
<div class="comment-text"><p>Thank you. Am I right with my understanding, that osm.pbf files contain much more than just the graphical structure of the map?
Do the "shapefiles" (<a href="https://www.geofabrik.de/en/data/shapefiles.html)">https://www.geofabrik.de/en/data/shapefiles.html)</a> only contain the graphics? And if yes, can I somehow import just these in a postgresql to use with renderd afterwards? I guess for renderd to allow the query there must be at least the positioning data correlated with them to work properly. Do you know any hoster, which offer these minimalistic map graphic/position osm.pbf data?
As far as I can overlook your link, the changes are only made on the style, the backlaying data remains still unchanged (big and slow).</p></div>
<div class="comment-info" id="comment-67713-info">
<span class="comment-age">(24 Jan '19, 14:57)</span>
<a class="comment-user userinfo" href="/users/16206/erik1988osm">Erik1988osm</a>
</div>
</div>
<a name="67714"></a>
<div class="comment" id="comment-67714">
<div class="comment-score" id="post-67714-score"></div>
<div class="comment-text"><blockquote>
<p>Am I right with my understanding, that osm.pbf files contain much more than just the graphical structure of the map?</p>
</blockquote>
<p>Yes - the contain all the data in OSM, including many things that any particular map is unlikely to display.  However to be clear is is no one "the map" - there are lots of different representations of OSM data.  <a href="http://openwhatevermap.xyz/#3/28.00/18.00">This</a> is a fun map showing lots of different map styles.</p>
<p>"Shapefile" is just a file format, just as .osm.pbf is, and the page you link to explains a bit about what Geofabrik have put in their shapefiles.</p>
<blockquote>
<p>As far as I can overlook your link, the changes are only made on the style, the backlaying data remains still unchanged (big and slow).</p>
</blockquote>
<p>No, as the linked diary entry says "for boundaries I created a version of that that used osmium, osmconvert and osmfilter to select only boundaries from the data and remove non-boundary tags that might render too".</p></div>
<div class="comment-info" id="comment-67714-info">
<span class="comment-age">(24 Jan '19, 15:05)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="67716"></a>
<div class="comment" id="comment-67716">
<div class="comment-score" id="post-67716-score"></div>
<div class="comment-text"><p>Right. So what my solution would be is to not modify the style, as I did to hide certain thinks like name tags, banner etc., but to use osmfilter on a planet.osm.pbf and only keep certain informations of interest. This would probably lead into a way smaller file (?). But I wonder if I could still apply a style to it, since some fields would be missing. Does the osm2pgsql just skip those?</p></div>
<div class="comment-info" id="comment-67716-info">
<span class="comment-age">(24 Jan '19, 15:20)</span>
<a class="comment-user userinfo" href="/users/16206/erik1988osm">Erik1988osm</a>
</div>
</div>
<a name="67717"></a>
<div class="comment" id="comment-67717">
<div class="comment-score" id="post-67717-score"></div>
<div class="comment-text"><blockquote>
<p>But I wonder if I could still apply a style to it, since some fields would be missing. Does the osm2pgsql just skip those?</p>
</blockquote>
<p>It depends - you do have the option to cut down the columns created in the database at data load (using a "style" file), and if you do that then yes, a rendering style that expects those columns to be present will give errors.  You do however have the option to create all the columns and just not load data into them - that shouldn't cause the renderer to fail.</p>
<p>Given that you want a map that looks different to the OSM Carto one, you probably want to experiment with modifying the style as well.</p></div>
<div class="comment-info" id="comment-67717-info">
<span class="comment-age">(24 Jan '19, 15:40)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="67719"></a>
<div class="comment" id="comment-67719">
<div class="comment-score" id="post-67719-score"></div>
<div class="comment-text"><p>Thank you very much for your help, it made certain things clear to me. I created a summary below on what steps are necessary, as far as I understood for now.</p></div>
<div class="comment-info" id="comment-67719-info">
<span class="comment-age">(24 Jan '19, 15:50)</span>
<a class="comment-user userinfo" href="/users/16206/erik1988osm">Erik1988osm</a>
</div>
</div>
<a name="67720"></a>
<div class="comment not_top_scorer" id="comment-67720">
<div class="comment-score" id="post-67720-score"></div>
<div class="comment-text"><p>Can you explain what you mean with tailored shapefiles a little more in detail?</p></div>
<div class="comment-info" id="comment-67720-info">
<span class="comment-age">(24 Jan '19, 16:02)</span>
<a class="comment-user userinfo" href="/users/16206/erik1988osm">Erik1988osm</a>
</div>
</div>
<a name="67722"></a>
<div class="comment not_top_scorer" id="comment-67722">
<div class="comment-score" id="post-67722-score"></div>
<div class="comment-text"><blockquote>
<p>Can you explain what you mean with tailored shapefiles a little more in detail?</p>
</blockquote>
<p>One of the more GIS people here is probably better placed to do that, but essentially a shapefile is just a file format.  The page you linked to before offers special purpose shapefiles for e.g. power infrastructure, for example.  There may be someone out there creating "minimal" shapefiles for just major roads, towns, that sort of thing.</p></div>
<div class="comment-info" id="comment-67722-info">
<span class="comment-age">(24 Jan '19, 17:04)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-67711">
<span class="comments-showing">
            showing 5 of 7
        </span>
<a class="show-all-comments-link" href="#">show 2 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67711-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="67710"></a>
<div class="answer" id="answer-container-67710">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67710/up/" id="post-67710-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67710-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/67710/down/" id="post-67710-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Re "doing it automatically" <a href="https://www.openstreetmap.org/user/SomeoneElse/diary/45070">this diary entry</a> describes how to do it all using Docker.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67710/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>24 Jan '19, 14:22</strong>
</p>
<img alt="SomeoneElse's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0bf1aa22f7f5e045b0eb8beb79fe7907?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/387/someoneelse">SomeoneElse ♦</a><br/>
<span class="score" title="36866 reputation points"><span class="">36.9k</span></span><span title="71 badges"><span class="badge1">●</span><span class="badgecount">71</span></span><span title="370 badges"><span class="silver">●</span><span class="badgecount">370</span></span><span title="866 badges"><span class="bronze">●</span><span class="badgecount">866</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SomeoneElse has 228 accepted answers">16%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67710">
</div>
<div class="comment-tools" id="comment-tools-67710">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67710-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="67718"></a>
<div class="answer answered-by-owner" id="answer-container-67718">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67718/up/" id="post-67718-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67718-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/67718/down/" id="post-67718-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>As a summary to what my understanding was, the following steps will lead to a custom file, reduced in its size (and with this probably raise the performance as well):</p>
<ol>
<li>Get a planet.osm.pbf</li>
<li>
<p>Examine the file, to get knowledge about the field names you require: </p>
<p>./osmfilter bremen.o5m --out-count</p>
<pre><code>  28199 highway
  22794 building
  21365 name
  18754 created_by
  17751 source
  11842 addr:housenumber
  11835 addr:street
   5925 addr:postcode
   5724 foot
   5543 addr:city
</code></pre>
</li>
<li>
<p>Apply the filter</p>
<p>./osmfilter norway.osm --keep="highway=primary =secondary waterway=river" &gt;streets.osm</p>
</li>
<li>
<p>Convert the output file with osmconvert if necessary</p>
</li>
<li>
<p>Update your style xml (?)</p>
</li>
<li>
<p>Import the custom file with osm2pgsql</p>
</li>
</ol>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67718/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>24 Jan '19, 15:49</strong>
</p>
<img alt="Erik1988osm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/5eabcf32b6244f650e286d308d9341e4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/16206/erik1988osm">Erik1988osm</a><br/>
<span class="score" title="21 reputation points">21</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Erik1988osm has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/67718/">
                edited
                <strong>24 Jan '19, 15:51</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67718">
</div>
<div class="comment-tools" id="comment-tools-67718">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67718-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/67708/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="L1y0qtdD6IWuXKib4kV54AEMxyj1CdNp"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>