<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/44392/how-do-i-make-a-reliable-high-performance-production-tile-server">How do I make a reliable, high performance production tile server?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/44392/up/" id="post-44392-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-44392-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/44392/down/" id="post-44392-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/44392/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I have my own OSM tile server that I set up following the instructions (with local changes) on switch2osm here: <a href="https://switch2osm.org/serving-tiles/manually-building-a-tile-server-14-04/">https://switch2osm.org/serving-tiles/manually-building-a-tile-server-14-04/</a></p>
<p>It's hosted on "the cloud", including using an iSCSI drive for the data. Recently, a network error caused the disk to crash. Luckily, we could save it, but the server was down for a day. Now I am looking to improve the situation to provide better service in 2 respects:</p>
<ol>
<li>Reduced risk of long downtime</li>
<li>Better performance</li>
</ol>
<p>As you can imagine, the performance for creating tiles is not great. Sometimes it takes HOURS. We also want to start using the tile server in production and cannot reasonably allow days of downtime.</p>
<p>Are there any reference setups, best practices, etc.?
Anyone want to share their hardware configuration?</p>
<p>We have thought of a few options:</p>
<ol>
<li>Upgrading the server to use local SSD storage. Provide backup/restore mechanism that would have downtime of a few hours in case of hard disk or server crash.</li>
<li>Similar to above but with 2 load balanced servers. This would be twice as expensive but would reduce downtime significantly</li>
<li>Provide RAID on the local hard disks. I'm not sure this pays for itself. Am I wrong?</li>
<li>Keep a low performance, low reliability tile server, but put a cache server (or several) in front of it. Precompute all of the tiles. Should the tile server die, the cache server would continue serving tiles until the tile server could be rebuilt (which takes weeks).</li>
</ol>
<p>Any and all opinions, recommendations, and details would be welcome!</p>
<p>Thanks,
Harold Ship</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-caching" href="/tags/caching/" rel="tag" title="see questions tagged 'caching'">caching</a>
<a class="post-tag tag-link-performance" href="/tags/performance/" rel="tag" title="see questions tagged 'performance'">performance</a>
<a class="post-tag tag-link-tileserver" href="/tags/tileserver/" rel="tag" title="see questions tagged 'tileserver'">tileserver</a>
<a class="post-tag tag-link-rendering" href="/tags/rendering/" rel="tag" title="see questions tagged 'rendering'">rendering</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>23 Jul '15, 16:13</strong>
</p>
<img alt="haroldship1's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/7111e460b42d95ecc8f802215e342cd3?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/11100/haroldship1">haroldship1</a><br/>
<span class="score" title="26 reputation points">26</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="haroldship1 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/44392/">
                edited
                <strong>23 Jul '15, 16:16</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-44392">
</div>
<div class="comment-tools" id="comment-tools-44392">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-44392-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/44392/how-do-i-make-a-reliable-high-performance-production-tile-server?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/44392/how-do-i-make-a-reliable-high-performance-production-tile-server?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/44392/how-do-i-make-a-reliable-high-performance-production-tile-server?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/44392/how-do-i-make-a-reliable-high-performance-production-tile-server?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="44395"></a>
<div class="answer" id="answer-container-44395">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/44395/up/" id="post-44395-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-44395-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/44395/down/" id="post-44395-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Local SSD is a must. You haven't said if you're running a world-wide server or just a regional one. Precomputing <em>all</em> tiles world-wide is not feasible. You'd usually pre-compute z0-12 or 0-13 and then render the rest on-demand. Having multiple identical servers helps against server failure, but you might also get away with having a "clone" of the main server that keeps only the rendering database and not the update tables, so if the main server fails the clone can at least produce tiles, just not update them. </p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/44395/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>23 Jul '15, 16:57</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-44395">
<a name="44405"></a>
<div class="comment" id="comment-44405">
<div class="comment-score" id="post-44405-score">1</div>
<div class="comment-text"><p>And iSCSI is just a terrible idea for both performance and reliability. Do not use iSCSI unless you can be very lax on both those criterias, or unless you're using software that is specifically tailored for this kind of hardware (Postgresql isn't).</p>
<p>I ignored that warning once and we paid that with cripling downtimes and limiting performance. We'll be glad when those servers get decomissioned this year.</p></div>
<div class="comment-info" id="comment-44405-info">
<span class="comment-age">(24 Jul '15, 10:50)</span>
<a class="comment-user userinfo" href="/users/867/vincent-de-phily">Vincent de P... ♦</a>
</div>
</div>
<a name="44431"></a>
<div class="comment" id="comment-44431">
<div class="comment-score" id="post-44431-score"></div>
<div class="comment-text"><p>Ok I will push for the SSD. When you say it's a must, do you mean for the DB or also for the tiles cache?</p></div>
<div class="comment-info" id="comment-44431-info">
<span class="comment-age">(26 Jul '15, 05:28)</span>
<a class="comment-user userinfo" href="/users/11100/haroldship1">haroldship1</a>
</div>
</div>
<a name="44432"></a>
<div class="comment" id="comment-44432">
<div class="comment-score" id="post-44432-score"></div>
<div class="comment-text"><p>Yes, we are trying to run the whole world, so precomputing up to say level 13 might be what we'll do. I guess if/once we have SSD we can re-evaluate the performance.</p></div>
<div class="comment-info" id="comment-44432-info">
<span class="comment-age">(26 Jul '15, 05:29)</span>
<a class="comment-user userinfo" href="/users/11100/haroldship1">haroldship1</a>
</div>
</div>
<a name="44433"></a>
<div class="comment" id="comment-44433">
<div class="comment-score" id="post-44433-score"></div>
<div class="comment-text"><p>Well, what happened for us was a network switch died and corrupted our iSCSI volume. So I guess I am also learning the hard way. Luckily fsck recovered it.</p></div>
<div class="comment-info" id="comment-44433-info">
<span class="comment-age">(26 Jul '15, 05:31)</span>
<a class="comment-user userinfo" href="/users/11100/haroldship1">haroldship1</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-44395">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-44395-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="44393"></a>
<div class="answer" id="answer-container-44393">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/44393/up/" id="post-44393-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-44393-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/44393/down/" id="post-44393-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Well, this doesn't seem to be an FAQ about OSM, but a need for server experts.</p>
<p>Have a look at <a href="http://wiki.openstreetmap.org/wiki/Commercial_OSM_Software_and_Services">Commercial_OSM_Software_and_Services</a> for instant advices.</p>
<p>After own internet seraching I only found:</p>
<p><a href="http://www.geofabrik.de/media/2012-09-08-osm2pgsql-performance.pdf">http://www.geofabrik.de/media/2012-09-08-osm2pgsql-performance.pdf</a></p>
<p>Some server hardware stuff is mentioned there.</p>
<p>Asking the guys from geofabrik directly about your aim cannot be bad.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/44393/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>23 Jul '15, 16:30</strong>
</p>
<img alt="stephan75's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/245b73d4390c3408fe3c6da759b9897f?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/99/stephan75">stephan75</a><br/>
<span class="score" title="12642 reputation points"><span class="">12.6k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="56 badges"><span class="silver">●</span><span class="badgecount">56</span></span><span title="210 badges"><span class="bronze">●</span><span class="badgecount">210</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="stephan75 has 37 accepted answers">6%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-44393">
<a name="44434"></a>
<div class="comment" id="comment-44434">
<div class="comment-score" id="post-44434-score"></div>
<div class="comment-text"><p>Thank you I'll use this to negotiate with the IT department.</p></div>
<div class="comment-info" id="comment-44434-info">
<span class="comment-age">(26 Jul '15, 05:32)</span>
<a class="comment-user userinfo" href="/users/11100/haroldship1">haroldship1</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-44393">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-44393-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/44392/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="ycojI9Yj058ohwXjoWVuwNCvla5lyyXj"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>