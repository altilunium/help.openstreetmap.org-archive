<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/36271/offline-jmapviewer">Offline JMapViewer</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/36271/up/" id="post-36271-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-36271-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/36271/down/" id="post-36271-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/36271/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Dear all,</p>
<p>Could you please advise me on the way I could use JMapViewer with stored map data (osm file or tiles extracted by Maperitive) for real-time gps tracking?</p>
<p>I have used the following code to set the tiles or osm source but this does not work:</p>
<pre><code>final JMapViewer map = new JMapViewer();

map.setTileSource(new OfflineOsmTileSource("file://c:/OpenStreetMap/", 1, 12));

where OfflineOsmTileSource class:

public class OfflineOsmTileSource extends AbstractOsmTileSource
 {

        private final int minZoom;
        private final int maxZoom;
        public OfflineOsmTileSource(String path, int minZoom, int maxZoom) {
        super("Offline from "+path, path);
        this.minZoom = minZoom;
        this.maxZoom = maxZoom;
        }
        @Override
        public int getMaxZoom() {
        return maxZoom;
        }
        @Override
        public int getMinZoom() {
        return minZoom;
        }
        @Override
        public TileUpdate getTileUpdate() {
        return TileUpdate.None;
        }
 }
</code></pre>
<p>Thanks in advance.</p>
<p>Best wishes</p>
<p>George</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-tiles" href="/tags/tiles/" rel="tag" title="see questions tagged 'tiles'">tiles</a>
<a class="post-tag tag-link-jmapviewer" href="/tags/jmapviewer/" rel="tag" title="see questions tagged 'jmapviewer'">jmapviewer</a>
<a class="post-tag tag-link-offlinemaps" href="/tags/offlinemaps/" rel="tag" title="see questions tagged 'offlinemaps'">offlinemaps</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>27 Aug '14, 13:31</strong>
</p>
<img alt="grccr's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/cc0b761f74da3a5662f41c0c444a3c85?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/9533/grccr">grccr</a><br/>
<span class="score" title="26 reputation points">26</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="grccr has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/36271/">
                edited
                <strong>27 Aug '14, 14:22</strong>
</a>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-36271">
<a name="36274"></a>
<div class="comment" id="comment-36274">
<div class="comment-score" id="post-36274-score">1</div>
<div class="comment-text"><p>Can you please explain what exactly "does not work"?</p></div>
<div class="comment-info" id="comment-36274-info">
<span class="comment-age">(27 Aug '14, 14:22)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="36275"></a>
<div class="comment" id="comment-36275">
<div class="comment-score" id="post-36275-score">1</div>
<div class="comment-text"><p>That URL definition looks wrong to me.  Does <a href="http://stackoverflow.com/questions/6098472/pass-a-local-file-in-to-url-in-java">this</a> help?</p></div>
<div class="comment-info" id="comment-36275-info">
<span class="comment-age">(27 Aug '14, 14:31)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="36276"></a>
<div class="comment not_top_scorer" id="comment-36276">
<div class="comment-score" id="post-36276-score"></div>
<div class="comment-text"><p>Thank you for your reply. The problem is that it fails to load the osm file or the tiles.
osm file: failed loading 3/3/1 c failed loading 3/5/2 c .......
tiles: failed loading 3/5/1 c failed loading 3/5/2 c  ......</p></div>
<div class="comment-info" id="comment-36276-info">
<span class="comment-age">(27 Aug '14, 14:36)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
<a name="36277"></a>
<div class="comment not_top_scorer" id="comment-36277">
<div class="comment-score" id="post-36277-score"></div>
<div class="comment-text"><p>I changed the argument to map.setTileSource(new OfflineOsmTileSource((new File("C:\OpenStreetMap").toURI().toURL()).toString(), 1, 12)); but the problem remains</p>
<p>output: failed loading 3/4/2 C:\OpenStreetMap\3\4\2.png (The system cannot find the path specified) .......
failed loading 3/4/3 C:\OpenStreetMap\3\4\3.png (The system cannot find the path specified)</p></div>
<div class="comment-info" id="comment-36277-info">
<span class="comment-age">(27 Aug '14, 14:47)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
<a name="36278"></a>
<div class="comment not_top_scorer" id="comment-36278">
<div class="comment-score" id="post-36278-score"></div>
<div class="comment-text"><p>What is the correct path for the tiles on your system?</p></div>
<div class="comment-info" id="comment-36278-info">
<span class="comment-age">(27 Aug '14, 14:53)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="36279"></a>
<div class="comment not_top_scorer" id="comment-36279">
<div class="comment-score" id="post-36279-score"></div>
<div class="comment-text"><p>The path is C:\OpenStreetMap</p></div>
<div class="comment-info" id="comment-36279-info">
<span class="comment-age">(27 Aug '14, 14:56)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
<a name="36280"></a>
<div class="comment not_top_scorer" id="comment-36280">
<div class="comment-score" id="post-36280-score"></div>
<div class="comment-text"><p>That's not the correct path according to your error message or it doesn't contain any tiles. Please search for files named "2.png" in C:\OpenStreetMap and compare the path with the one passed to <code>OfflineOsmTileSource</code>. Maybe there is another subdirectory you forgot to add?</p></div>
<div class="comment-info" id="comment-36280-info">
<span class="comment-age">(27 Aug '14, 15:00)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="36282"></a>
<div class="comment not_top_scorer" id="comment-36282">
<div class="comment-score" id="post-36282-score"></div>
<div class="comment-text"><p>Thank you for your time to help me.
Maybe I am using the wrong data to load.
I have made two attempts:
1) In the directory c:\openstreetmap I saved a map.osm file exported for the openstreetmap.org 
2) In the directory c:\openstreetmap I saved tiles generated from the above mentioned map.osm by Maperitive. In this case I have three main folders 17, 18, 19 and each of these folders contains other folders and each of these contains a .png file. I have noticed that next to the three folders there is a tiles.json file. Additionally there is no 2.png file as indicated by the error message.</p></div>
<div class="comment-info" id="comment-36282-info">
<span class="comment-age">(27 Aug '14, 15:23)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
<a name="36284"></a>
<div class="comment" id="comment-36284">
<div class="comment-score" id="post-36284-score">1</div>
<div class="comment-text"><p>I have no experience with JMapViewer but it seems like you just got the wrong zoom level. You only have subdirectories for zoom levels <em>17, 18, 19</em> but you are trying to open tiles for zoom level <em>3</em> (the first number in <em>3/4/2</em>). Try to generate tiles for all zoom levels (probably expensive) or set <code>minZoom</code> to <em>17</em> and <code>maxZoom</code> to <em>19</em>.</p></div>
<div class="comment-info" id="comment-36284-info">
<span class="comment-age">(27 Aug '14, 15:43)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="36285"></a>
<div class="comment not_top_scorer" id="comment-36285">
<div class="comment-score" id="post-36285-score"></div>
<div class="comment-text"><p>Thanks again for your help.
I just changed the zoom levels to 17-19 but the error remains.
output: failed loading 17/68800/44416 C:\OpenStreetMap\17\68800\44416.png (The system cannot find the path specified)
failed loading 17/68799/44416 C:\OpenStreetMap\17\68799\44416.png (The system cannot find the path specified)</p>
<p>There is no subfolder 68800 or 68799. The available subfolders are: 74685, 74686, 74687.
17/74685/51764.png
17/74685/51765.png
17/74686/61764.png
.
.
.</p></div>
<div class="comment-info" id="comment-36285-info">
<span class="comment-age">(27 Aug '14, 16:02)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
<a name="36290"></a>
<div class="comment" id="comment-36290">
<div class="comment-score" id="post-36290-score">1</div>
<div class="comment-text"><p>Then I assume you are looking at the wrong part of the map. For the current location there are no tiles present. Go to a location for which you have tiles generated by Maperitive.</p></div>
<div class="comment-info" id="comment-36290-info">
<span class="comment-age">(27 Aug '14, 16:30)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="36291"></a>
<div class="comment not_top_scorer" id="comment-36291">
<div class="comment-score" id="post-36291-score">1</div>
<div class="comment-text"><p>You are correct!
At the command map.setDisplayPositionByLatLon(lat, lon, zoom); I have to put a location inside the tiles I am loading and the correct zoom level(in my case 17/18/19) too.
Thank you so much for your help!
Best wishes
George</p></div>
<div class="comment-info" id="comment-36291-info">
<span class="comment-age">(27 Aug '14, 16:47)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
<a name="36292"></a>
<div class="comment" id="comment-36292">
<div class="comment-score" id="post-36292-score">2</div>
<div class="comment-text"><p>For those that are interested in JMapViewer the correct command for the tile source is :
map.setTileSource(new OfflineOsmTileSource((new File("C:\OpenStreetMap").toURI().toURL()).toString(), 17, 19));
Thank you all for your contribution!
Best wishes
George</p></div>
<div class="comment-info" id="comment-36292-info">
<span class="comment-age">(27 Aug '14, 16:56)</span>
<a class="comment-user userinfo" href="/users/9533/grccr">grccr</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-36271">
<span class="comments-showing">
            showing 5 of 13
        </span>
<a class="show-all-comments-link" href="#">show 8 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-36271-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<form action="/questions/36271/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="tGtpCnLSloKYi18yU88knLRkmMft1FYk"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>