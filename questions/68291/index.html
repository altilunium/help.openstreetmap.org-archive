<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/68291/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query">Given the OSM data for a state, find its area by writing a PostGIS query</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/68291/up/" id="post-68291-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-68291-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/68291/down/" id="post-68291-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/68291/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Apologies if this is a silly question, I'm very new to PostgreSQL/PostGIS.</p>
<p>I have downloaded an .osm file for the entire state of Baden-Württemberg from here - <a href="https://download.geofabrik.de/europe/germany/baden-wuerttemberg.html">https://download.geofabrik.de/europe/germany/baden-wuerttemberg.html</a></p>
<p>I have to answer the following questions, by writing queries for the same -</p>
<p>What is the area (expressed in m^2) of Baden-Württemberg? What is by area the smallest city of Baden-Württemberg? I have imported the osm file into a PostgreSQL using the osm2pgsql tool.</p>
<p>There seem to be multiple tables that are being created, core and generated by osm2pgsql. In addition to the core tables - planet_osm_nodes, planet_osm_ways and planet_osm_rels there are other tables as well, and I'm not quite sure how to use them to complete my tasks.</p>
<p>It would be really helpful if anybody could provide some insight into how I can go about writing the PostGIS query for the same.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-postgresql" href="/tags/postgresql/" rel="tag" title="see questions tagged 'postgresql'">postgresql</a>
<a class="post-tag tag-link-osm" href="/tags/osm/" rel="tag" title="see questions tagged 'osm'">osm</a>
<a class="post-tag tag-link-osm2pgsql" href="/tags/osm2pgsql/" rel="tag" title="see questions tagged 'osm2pgsql'">osm2pgsql</a>
<a class="post-tag tag-link-postgis" href="/tags/postgis/" rel="tag" title="see questions tagged 'postgis'">postgis</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>06 Mar '19, 10:21</strong>
</p>
<img alt="Sujay's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0f1df60051a6f0ba2d7aeaac57441c49?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/16371/sujay">Sujay</a><br/>
<span class="score" title="51 reputation points">51</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Sujay has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-68291">
<a name="68297"></a>
<div class="comment" id="comment-68297">
<div class="comment-score" id="post-68297-score"></div>
<div class="comment-text"><p>crossposts: <a href="https://stackoverflow.com/questions/55019529/given-the-osm-data-for-a-state-find-its-area">https://stackoverflow.com/questions/55019529/given-the-osm-data-for-a-state-find-its-area</a> and <a href="https://gis.stackexchange.com/questions/314541/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query">https://gis.stackexchange.com/questions/314541/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query</a></p></div>
<div class="comment-info" id="comment-68297-info">
<span class="comment-age">(06 Mar '19, 14:45)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-68291">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-68291-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/68291/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/68291/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/68291/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/68291/given-the-osm-data-for-a-state-find-its-area-by-writing-a-postgis-query?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="68292"></a>
<div class="answer accepted-answer" id="answer-container-68292">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/68292/up/" id="post-68292-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-68292-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/68292/down/" id="post-68292-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/68292/" rel="nofollow" title="Sujay has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Is it possible that you want us to do your homework for you? If you have been given these tasks in the context of a course or school assignment, then surely whoever gave you the tasks wants you to learn something from solving them. So here's some hints but not a full solution:</p>
<ul>
<li>administrative areas will be in the planet_osm_polygon table, and state and city boundaries can likely be identified looking at the "boundary" and "admin_level" tags</li>
<li>note that not all cities in Germany have an admin_level tag of 8!</li>
<li>the area of something can be computed with the ST_AREA PostGIS function, but</li>
<li>consider which projection your data has been imported in, and whether you might have to reproject it before invoking ST_AREA (also consider perhaps employing the GEOGRAPHY data type for best results)</li>
</ul>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/68292/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>06 Mar '19, 10:46</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-68292">
<a name="68293"></a>
<div class="comment" id="comment-68293">
<div class="comment-score" id="post-68293-score"></div>
<div class="comment-text"><p>Hi Frederik, thank you for the hints. I've been learning PostGIS for the past couple of days and am still new to it. I'm running against a deadline for the tasks and so I thought I'd post the question here. I'll write a query using ST_Area() and post it here when I'm done! Thanks again.</p></div>
<div class="comment-info" id="comment-68293-info">
<span class="comment-age">(06 Mar '19, 10:56)</span>
<a class="comment-user userinfo" href="/users/16371/sujay">Sujay</a>
</div>
</div>
<a name="68294"></a>
<div class="comment" id="comment-68294">
<div class="comment-score" id="post-68294-score"></div>
<div class="comment-text"><p>SELECT ST_Area(ST_Transform((SELECT way FROM planet_osm_polygon WHERE osm_id=-62611 AND way_area=1.68203e+007)), 4326)::geography)FROM planet_osm_polygon;</p>
<p>Can you tell me what seems to be the problem with this query?</p></div>
<div class="comment-info" id="comment-68294-info">
<span class="comment-age">(06 Mar '19, 11:15)</span>
<a class="comment-user userinfo" href="/users/16371/sujay">Sujay</a>
</div>
</div>
<a name="68295"></a>
<div class="comment" id="comment-68295">
<div class="comment-score" id="post-68295-score">1</div>
<div class="comment-text"><p>Do you get an error message? A bad result? No result?</p></div>
<div class="comment-info" id="comment-68295-info">
<span class="comment-age">(06 Mar '19, 11:48)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
<a name="68312"></a>
<div class="comment" id="comment-68312">
<div class="comment-score" id="post-68312-score"></div>
<div class="comment-text"><p>The query doesn't end. It doesn't seem right either. The geography object being passed to ST_Area() requires a polygon/multi-polygon to be passed to it. Can you tell me how I can isolate the polygon/multi-polygon for BW from planet_osm_nodes/planet_osm_point?</p></div>
<div class="comment-info" id="comment-68312-info">
<span class="comment-age">(07 Mar '19, 04:16)</span>
<a class="comment-user userinfo" href="/users/16371/sujay">Sujay</a>
</div>
</div>
<a name="68313"></a>
<div class="comment not_top_scorer" id="comment-68313">
<div class="comment-score" id="post-68313-score"></div>
<div class="comment-text"><p>I tried this query -</p>
<p>SELECT osm_id, way, ST_AsText(way), ST_IsValid(way), ST_IsEmpty(way)
   FROM planet_osm_polygon
      WHERE osm_id = -62611 AND way_area = '8.20869e+010';</p>
<p>Now I need to feed this Polygon to the ST_Area() function. Can you help me with this?</p></div>
<div class="comment-info" id="comment-68313-info">
<span class="comment-age">(07 Mar '19, 04:49)</span>
<a class="comment-user userinfo" href="/users/16371/sujay">Sujay</a>
</div>
</div>
<a name="68315"></a>
<div class="comment" id="comment-68315">
<div class="comment-score" id="post-68315-score">1</div>
<div class="comment-text"><p>Your second query works, but you can drop the "AND way_area..." since there should only be one polygon with osm_id = -62611 anyway. You can then use function calls in your SELECT, i.e. instead of "select way" you can write "select st_area(st_transform(way..." just like you did in your first query. The sub-select in your first query is unnecessary, you can do it with just one SELECT. If for any reason you have more than one polygons with osm_id = -62611 then you can add a SUM() around your ST_AREA to sum them all up.</p></div>
<div class="comment-info" id="comment-68315-info">
<span class="comment-age">(07 Mar '19, 09:29)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-68292">
<span class="comments-showing">
            showing 5 of 6
        </span>
<a class="show-all-comments-link" href="#">show 1 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-68292-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/68291/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="LtlGvJGAxkneYUTw3iqoYbyogfpUfxop"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>