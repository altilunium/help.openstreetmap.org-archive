<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/67517/querying-nominatim-from-java-class">querying nominatim from Java class</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67517/up/" id="post-67517-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67517-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/67517/down/" id="post-67517-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/67517/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello,</p>
<p>I'm trying to geocode some addresses querying Nominatim. If I enter one address like <a href="https://nominatim.openstreetmap.org/search.php?q=31+muntaner%2C+Barcelona%2C+Spain&amp;polygon_geojson=1&amp;viewbox=&amp;format=xml,">https://nominatim.openstreetmap.org/search.php?q=31+muntaner%2C+Barcelona%2C+Spain&amp;polygon_geojson=1&amp;viewbox=&amp;format=xml,</a> any web browser runs OK and I get the results.</p>
<p>But when trying to do the same from a Java class:</p>
<pre><code>URL u;
InputStream is = null;

u = new URL("https://nominatim.openstreetmap.org/search.php?q=31+muntaner%2C+Barcelona%2C+Spain&amp;polygon_geojson=1&amp;viewbox=&amp;format=xml");

is = u.openStream();
</code></pre>
<p>I always get a <code>ConnectionTimedOut</code> exception, and no results given.</p>
<p>Has anyone tried to do something similar with success? The timeout exception could be due to the absence on UsertAgent headers into the request? If so, what UserAgents are valid?</p>
<p>If somebody could post some code to query Nominatim from Java, I will greatly appreciate.</p>
<p>Thanks in advance,
Joan.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-java" href="/tags/java/" rel="tag" title="see questions tagged 'java'">java</a>
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-geocoding" href="/tags/geocoding/" rel="tag" title="see questions tagged 'geocoding'">geocoding</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>08 Jan '19, 21:22</strong>
</p>
<img alt="Joan%20Segura's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/1f761fbdd6a47871e98a460450e039e9?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/16128/joan-segura">Joan Segura</a><br/>
<span class="score" title="26 reputation points">26</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Joan Segura has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/67517/">
                edited
                <strong>09 Jan '19, 07:23</strong>
</a>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-67517">
</div>
<div class="comment-tools" id="comment-tools-67517">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67517-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/67517/querying-nominatim-from-java-class?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/67517/querying-nominatim-from-java-class?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/67517/querying-nominatim-from-java-class?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/67517/querying-nominatim-from-java-class?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="67518"></a>
<div class="answer" id="answer-container-67518">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67518/up/" id="post-67518-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67518-score" title="current number of votes">
    3
</div>
<a class="ajax-command post-vote down" href="/vote/67518/down/" id="post-67518-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The Java library likely uses a default user agent string. Set it to something unique. See second requirement on <a href="https://operations.osmfoundation.org/policies/nominatim/">https://operations.osmfoundation.org/policies/nominatim/</a></p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67518/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>08 Jan '19, 22:03</strong>
</p>
<img alt="mtmail's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/96aad1e1801b7ea36fba50687924c935?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/150/mtmail">mtmail</a><br/>
<span class="score" title="4757 reputation points"><span class="">4.8k</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="74 badges"><span class="bronze">●</span><span class="badgecount">74</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="mtmail has 50 accepted answers">27%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67518">
<a name="67520"></a>
<div class="comment" id="comment-67520">
<div class="comment-score" id="post-67520-score"></div>
<div class="comment-text"><p>Thanks for your answer mtmail. </p>
<p>I'm not using the osmapi from westnordost because when I've copied it into my project appeared a lot of dependencies I hadn't been able to solve. I was trying to open the URL directly.</p>
<p>Best regards.
Joan.</p></div>
<div class="comment-info" id="comment-67520-info">
<span class="comment-age">(08 Jan '19, 22:20)</span>
<a class="comment-user userinfo" href="/users/16128/joan-segura">Joan Segura</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-67518">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67518-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="67528"></a>
<div class="answer" id="answer-container-67528">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67528/up/" id="post-67528-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67528-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/67528/down/" id="post-67528-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>URL openStream does exactly what the name says, it returns an InputStream (over the underlying TCP connection) to the server in question. It doesn't do any of the bits and pieces of the HTTP protocol (which why you are simply seeing timeouts) and except if you want to do that yourself you are using the the wrong classes and methods.</p>
<p>Have a look at <a href="https://docs.oracle.com/javase/8/docs/api/java/net/HttpURLConnection.html">https://docs.oracle.com/javase/8/docs/api/java/net/HttpURLConnection.html</a></p>
<p>PS: ~~nowdays you would normally use the OkHttp library but as long as performance is not a concern there is no problem with being old fashioned.~~ OkHttp can no longer be recommended</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67528/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>09 Jan '19, 15:55</strong>
</p>
<img alt="SimonPoole's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ad2513d6f8e3d709d576ace900c12fa5?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2053/simonpoole">SimonPoole ♦</a><br/>
<span class="score" title="44667 reputation points"><span class="">44.7k</span></span><span title="13 badges"><span class="badge1">●</span><span class="badgecount">13</span></span><span title="326 badges"><span class="silver">●</span><span class="badgecount">326</span></span><span title="701 badges"><span class="bronze">●</span><span class="badgecount">701</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SimonPoole has 209 accepted answers">18%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/67528/">
                edited
                <strong>04 Apr '19, 18:37</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67528">
</div>
<div class="comment-tools" id="comment-tools-67528">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67528-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/67517/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="4tLnpkPKUwMxw0jybW6oVoCiEdldWbGa"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>