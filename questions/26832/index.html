<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/26832/get-next-x-adjacent-ways-from-current-way">Get next X adjacent ways from current way</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/26832/up/" id="post-26832-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-26832-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/26832/down/" id="post-26832-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/26832/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi</p>
<p>First let me say that I am fairy new to OSM and the Overpass api. So forgive my ignorance ;) </p>
<p>I'm working on a small private app where I want to get information about the road I am currently driving on. I am using the following query to get information about the road from the phones current location:</p>
<pre><code>&lt; osm-script&gt;
    &lt; query type="way"&gt;
        &lt; around lat="56.09383" lon="9.00309" radius="5"/&gt;
        &lt; has-kv k="highway"/&gt;
    &lt; /query&gt;
    &lt; union&gt;
        &lt; item /&gt;
        &lt; recurse type="way-node"/&gt;
    &lt; /union&gt;
    &lt; print order="quadtile"/&gt;
&lt; /osm-script&gt;
</code></pre>
<p>In the example above i get the way: "Midtjyske Motorvej" with ID=111435507
I am not sure if this is the best way to do it, but it seems to work quite good for now.</p>
<p>Because I do not want to query Overpass every single second, but still want the information to be rather accurate, I thought about trying to make the app make an educated guess about where I'm heading, and then cache some of this information locally.</p>
<p>So I want the app to query via the overpass API, and then find for example the next 10 adjacent ways (or the next x adjacent ways within a 2 KM radius) of the current way i'm driving on. If for instance I was driving south on the above road: "<a href="http://www.openstreetmap.org/browse/way/111435507">111435507</a>", the immediate next adjacent way would be: "<a href="http://www.openstreetmap.org/browse/way/111435449">111435449</a>", the next one would be: "<a href="http://www.openstreetmap.org/browse/way/111435478">111435478</a>" etc. Is it possible to create one query that can get all the adjacent ways like this?</p>
<p>I don't expect the API to handle direction/course, so I guess I will have to do that calculation my self, and figure out which end point of the way I want to start from - so to speak. But if it is possible, that would of course be great :)</p>
<p>Thanx in advance!</p>
<p>...Allan</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-overpassapi" href="/tags/overpassapi/" rel="tag" title="see questions tagged 'overpassapi'">overpassapi</a>
<a class="post-tag tag-link-overpass" href="/tags/overpass/" rel="tag" title="see questions tagged 'overpass'">overpass</a>
<a class="post-tag tag-link-ways" href="/tags/ways/" rel="tag" title="see questions tagged 'ways'">ways</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>28 Sep '13, 21:13</strong>
</p>
<img alt="as_dk's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/3eee8e523c27678a115c28127e5bad64?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/7482/as_dk">as_dk</a><br/>
<span class="score" title="26 reputation points">26</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="as_dk has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-26832">
</div>
<div class="comment-tools" id="comment-tools-26832">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-26832-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/26832/get-next-x-adjacent-ways-from-current-way?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/26832/get-next-x-adjacent-ways-from-current-way?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/26832/get-next-x-adjacent-ways-from-current-way?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/26832/get-next-x-adjacent-ways-from-current-way?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="32489"></a>
<div class="answer" id="answer-container-32489">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/32489/up/" id="post-32489-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-32489-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/32489/down/" id="post-32489-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Although it looks a bit weird this will give you the next 5 adjacent roads for way id 111435507.</p>
<pre><code>[bbox:{{bbox}}];
way(111435507);
(way(around:0)[highway~"."][highway!~"path|track|cycleway|footway"];(._;&gt;;))-&gt;.a;
(way(around:0)[highway~"."][highway!~"path|track|cycleway|footway"];(._;&gt;;))-&gt;.b;
(way(around:0)[highway~"."][highway!~"path|track|cycleway|footway"];(._;&gt;;))-&gt;.c;
(way(around:0)[highway~"."][highway!~"path|track|cycleway|footway"];(._;&gt;;))-&gt;.d;
(way(around:0)[highway~"."][highway!~"path|track|cycleway|footway"];(._;&gt;;))-&gt;.e;
(.a;.b;.c;.d;.e;);out;
</code></pre>
<p>Try it on <a href="http://overpass-turbo.eu/s/3ap">Overpass Turbo</a></p>
<p>Note that "around" has no concept of directly connected roads, so you will get some roads which are only crossing the motorway. You will have to manually filter those out in a post processing step.</p>
<p>Edit: Global bbox added to restrict your search to the area you're interested in. Otherwise really long ways will cause some far away data to be fetched.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/32489/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>21 Apr '14, 11:50</strong>
</p>
<img alt="mmd's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/264d84ab05b942224b05960903eba7a7?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/8708/mmd">mmd</a><br/>
<span class="score" title="5682 reputation points"><span class="">5.7k</span></span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="53 badges"><span class="silver">●</span><span class="badgecount">53</span></span><span title="88 badges"><span class="bronze">●</span><span class="badgecount">88</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="mmd has 44 accepted answers">37%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/32489/">
                edited
                <strong>25 Apr '14, 18:16</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-32489">
</div>
<div class="comment-tools" id="comment-tools-32489">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-32489-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="26866"></a>
<div class="answer" id="answer-container-26866">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/26866/up/" id="post-26866-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-26866-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/26866/down/" id="post-26866-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Silly question : the radius is one parameter in your current query (expressed in meters). Why simply not change this 'radius' from '5' to '2000' ?</p>
<p>Then you will retrieve all highways within the circle. Then you will have to build a function retrieving the nearest highway from the current phone position (this will depend how you store the geodata in your app but they are plenty of geo-libs doing this for you).</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/26866/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>30 Sep '13, 14:32</strong>
</p>
<img alt="Pieren's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0e92f2d89853fd4e04c4b40a921e519b?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/87/pieren">Pieren</a><br/>
<span class="score" title="9847 reputation points"><span class="">9.8k</span></span><span title="20 badges"><span class="badge1">●</span><span class="badgecount">20</span></span><span title="83 badges"><span class="silver">●</span><span class="badgecount">83</span></span><span title="157 badges"><span class="bronze">●</span><span class="badgecount">157</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Pieren has 34 accepted answers">15%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-26866">
<a name="26892"></a>
<div class="comment" id="comment-26892">
<div class="comment-score" id="post-26892-score"></div>
<div class="comment-text"><p>Thanks for the answer :)</p>
<p>I have of course already tried that and it also works fine. But I really want the response data to be as minimal as possible and only return what I need in order to save bandwidth on the mobile device. With a radius of 2km I get about 200Kb at the location in the previous message. Upping that to 5km gives 1Mb – still semi ok I guess. But in a bigger city like (55.703956,12.518066) I get 1Mb of data for only 2 km and 7mb with 5 Km. A lot of data when I know I will only need a small part of that in the current request.</p></div>
<div class="comment-info" id="comment-26892-info">
<span class="comment-age">(01 Oct '13, 16:04)</span>
<a class="comment-user userinfo" href="/users/7482/as_dk">as_dk</a>
</div>
</div>
<a name="26893"></a>
<div class="comment" id="comment-26893">
<div class="comment-score" id="post-26893-score"></div>
<div class="comment-text"><p>I really only want to get connecting (better word perhaps than adjacent ways I guess) ways, and nothing else. And preferably only ways at the endnodes, so I don’t get side roads etc.</p>
<p>I’m sorry I did not make that clear in my question.</p></div>
<div class="comment-info" id="comment-26893-info">
<span class="comment-age">(01 Oct '13, 16:04)</span>
<a class="comment-user userinfo" href="/users/7482/as_dk">as_dk</a>
</div>
</div>
<a name="26894"></a>
<div class="comment" id="comment-26894">
<div class="comment-score" id="post-26894-score">1</div>
<div class="comment-text"><p>You can edit and improve your question at any time. I'm surprised by the size of the data. Perhaps the radius should vary with the speed. In urban and dense areas, the speed is necessarily smaller than in country side.</p></div>
<div class="comment-info" id="comment-26894-info">
<span class="comment-age">(01 Oct '13, 16:36)</span>
<a class="comment-user userinfo" href="/users/87/pieren">Pieren</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-26866">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-26866-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/26832/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="TxEaK6kgvEHqUXZyUa3bXd8pBGk06Jf2"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>