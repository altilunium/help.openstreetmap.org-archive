<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/68204/how-to-get-always-a-city-from-gps-coordinates">How to get ALWAYS a city from GPS coordinates?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/68204/up/" id="post-68204-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-68204-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/68204/down/" id="post-68204-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/68204/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello, I have a GPS coordinates list and I want to retrieve the corrisponding cities.</p>
<p>I'm making calls to Nominatim service, like this: <a href="https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=30.4573699&amp;lon=-97.8247654">https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=30.4573699&amp;lon=-97.8247654</a></p>
<p>The response in this case is:</p>
<pre><code>{"place_id":"32590342","licence":"Data © OpenStreetMap contributors, ODbL 1.0. <a href="https://osm.org/copyright">https://osm.org/copyright","osm_type":"node","osm_id":"2785042716","lat":"30.4573699","lon":"-97.8247654","display_name":"Nagoya</a> Steak &amp; Sushi, 11630, RM 620, Anderson Mill, Austin, Williamson County, Texas, 78713, USA","address":{"restaurant":"Nagoya Steak &amp; Sushi","house_number":"11630","road":"RM 620","neighbourhood":"Anderson Mill","city":"Austin","county":"Williamson County","state":"Texas","postcode":"78713","country":"USA","country_code":"us"},"boundingbox":["30.4572699","30.4574699","-97.8248654","-97.8246654"]}
</code></pre>
<p>So I can just get the value of <code>city</code> property and obtain the city.
What about getting the city when the response doesn't have <code>city</code> property?</p>
<p>According to <a href="https://help.openstreetmap.org/questions/61683/all-possible-fields-of-address-object">this answer</a>, I see that I can get other properties, such as <code>town</code>, <code>village</code>, <code>suburb</code>, <code>locality</code>, <code>hamlet</code> and so on... but what is the best? If Nominatim response doesn't have <code>city</code> what property should I look for? And if even that property doesn't appear what should be the next property to try to get the value from?</p>
<p>Can you make a list of these properties, ordered by frequency or relevance?</p>
<p>In addition, what about places that doesn't have any address property? Here is some examples:</p>
<p><a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=19.2954697&amp;lon=-99.1545323">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=19.2954697&amp;lon=-99.1545323</a>
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=28.7146224&amp;lon=77.1577398">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=28.7146224&amp;lon=77.1577398</a>
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=33.2038405&amp;lon=-96.7436876">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=33.2038405&amp;lon=-96.7436876</a>
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=28.7131567&amp;lon=77.1466021">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=28.7131567&amp;lon=77.1466021</a>
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=32.2327348&amp;lon=-81.4502764">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=32.2327348&amp;lon=-81.4502764</a>
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=35.851869&amp;lon=-79.0196451">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=35.851869&amp;lon=-79.0196451</a>
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=19.3709484&amp;lon=-99.1666932">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=19.3709484&amp;lon=-99.1666932</a>
<a href="https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=51.6185115&amp;lon=-0.7130883">https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=51.6185115&amp;lon=-0.7130883</a></p>
<p>How to deal with them?</p>
<p>Generally speaking, what is the best strategy to ALWAYS get a city from GPS coordinates?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-city" href="/tags/city/" rel="tag" title="see questions tagged 'city'">city</a>
<a class="post-tag tag-link-reversegeocoding" href="/tags/reversegeocoding/" rel="tag" title="see questions tagged 'reversegeocoding'">reversegeocoding</a>
<a class="post-tag tag-link-coordinates" href="/tags/coordinates/" rel="tag" title="see questions tagged 'coordinates'">coordinates</a>
<a class="post-tag tag-link-address" href="/tags/address/" rel="tag" title="see questions tagged 'address'">address</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>01 Mar '19, 16:24</strong>
</p>
<img alt="Andreanovenove's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/50334ab2e351e4f5af1917f7f6ef8dc8?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/9763/andreanovenove">Andreanovenove</a><br/>
<span class="score" title="126 reputation points">126</span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="11 badges"><span class="silver">●</span><span class="badgecount">11</span></span><span title="18 badges"><span class="bronze">●</span><span class="badgecount">18</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Andreanovenove has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/68204/">
                edited
                <strong>02 Mar '19, 14:10</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-68204">
</div>
<div class="comment-tools" id="comment-tools-68204">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-68204-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/68204/how-to-get-always-a-city-from-gps-coordinates?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/68204/how-to-get-always-a-city-from-gps-coordinates?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/68204/how-to-get-always-a-city-from-gps-coordinates?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/68204/how-to-get-always-a-city-from-gps-coordinates?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="68206"></a>
<div class="answer accepted-answer" id="answer-container-68206">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/68206/up/" id="post-68206-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-68206-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/68206/down/" id="post-68206-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/68206/" rel="nofollow" title="Andreanovenove has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The ALWAYS isn't possible. You might get close, but unless you change the definition of city you have to deal with empty data in your data model.</p>
<ul>
<li>
<p>Not every place (or address) in the world is assigned to a city. People living on small islands will use the name of the island as logical administrative label in their address, it doesn't make it a city.</p>
</li>
<li>
<p>A city can be multiple types of place. Especially large metropolitan areas are often both city and county, sometimes city and state (Berlin), sometimes city and country (Monaco). OSM data only allows setting one type. In rare cases two places exist in OSM data overlapping each other (same exact boundaries).</p>
</li>
<li>
<p>OSM data might be missing (explicit) assignments of streets to their city (e.g. with address tagging) or OSM data doesn't contain boundaries of a city. Other than guessing by distance it's unclear where some houses belong to.</p>
</li>
<li>
<p>Nominatim might not return the city field correctly. When a place exists as node tagged a city, but also relation (same name and/or linked) tagged a village it might return it as village. There's open issues e.g. with London boroughs, Paris Arrondissements and quarters.</p>
</li>
</ul>
<p><a href="https://wiki.openstreetmap.org/wiki/Key:place">https://wiki.openstreetmap.org/wiki/Key:place</a> lists the place types and the right columns of the table have global counts. <a href="https://github.com/OpenCageData/address-formatting/blob/master/conf/components.yaml">https://github.com/OpenCageData/address-formatting/blob/master/conf/components.yaml</a> has a hierarchy of fields relevant for an address. <a href="https://github.com/openstreetmap/Nominatim/blob/master/lib/ClassTypes.php">https://github.com/openstreetmap/Nominatim/blob/master/lib/ClassTypes.php</a> is Nominatim's internal logic to assign field names.</p>
<p>I would use the components.yaml, look for city aliases and if empty in the Nominatim response move up the hierarchy (county, state...).</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/68206/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>01 Mar '19, 17:04</strong>
</p>
<img alt="mtmail's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/96aad1e1801b7ea36fba50687924c935?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/150/mtmail">mtmail</a><br/>
<span class="score" title="4757 reputation points"><span class="">4.8k</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="74 badges"><span class="bronze">●</span><span class="badgecount">74</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="mtmail has 50 accepted answers">27%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-68206">
<a name="68219"></a>
<div class="comment" id="comment-68219">
<div class="comment-score" id="post-68219-score"></div>
<div class="comment-text"><p>Thank you for your reply, I really appreciated it.
Can you tell me what is wrong with places like this <a href="https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=51.6185115&amp;lon=-0.7130883">https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=51.6185115&amp;lon=-0.7130883</a> ? As you can see the only reference for place is country! Why?</p></div>
<div class="comment-info" id="comment-68219-info">
<span class="comment-age">(02 Mar '19, 14:13)</span>
<a class="comment-user userinfo" href="/users/9763/andreanovenove">Andreanovenove</a>
</div>
</div>
<a name="68220"></a>
<div class="comment" id="comment-68220">
<div class="comment-score" id="post-68220-score">1</div>
<div class="comment-text"><p>That might be an issue with the Nominatim logic. Can happen in remote areas (no addresses in 20+ km radius or such) but shouldn't happen in dense populated areas. Add &amp;zoom=16 to the URL since you said you don't need housenumber level data. Even zoom=10 might work for you. The parameter is explained here <a href="http://nominatim.org/release-docs/latest/api/Reverse/">http://nominatim.org/release-docs/latest/api/Reverse/</a></p></div>
<div class="comment-info" id="comment-68220-info">
<span class="comment-age">(02 Mar '19, 22:44)</span>
<a class="comment-user userinfo" href="/users/150/mtmail">mtmail</a>
</div>
</div>
<a name="68232"></a>
<div class="comment" id="comment-68232">
<div class="comment-score" id="post-68232-score"></div>
<div class="comment-text"><p>It doesn't do the trick. I get "city" with default zoom (18) from here <a href="https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=52.5332647&amp;lon=13.2065231,">https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=52.5332647&amp;lon=13.2065231,</a> but not with zoom 10. Besides, I get no city, at any zoom level, with other GPS coordinates, like this <a href="https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=-1.8292911&amp;lon=99.2568908">https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=-1.8292911&amp;lon=99.2568908</a></p></div>
<div class="comment-info" id="comment-68232-info">
<span class="comment-age">(03 Mar '19, 16:40)</span>
<a class="comment-user userinfo" href="/users/9763/andreanovenove">Andreanovenove</a>
</div>
</div>
<a name="68234"></a>
<div class="comment" id="comment-68234">
<div class="comment-score" id="post-68234-score"></div>
<div class="comment-text"><p>OpenStreetMap doesn't have enough data for that area. There isn't even a street mapped yet. <a href="https://nominatim.openstreetmap.org/reverse?format=html&amp;lat=-1.8292911&amp;lon=99.2568908">https://nominatim.openstreetmap.org/reverse?format=html&amp;lat=-1.8292911&amp;lon=99.2568908</a></p></div>
<div class="comment-info" id="comment-68234-info">
<span class="comment-age">(03 Mar '19, 17:12)</span>
<a class="comment-user userinfo" href="/users/150/mtmail">mtmail</a>
</div>
</div>
<a name="68235"></a>
<div class="comment" id="comment-68235">
<div class="comment-score" id="post-68235-score"></div>
<div class="comment-text"><p>Ok, I see. What do you think about the first link? Giving different zoom level doesn't always do the trick. Sometimes is convenient to use default zoom because level 10 doesn't return any city field, other times is better to use other zoom level, like 10, to get the city because default level doesn't contains any city field. So, there isn't a rule that I can follow to retrieve always an address field that is city or similar (similar administrative level).</p></div>
<div class="comment-info" id="comment-68235-info">
<span class="comment-age">(03 Mar '19, 19:10)</span>
<a class="comment-user userinfo" href="/users/9763/andreanovenove">Andreanovenove</a>
</div>
</div>
<a name="68236"></a>
<div class="comment not_top_scorer" id="comment-68236">
<div class="comment-score" id="post-68236-score"></div>
<div class="comment-text"><p>Berlin is one of cases with conflicting information. <a href="https://www.openstreetmap.org/node/240109189">https://www.openstreetmap.org/node/240109189</a> is tagged as both admin_level=2 (state) and place=city and that confused the reverse geocoding.</p></div>
<div class="comment-info" id="comment-68236-info">
<span class="comment-age">(03 Mar '19, 20:09)</span>
<a class="comment-user userinfo" href="/users/150/mtmail">mtmail</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-68206">
<span class="comments-showing">
            showing 5 of 6
        </span>
<a class="show-all-comments-link" href="#">show 1 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-68206-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/68204/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="TkdfEA0HxmbAxO5RaGdchIfEUTIKBGzA"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>