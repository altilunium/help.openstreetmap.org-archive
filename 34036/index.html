<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/34036/tiles-taking-too-long-to-render-on-my-tile-server">Tiles taking too long to render on my tile server</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/34036/up/" id="post-34036-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-34036-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/34036/down/" id="post-34036-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/34036/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello,</p>
<p>I've followed the tutorial available <a href="http://switch2osm.org/serving-tiles/manually-building-a-tile-server-12-04/" title="Manually building a tile server">here</a>. The installation worked alright, but opening the tile in a browser leads to a 404 error. The only error from the server is "Failed to read cmd on fd 10".</p>
<p>After a long while, the tile is rendered (here, 1600 seconds):</p>
<p>renderd[18586]: DEBUG: DONE TILE default 13 4264-4271 2984-2991 in 1594.968 seconds
debug: Creating and writing a metatile to /var/lib/mod_tile/default/13/0/16/11/170/136.meta</p>
<p>How can I solve this problem?</p>
<p>Thank you for your help. Regards, Alex.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-mod_tile" href="/tags/mod_tile/" rel="tag" title="see questions tagged 'mod_tile'">mod_tile</a>
<a class="post-tag tag-link-mapnik" href="/tags/mapnik/" rel="tag" title="see questions tagged 'mapnik'">mapnik</a>
<a class="post-tag tag-link-tileserver" href="/tags/tileserver/" rel="tag" title="see questions tagged 'tileserver'">tileserver</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>17 Jun '14, 16:32</strong>
</p>
<img alt="ale42's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/f36ee4312cb91587eed59341e9761d18?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/9046/ale42">ale42</a><br/>
<span class="score" title="41 reputation points">41</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="ale42 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/34036/">
                edited
                <strong>17 Jun '14, 22:51</strong>
</a>
</p>
<img alt="aseerel4c26's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/66f0dc05b44574e3894be07b0b37cf37?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/5179/aseerel4c26">aseerel4c26 ♦</a><br/>
<span class="score" title="32615 reputation points"><span class="">32.6k</span></span><span title="18 badges"><span class="badge1">●</span><span class="badgecount">18</span></span><span title="248 badges"><span class="silver">●</span><span class="badgecount">248</span></span><span title="554 badges"><span class="bronze">●</span><span class="badgecount">554</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-34036">
</div>
<div class="comment-tools" id="comment-tools-34036">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-34036-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/34036/tiles-taking-too-long-to-render-on-my-tile-server?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/34036/tiles-taking-too-long-to-render-on-my-tile-server?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/34036/tiles-taking-too-long-to-render-on-my-tile-server?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/34036/tiles-taking-too-long-to-render-on-my-tile-server?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="34037"></a>
<div class="answer" id="answer-container-34037">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/34037/up/" id="post-34037-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-34037-score" title="current number of votes">
    4
</div>
<a class="ajax-command post-vote down" href="/vote/34037/down/" id="post-34037-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>You can increase the timeout in your mod_tile configuration, in your case a</p>
<p>ModTileMissingRequestTimeout 1800</p>
<p>would have made the browser wait for up to 1800 seconds instead of returning a 404 after a couple of seconds. </p>
<p>To achieve faster rendering, try one or a combination of the following: </p>
<ul>
<li>have your whole OSM database in RAM or on an SSD disk, or at least on a RAID-10 volume of spinning disks;</li>
<li>tune your database (depends on machine, memory, and PostGIS version - often toying with PostGIS memory settings can help);</li>
<li>create more indexes (temporarily activate PostGIS logging to find out which queries take most of the time, then create specific index for those);</li>
<li>modify your map style to make less expensive queries;</li>
<li>pre-render the tiles that you expect are likely to be viewed.</li>
</ul>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/34037/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>17 Jun '14, 16:41</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-34037">
<a name="34138"></a>
<div class="comment" id="comment-34138">
<div class="comment-score" id="post-34138-score"></div>
<div class="comment-text"><p>Thanks for your answer Fred.</p>
<p>I will try to put the whole OSM database in RAM.</p>
<p>About the error (Failed to read cmd on fd 10),have you any idea if it can influence the very long time to render tile? How can this be fix?</p>
<p>Tks, Alex.</p></div>
<div class="comment-info" id="comment-34138-info">
<span class="comment-age">(19 Jun '14, 12:50)</span>
<a class="comment-user userinfo" href="/users/9046/ale42">ale42</a>
</div>
</div>
<a name="34139"></a>
<div class="comment" id="comment-34139">
<div class="comment-score" id="post-34139-score">1</div>
<div class="comment-text"><p>For info I mentioned the "failed to read cmd" issue here:</p>
<p><a href="https://github.com/openstreetmap/mod_tile/issues/77">https://github.com/openstreetmap/mod_tile/issues/77</a></p>
<p>In my case it didn't have any adverse impact on serving tiles.</p></div>
<div class="comment-info" id="comment-34139-info">
<span class="comment-age">(19 Jun '14, 13:21)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
<a name="34140"></a>
<div class="comment" id="comment-34140">
<div class="comment-score" id="post-34140-score"></div>
<div class="comment-text"><p>Ok thanks for your answer.</p>
<p>I really don't understand why it's taking this long time to render these tiles.</p>
<p>I try to set up the same configuration on a virtual machine and it takes less than 5 seconds to render one tile. Here, I try this in a OVH server which is more powerfull. 
I really don't understand.</p></div>
<div class="comment-info" id="comment-34140-info">
<span class="comment-age">(19 Jun '14, 13:50)</span>
<a class="comment-user userinfo" href="/users/9046/ale42">ale42</a>
</div>
</div>
<a name="34143"></a>
<div class="comment" id="comment-34143">
<div class="comment-score" id="post-34143-score"></div>
<div class="comment-text"><p>In that case I would start by comparing things like CPU usage, memory (including swap!) usage and I/O load (via <code>iotop</code>) as well as I/O wait ("wa" in <code>top</code>) between those two systems.</p></div>
<div class="comment-info" id="comment-34143-info">
<span class="comment-age">(19 Jun '14, 14:05)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="34171"></a>
<div class="comment" id="comment-34171">
<div class="comment-score" id="post-34171-score"></div>
<div class="comment-text"><p>My configuration for the server is like this :
- RAM : 64 Go DDR ECC 1600 Mhz
- CPU : Intel Xeon E5-1620v2
- No SSD
- 2 disks x 2 To SATA3HGST Ent. 7K4000</p>
<p>So I don't think my configuration is a problem, isn't it?</p>
<p>I check PostgreSQL queries and these queries don't take more than 1 or 2 ms. So, put the whole database will not be usefull, isn't it?</p></div>
<div class="comment-info" id="comment-34171-info">
<span class="comment-age">(20 Jun '14, 09:31)</span>
<a class="comment-user userinfo" href="/users/9046/ale42">ale42</a>
</div>
</div>
<a name="42390"></a>
<div class="comment not_top_scorer" id="comment-42390">
<div class="comment-score" id="post-42390-score"></div>
<div class="comment-text"><p><a href="http://help.openstreetmap.org/users/9046/ale42">@ale42</a> did you resolve this? I have an <em>incredibly</em> slow tile server.</p></div>
<div class="comment-info" id="comment-42390-info">
<span class="comment-age">(16 Apr '15, 15:35)</span>
<a class="comment-user userinfo" href="/users/9344/haroldship">haroldship</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-34037">
<span class="comments-showing">
            showing 5 of 6
        </span>
<a class="show-all-comments-link" href="#">show 1 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-34037-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="34141"></a>
<div class="answer" id="answer-container-34141">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/34141/up/" id="post-34141-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-34141-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/34141/down/" id="post-34141-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Another possibility that could drastically slow down database access would be if for some reason the index creation process failed at import time?</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/34141/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>19 Jun '14, 13:54</strong>
</p>
<img alt="SomeoneElse's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0bf1aa22f7f5e045b0eb8beb79fe7907?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/387/someoneelse">SomeoneElse ♦</a><br/>
<span class="score" title="36866 reputation points"><span class="">36.9k</span></span><span title="71 badges"><span class="badge1">●</span><span class="badgecount">71</span></span><span title="370 badges"><span class="silver">●</span><span class="badgecount">370</span></span><span title="866 badges"><span class="bronze">●</span><span class="badgecount">866</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SomeoneElse has 228 accepted answers">16%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-34141">
<a name="34142"></a>
<div class="comment" id="comment-34142">
<div class="comment-score" id="post-34142-score">2</div>
<div class="comment-text"><p>How can I check that? Or rebuild it?</p></div>
<div class="comment-info" id="comment-34142-info">
<span class="comment-age">(19 Jun '14, 13:57)</span>
<a class="comment-user userinfo" href="/users/9046/ale42">ale42</a>
</div>
</div>
<a name="51759"></a>
<div class="comment" id="comment-51759">
<div class="comment-score" id="post-51759-score"></div>
<div class="comment-text"><p>To answer the first bit, when osm2pgsql completes it'll say something like "Osm2pgsql took 238s overall" (or much longer). It it doesn't say that, it hasn't finished, and indexes probably aren't created.</p></div>
<div class="comment-info" id="comment-51759-info">
<span class="comment-age">(28 Aug '16, 01:21)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-34141">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-34141-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/34036/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="YMQRwXnU3aVxiDXsrqlWogz4PkNaZSOa"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>