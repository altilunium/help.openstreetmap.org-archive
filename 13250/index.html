<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/13250/what-is-the-correct-projection-i-should-use-with-mapnik">What is the correct projection I should use with Mapnik?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/13250/up/" id="post-13250-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-13250-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/13250/down/" id="post-13250-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/13250/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello,</p>
<p>I'm trying to render tiles with a very simple stylesheet. For data feed I'm using OSM file extract from the planet dump. I've read Mapnik can handle OSM XML files with some limitations.</p>
<p>There are two problems:</p>
<ol>
<li>Long ways are not rendered.</li>
<li>All ways are distorted or displaced.</li>
</ol>
<p>You can see the result here: <a href="http://dev.ivanatora.info/roads/">http://dev.ivanatora.info/roads/</a> At least the big roads in these two layers "Roads" and "Roads tiles" should match. </p>
<p>The second one seems like a projection problem and I tried tons of different variants but in vain. Here is my latest stylesheet: <a href="http://dev.ivanatora.info/tests/mapnik_style.xml">http://dev.ivanatora.info/tests/mapnik_style.xml</a> I've tried also simplier things for srs - "+proj=merc +datum=WGS84" and "+proj=latlon +datum=WGS84". I think the data from the planet dump extract is in latlon projection, but something is not right...</p>
<p>I would really appreciate some insight.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-rendering" href="/tags/rendering/" rel="tag" title="see questions tagged 'rendering'">rendering</a>
<a class="post-tag tag-link-tiles" href="/tags/tiles/" rel="tag" title="see questions tagged 'tiles'">tiles</a>
<a class="post-tag tag-link-mapnik" href="/tags/mapnik/" rel="tag" title="see questions tagged 'mapnik'">mapnik</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>04 Jun '12, 17:45</strong>
</p>
<img alt="ivanatora's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ca446edd75e87c48db5dd850d9f394a9?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/191/ivanatora">ivanatora</a><br/>
<span class="score" title="2740 reputation points"><span class="">2.7k</span></span><span title="35 badges"><span class="badge1">●</span><span class="badgecount">35</span></span><span title="55 badges"><span class="silver">●</span><span class="badgecount">55</span></span><span title="68 badges"><span class="bronze">●</span><span class="badgecount">68</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="ivanatora has one accepted answer">7%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/13250/">
                edited
                <strong>04 Jun '12, 17:54</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-13250">
</div>
<div class="comment-tools" id="comment-tools-13250">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-13250-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/13250/what-is-the-correct-projection-i-should-use-with-mapnik?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/13250/what-is-the-correct-projection-i-should-use-with-mapnik?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/13250/what-is-the-correct-projection-i-should-use-with-mapnik?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/13250/what-is-the-correct-projection-i-should-use-with-mapnik?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="13254"></a>
<div class="answer accepted-answer" id="answer-container-13254">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/13254/up/" id="post-13254-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-13254-score" title="current number of votes">
    8
</div>
<a class="ajax-command post-vote down" href="/vote/13254/down/" id="post-13254-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/13254/" rel="nofollow" title="ivanatora has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>When rendering with Mapnik, you have an input projection and an output projection. The input projection is what your data is in, and has to be given in the <code>&lt;Layer&gt;</code> element. The output projection is what you want your map to be in, and is usually given in the <code>&lt;Map&gt;</code> element (but some client programs e.g. nik2img.py allow you to override that).</p>
<p>You likely want your map in Google Mercator projection so your <code>&lt;Map&gt;</code> element</p>
<pre><code>&lt;Map bgcolor="transparent" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=<a href="https://help.openstreetmap.org/users/2957/nullpointer">@null</a> +no_defs +over"&gt;
</code></pre>
<p>looks ok (but try writing srs="+init=epsg:3857" which should also work and is clearer).</p>
<p>Your <code>&lt;Layer&gt;</code> elements claims that the source data is in Mercator as well, but it isn't; this will lead to distorted rendering. Your source data, raw latitudes and longitudes from OSM, is in EPSG:4326, so you'll need something like this:</p>
<pre><code>&lt;Layer name="highways" status="on" srs="+init=epsg:4326"&gt;
</code></pre>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/13254/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>04 Jun '12, 18:37</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/13254/">
                edited
                <strong>29 Mar '17, 23:03</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-13254">
<a name="13265"></a>
<div class="comment" id="comment-13265">
<div class="comment-score" id="post-13265-score"></div>
<div class="comment-text"><p>Yep, it does make sense in that way and that was the problem. Thank you!</p></div>
<div class="comment-info" id="comment-13265-info">
<span class="comment-age">(05 Jun '12, 15:01)</span>
<a class="comment-user userinfo" href="/users/191/ivanatora">ivanatora</a>
</div>
</div>
<a name="55343"></a>
<div class="comment" id="comment-55343">
<div class="comment-score" id="post-55343-score">2</div>
<div class="comment-text"><p><a href="https://help.openstreetmap.org/users/104/frederik-ramm"></a><a href="https://help.openstreetmap.org/users/104/frederik-ramm">@frederik</a>-ramm I'm a little late to the party but the code above should be <code>srs="+init=epsg:4326"</code> shouldn't it?</p></div>
<div class="comment-info" id="comment-55343-info">
<span class="comment-age">(29 Mar '17, 22:12)</span>
<a class="comment-user userinfo" href="/users/13532/k-nut">k-nut</a>
</div>
</div>
<a name="55347"></a>
<div class="comment" id="comment-55347">
<div class="comment-score" id="post-55347-score"></div>
<div class="comment-text"><p>Indeed, I modified the answer. Thanks.</p></div>
<div class="comment-info" id="comment-55347-info">
<span class="comment-age">(29 Mar '17, 23:03)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-13254">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-13254-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/13250/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="H7GM5f8rPgVvYrIfnJXbqGiLRUIhLfZy"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>