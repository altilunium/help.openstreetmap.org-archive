<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/28784/nominatim-returning-wrong-city-names">nominatim returning wrong city names</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/28784/up/" id="post-28784-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-28784-score" title="current number of votes">
    3
</div>
<a class="ajax-command post-vote down" href="/vote/28784/down/" id="post-28784-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/28784/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I have a server running Nominatim 2.1 with data downloaded from <a href="http://download.geofabrik.de/">http://download.geofabrik.de/</a> and I noticed that on many occasions, the nominatim on my server is returning wrong city names. Sometimes, it's wrong AND also different from results from nominatim on nominatim.openstreetmap.org. </p>
<p>I also noticed that when the return city name is wrong, it often gets the city name from the county it's in. For instance, if the county name is "Santa Clara County", sometimes the city is incorrectly returned as "Santa Clara" (when it should've been "San Jose"). Below are examples where the returned city name is incorrect.</p>
<p><strong>Example 1 - wrong city (should've been "San Jose"):</strong></p>
<pre><code>{"place_id":"7866664",
"licence":"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. http:\/\/www.openstreetmap.org\/copyright",
"osm_type":"way",
"osm_id":"8965496",
"lat":"37.3175321691594",
"lon":"-121.788455885124",
"display_name":"D'Amico Drive, Santa Clara, Santa Clara County, California, 95148, United States of America",
"address":{
    "road":"D'Amico Drive",
    "city":"Santa Clara",
    "county":"Santa Clara County",
    "state":"California",
    "postcode":"95148",
    "country":"United States of America",
    "country_code":"us"}
}
</code></pre>
<p>Perhaps even more mind-boggling is the fact that sometimes, not only is the returned city wrong, but also different from the results from OSM nominatim. </p>
<p><strong>Example 2 - wrong city, and different results than nominatim.openstreetmap.org</strong></p>
<p>My nominatim:</p>
<pre><code>{"place_id":"22439557",
"licence":"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. http:\/\/www.openstreetmap.org\/copyright",
"osm_type":"way",
"osm_id":"60691604",
"lat":"37.3963095743164",
"lon":"-121.928365877892",
"display_name":"Zanker Road, Santa Clara, Santa Clara County, California, 95134, United States of America",
"address":{
    "road":"Zanker Road",
    "city":"Santa Clara",
    "county":"Santa Clara County",
    "state":"California",
    "postcode":"95134",
    "country":"United States of America",
    "country_code":"us"}
}
</code></pre>
<p>OSM nominatim:</p>
<pre><code>{"place_id":"55231842",
"licence":"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. http:\/\/www.openstreetmap.org\/copyright",
"osm_type":"way",
"osm_id":"60691604",
"lat":"37.4026925","lon":"-121.9337568",
"display_name":"Zanker Road, Alviso, San Jose, Santa Clara County, California, 95134, United States of America",
"address":{
    "road":"Zanker Road",
    "suburb":"Alviso",
    "city":"San Jose",
    "county":"Santa Clara County",
    "state":"California",
    "postcode":"95134",
    "country":"United States of America",
    "country_code":"us"}
}
</code></pre>
<p>Why is it returning the wrong city name? (everything else seems to be correct). Also, why are my results sometimes different from OSM nominatim? Do they use a different nominatim? or do they use different data?</p>
<p>Thanks in advance.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-osm" href="/tags/osm/" rel="tag" title="see questions tagged 'osm'">osm</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>04 Dec '13, 19:52</strong>
</p>
<img alt="baekacaek's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/61de868d7785f30711497cecbdddf5f4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/7476/baekacaek">baekacaek</a><br/>
<span class="score" title="176 reputation points">176</span><span title="12 badges"><span class="badge1">●</span><span class="badgecount">12</span></span><span title="13 badges"><span class="silver">●</span><span class="badgecount">13</span></span><span title="17 badges"><span class="bronze">●</span><span class="badgecount">17</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="baekacaek has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/28784/">
                edited
                <strong>04 Dec '13, 19:53</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-28784">
</div>
<div class="comment-tools" id="comment-tools-28784">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-28784-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/28784/nominatim-returning-wrong-city-names?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/28784/nominatim-returning-wrong-city-names?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/28784/nominatim-returning-wrong-city-names?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/28784/nominatim-returning-wrong-city-names?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="28826"></a>
<div class="answer" id="answer-container-28826">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/28826/up/" id="post-28826-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-28826-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/28826/down/" id="post-28826-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Nominatim wrongly matches 'Santa Clara' from the <code>tiger:county</code> tag against the city instead of the county because the county is called 'Santa Clara <em>County</em>'.
Quick-fix is to make sure that the place node of the county (which by convention comes without the County suffix) is included as a member <code>label</code> in the county relation, like <a href="http://www.openstreetmap.org/changeset/19286866">that</a>. Proper fix would be to resolve the issue in Nominatim but it might take a while to get that implemented.</p>
<p>If you run your own instance, you have to force an update of Santa Clara county as described in the comment of <a href="https://help.openstreetmap.org/questions/27544/sf-bay-area-city-names-in-nominatim">this question</a> after the changes have been applied.</p>
<p>Slightly longer explanation:</p>
<p>Nominatim collects for each object a number of potential address parts from interesting tags, among them <code>addr:*</code> tags and <code>tiger:county</code>. Problem is that it only retains the name not the type of object (a legacy from the days of the <code>is_in</code> tag). When collecting the places for the address it gives a slight preference to those that match exactly with any of these names. Most of the times that does the right thing but the County suffix confuses Nominatim. It really needs the county name without suffix to get the exact match. Adding the place node as a label to the relation will resolve exactly that. The suffix-less name is taken from the place node and will provide the exact match.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/28826/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>05 Dec '13, 15:30</strong>
</p>
<img alt="lonvia's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d888b712d85dee0aa304297f2dc697c7?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2921/lonvia">lonvia</a><br/>
<span class="score" title="6213 reputation points"><span class="">6.2k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="89 badges"><span class="bronze">●</span><span class="badgecount">89</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="lonvia has 43 accepted answers">40%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/28826/">
                edited
                <strong>06 Dec '13, 14:49</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-28826">
</div>
<div class="comment-tools" id="comment-tools-28826">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-28826-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/28784/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="0PWIgvlQE1U7bBkVtX7soCg9ZwqlMz0v"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>