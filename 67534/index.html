<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/67534/osm2pgsql-does-not-build-geometries-for-objects-with-dateline-crossing">osm2pgsql does not build geometries for objects with dateline crossing</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67534/up/" id="post-67534-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67534-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/67534/down/" id="post-67534-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/67534/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hello! I am trying to load a PBF dump of Russia into a PostgreSQL database using osm2pgsql. All works almost nice, but <em>planet_osm_polygon</em> table does not contain rows corresponding to objects situated in partly Eastern, partly Western Hemisphere, such as Chukotka Autonomous Okrug, Far Eastern Federal District and Russia itself. I checked this fact with the following query: </p>
<p><em>select * from planet_osm_polygon where boundary='administrative' and (admin_level='2' or admin_level='3' or admin_level='4') order by admin_level</em></p>
<p>All regions have been created successfully, but those 3 are absent. Here is my command for osm2pgsql to create the database:</p>
<p>osm2pgsql --create --database geo3 --slim -U postgres -E 4326 --style planet.style --hstore --multi-geometry -C 20000 --number-processes 2 -r pbf ru.osm.pbf</p>
<p>Could anyone please help me?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-antimeridian" href="/tags/antimeridian/" rel="tag" title="see questions tagged 'antimeridian'">antimeridian</a>
<a class="post-tag tag-link-osm2pgsql" href="/tags/osm2pgsql/" rel="tag" title="see questions tagged 'osm2pgsql'">osm2pgsql</a>
<a class="post-tag tag-link-geofabrik" href="/tags/geofabrik/" rel="tag" title="see questions tagged 'geofabrik'">geofabrik</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>10 Jan '19, 09:32</strong>
</p>
<img alt="molokanov's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/7e8e1b07b427abdbd7ba5e9403f87e01?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/16140/molokanov">molokanov</a><br/>
<span class="score" title="26 reputation points">26</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="molokanov has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/67534/">
                edited
                <strong>11 Jan '19, 11:51</strong>
</a>
</p>
<img alt="SimonPoole's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ad2513d6f8e3d709d576ace900c12fa5?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2053/simonpoole">SimonPoole ♦</a><br/>
<span class="score" title="44667 reputation points"><span class="">44.7k</span></span><span title="13 badges"><span class="badge1">●</span><span class="badgecount">13</span></span><span title="326 badges"><span class="silver">●</span><span class="badgecount">326</span></span><span title="701 badges"><span class="bronze">●</span><span class="badgecount">701</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-67534">
</div>
<div class="comment-tools" id="comment-tools-67534">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67534-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/67534/osm2pgsql-does-not-build-geometries-for-objects-with-dateline-crossing?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/67534/osm2pgsql-does-not-build-geometries-for-objects-with-dateline-crossing?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/67534/osm2pgsql-does-not-build-geometries-for-objects-with-dateline-crossing?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/67534/osm2pgsql-does-not-build-geometries-for-objects-with-dateline-crossing?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="67539"></a>
<div class="answer" id="answer-container-67539">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67539/up/" id="post-67539-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67539-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/67539/down/" id="post-67539-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>It isn't possible to represent objects crossing the dateline in WGS84 coordinates and OSM data does not contain any such objects (obvously).</p>
<p>All objects that "should" cross the dateline have been split. I would suggest turning on the data layer on openstreetmap.org and inspecting some of the objects near the dateline.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67539/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>11 Jan '19, 00:45</strong>
</p>
<img alt="SimonPoole's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ad2513d6f8e3d709d576ace900c12fa5?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2053/simonpoole">SimonPoole ♦</a><br/>
<span class="score" title="44667 reputation points"><span class="">44.7k</span></span><span title="13 badges"><span class="badge1">●</span><span class="badgecount">13</span></span><span title="326 badges"><span class="silver">●</span><span class="badgecount">326</span></span><span title="701 badges"><span class="bronze">●</span><span class="badgecount">701</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SimonPoole has 209 accepted answers">18%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/67539/">
                edited
                <strong>11 Jan '19, 00:48</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67539">
<a name="67540"></a>
<div class="comment" id="comment-67540">
<div class="comment-score" id="post-67540-score"></div>
<div class="comment-text"><p>I understand the fact that in WGS84 these objects are split by 180th meridian into two or more separate parts, some of them starting from 180W and other ending at 180E. Consider, for example, relation id 151231. OSM provides all necessary "vertical" ways along 180E and 180W longitudes that are members of this relation and which are performing this splitting and closing all resulting polygons. Apparently, a set of closed polygons can be used to create geometries for the whole relation and we can see this set of polygons if we simply request the relation in the browser: <a href="https://www.openstreetmap.org/relation/151231.">https://www.openstreetmap.org/relation/151231.</a> But my osm2pgsql doesn't build its geometry. How should I make osm2pgsql build it?</p></div>
<div class="comment-info" id="comment-67540-info">
<span class="comment-age">(11 Jan '19, 05:39)</span>
<a class="comment-user userinfo" href="/users/16140/molokanov">molokanov</a>
</div>
</div>
<a name="67541"></a>
<div class="comment" id="comment-67541">
<div class="comment-score" id="post-67541-score"></div>
<div class="comment-text"><p>I just checked my database, I have six entries in planet_osm_polygon for 151231 which looks about right. </p>
<p>You are looking for the negative id I hope?</p>
<p>As in </p>
<pre><code>select osm_id from planet_osm_polygon where osm_id=-151231;
</code></pre></div>
<div class="comment-info" id="comment-67541-info">
<span class="comment-age">(11 Jan '19, 06:33)</span>
<a class="comment-user userinfo" href="/users/2053/simonpoole">SimonPoole ♦</a>
</div>
</div>
<a name="67542"></a>
<div class="comment" id="comment-67542">
<div class="comment-score" id="post-67542-score"></div>
<div class="comment-text"><p>Exactly. I'm looking for osm_id=-151231 with the same query but, on the contrast, I have no entries. What can be the cause?</p></div>
<div class="comment-info" id="comment-67542-info">
<span class="comment-age">(11 Jan '19, 07:58)</span>
<a class="comment-user userinfo" href="/users/16140/molokanov">molokanov</a>
</div>
</div>
<a name="67543"></a>
<div class="comment not_top_scorer" id="comment-67543">
<div class="comment-score" id="post-67543-score"></div>
<div class="comment-text"><p>osm2pgsql version? And are the polygons in question unbroken in your input data? (I know that is difficult to determine)</p></div>
<div class="comment-info" id="comment-67543-info">
<span class="comment-age">(11 Jan '19, 08:18)</span>
<a class="comment-user userinfo" href="/users/2053/simonpoole">SimonPoole ♦</a>
</div>
</div>
<a name="67545"></a>
<div class="comment not_top_scorer" id="comment-67545">
<div class="comment-score" id="post-67545-score"></div>
<div class="comment-text"><p>osm2pgsql 0.96.0</p>
<p>To determine whether all polygons being formed with osm2pgsql are unbroken seems to be impossible. They are not saved in any database field. And members of the relation are ways which are obviously unclosed.</p>
<p>Instead, I did the following thing. I took the latest OSM dump for Russia, loaded it into PostgreSQL, the result is the same. I took all members of relation 151231 via downloadable XML file of the relation. Among the ways listed there, some of them are absent in planet_osm_line table. For example, 180th-meridian ways 239992373, 23820613 and especially border way 50752242. Does it necessarily mean that I have some polygons created by osm2pgsql unclosed?</p></div>
<div class="comment-info" id="comment-67545-info">
<span class="comment-age">(11 Jan '19, 08:54)</span>
<a class="comment-user userinfo" href="/users/16140/molokanov">molokanov</a>
</div>
</div>
<a name="67546"></a>
<div class="comment not_top_scorer" id="comment-67546">
<div class="comment-score" id="post-67546-score"></div>
<div class="comment-text"><p>Right now the suspicion is that there might be an issue with geometry building that crept in between 0.95 and 0.96 (it does seem a bit unlikely though).</p>
<p>I would like to investigate a couple of things before continuing here.</p></div>
<div class="comment-info" id="comment-67546-info">
<span class="comment-age">(11 Jan '19, 09:46)</span>
<a class="comment-user userinfo" href="/users/2053/simonpoole">SimonPoole ♦</a>
</div>
</div>
<a name="67547"></a>
<div class="comment" id="comment-67547">
<div class="comment-score" id="post-67547-score">1</div>
<div class="comment-text"><p>Can you check if the relevant ways from the antimeridian are in your database?</p>
<p>For example way 239992380 (in planet_osm_line).</p>
<p>Sorry I didn't see that you had already answered this.</p>
<p>In any case the issue is likely that extracts from geofabrik do not contain the antimerdian ways and osm2pgsql then obviously can't build the polygons, I tested with an extract of Fiji and saw exactly this issue. My regular database contains the full planet and, naturally, doesn't have this issue.</p>
<p>I've raised the issue with geofabrik, lets see what Frederik says.</p></div>
<div class="comment-info" id="comment-67547-info">
<span class="comment-age">(11 Jan '19, 11:02)</span>
<a class="comment-user userinfo" href="/users/2053/simonpoole">SimonPoole ♦</a>
</div>
</div>
<a name="67549"></a>
<div class="comment not_top_scorer" id="comment-67549">
<div class="comment-score" id="post-67549-score"></div>
<div class="comment-text"><p>I have checked required ways. Way 239992380 is present in planet_osm_line, whereas way 239992373 is absent.</p>
<p>I will try to load bz2 dump, instead of pbf, maybe this will help me.
Full planet is too huge for me, my workstation has 32 GB RAM.</p></div>
<div class="comment-info" id="comment-67549-info">
<span class="comment-age">(11 Jan '19, 11:47)</span>
<a class="comment-user userinfo" href="/users/16140/molokanov">molokanov</a>
</div>
</div>
<a name="67550"></a>
<div class="comment not_top_scorer" id="comment-67550">
<div class="comment-score" id="post-67550-score"></div>
<div class="comment-text"><p>bz2 dump also didn't solve this issue. Results are the same. Hope we will get Geofabrik's answer soon.</p></div>
<div class="comment-info" id="comment-67550-info">
<span class="comment-age">(11 Jan '19, 13:19)</span>
<a class="comment-user userinfo" href="/users/16140/molokanov">molokanov</a>
</div>
</div>
<a name="67553"></a>
<div class="comment" id="comment-67553">
<div class="comment-score" id="post-67553-score">2</div>
<div class="comment-text"><p>For reasons unknown, the Geofabrik polygon files used for clipping Aaia, Russia and the Far Eastern District did not extend to 180° but only to 179.9999° (and -179.999°). With regard to Fiji, the Australia-Oceania file did not even contain the over-the-dateline part of the nation, even though the Fiji polygon itself did. I've fixed these issues now and hope that tomorrow's extracts will be good.</p></div>
<div class="comment-info" id="comment-67553-info">
<span class="comment-age">(11 Jan '19, 14:33)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
<a name="67577"></a>
<div class="comment not_top_scorer" id="comment-67577">
<div class="comment-score" id="post-67577-score"></div>
<div class="comment-text"><p>I've checked the new extract for Russia. It is still not corrected. At least two ways with absolutely different tag sets are absent in the resulting database, but they both are needed to from the country's border correctly:</p>
<p><a href="https://www.openstreetmap.org/way/239992373">https://www.openstreetmap.org/way/239992373</a></p>
<p><a href="https://www.openstreetmap.org/way/50752242">https://www.openstreetmap.org/way/50752242</a></p></div>
<div class="comment-info" id="comment-67577-info">
<span class="comment-age">(14 Jan '19, 07:18)</span>
<a class="comment-user userinfo" href="/users/16140/molokanov">molokanov</a>
</div>
</div>
<a name="84482"></a>
<div class="comment not_top_scorer" id="comment-84482">
<div class="comment-score" id="post-84482-score"></div>
<div class="comment-text"><p>Many years passed. And I faced the same problem. Just used osmosis to merge russia.pbf and us.pbf since the us extract borders the russian one. It's not necessary to download planet.pbf. It seems this kind of manipulations may help with other dateline issues.</p></div>
<div class="comment-info" id="comment-84482-info">
<span class="comment-age">(15 May '22, 17:54)</span>
<a class="comment-user userinfo" href="/users/21775/shmeser">shmeser</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-67539">
<span class="comments-showing">
            showing 5 of 12
        </span>
<a class="show-all-comments-link" href="#">show 7 more comments</a>
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67539-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/67534/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="q2upobeVG3TB13VM3VreElltvLqUubRg"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>