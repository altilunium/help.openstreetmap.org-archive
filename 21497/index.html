<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/21497/nominatim-update-sql-error-in-placex_update">Nominatim update sql error in placex_update</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/21497/up/" id="post-21497-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-21497-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/21497/down/" id="post-21497-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/21497/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>When running the incremental update script for nominatim, I get a sql error.  I recently updated from osmosis 0.35 to 0.42 and updated nominatim to the latest git revision.  Is that a red hearing or is there new breakage?</p>
<pre><code>./utils/update.php --import-osmosis-all --no-npi
/var/www/Nominate/osm2pgsql/osm2pgsql -U apache -klas -C 2000 -O gazetteer -d nominatim /var/www/Nominate/data/osmosischange.osc
osm2pgsql SVN version 0.81.0 (64bit id space)

Using projection SRS 4326 (Latlong)
Allocating memory for dense node cache
Allocating dense node cache in one big chunk
Allocating memory for sparse node cache
Sharing dense sparse
Node-cache: cache=2000MB, maxblocks=256001*8192, allocation method=11
Mid: pgsql, scale=10000000 cache=2000
Setting up table: planet_osm_nodes
Setting up table: planet_osm_ways
Setting up table: planet_osm_rels

Reading in file: /var/www/Nominate/data/osmosischange.osc
Processing: Node(136k 2.1k/s) Way(18k 0.36k/s) Relation(87 43.50/s)  parse time: 119s

Node stats: total(136962), max(2227049854) in 65s
Way stats: total(18889), max(212923522) in 52s
Relation stats: total(87), max(2843176) in 2s
node cache: stored: 134790(100.00%), storage efficiency: 87.00% (dense blocks: 133, sparse nodes: 9373), hit rate: 36.94%
Stopping table: planet_osm_nodes
Stopped table: planet_osm_nodes in 0s
Stopping table: planet_osm_rels
Stopping table: planet_osm_ways
Stopped table: planet_osm_ways in 0s
Stopped table: planet_osm_rels in 0s

Osm2pgsql took 119s overall
Completed for 2013-03-26T21:10:03Z in 1.98 minutes
string(127) "INSERT INTO import_osmosis_log values ('2013-03-26T21:10:03Z',32804717,'2013-04-13 01:03:35','2013-04-13 01:05:34','osm2pgsql')"
/var/www/Nominate/nominatim/nominatim -i -d nominatim -t 1
nominatim SVN version 2.1-git-a1670fa

Starting indexing rank (0 to 30) using 1 threads
Starting rank 0
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 1
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 2
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 3
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 4
  Done 1 in 0 @ 1.000000 per second - ETA (seconds): 0.000000
  Done 1 in 0 @ 1.000000 per second - FINISHED

Starting rank 5
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 6
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 7
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 8
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 9
  Done 0 in 0 @ 0.000000 per second - FINISHED

Starting rank 10
index_placex: UPDATE failed: ERROR:  column "importance" is of type double precision but expression is of type integer[]
LINE 2:       in_name_vector, in_geometry)
              ^
HINT:  You will need to rewrite or cast the expression.
QUERY:  INSERT INTO search_name_39 values (in_place_id, in_rank_search, in_rank_address, 
      in_name_vector, in_geometry)
CONTEXT:  PL/pgSQL function insertsearchname(integer,bigint,character varying,integer[],integer[],integer,integer,double precision,geometry,geometry) line 89 at SQL statement
PL/pgSQL function placex_update() line 635 at assignment
Error: 1
</code></pre>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-import" href="/tags/import/" rel="tag" title="see questions tagged 'import'">import</a>
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-update" href="/tags/update/" rel="tag" title="see questions tagged 'update'">update</a>
<a class="post-tag tag-link-osmosis" href="/tags/osmosis/" rel="tag" title="see questions tagged 'osmosis'">osmosis</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>13 Apr '13, 02:33</strong>
</p>
<img alt="montanalow's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/705d24784cee7f6cddc6a1e4211513cc?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/6106/montanalow">montanalow</a><br/>
<span class="score" title="40 reputation points">40</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="montanalow has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/21497/">
                edited
                <strong>13 Apr '13, 14:14</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-21497">
<a name="21500"></a>
<div class="comment" id="comment-21500">
<div class="comment-score" id="post-21500-score">1</div>
<div class="comment-text"><p>Umm, don't you think that some accompanying text (a question! pointing out the error, so not every need to scan the text) might be useful? Just throwing some error output at other people's head is not that nice. ;-)</p></div>
<div class="comment-info" id="comment-21500-info">
<span class="comment-age">(13 Apr '13, 13:27)</span>
<a class="comment-user userinfo" href="/users/5179/aseerel4c26">aseerel4c26 ♦</a>
</div>
</div>
<a name="21502"></a>
<div class="comment" id="comment-21502">
<div class="comment-score" id="post-21502-score">2</div>
<div class="comment-text"><p>Sorry, I was just a bit confused and not quite sure what exactly to ask.  I've edited in a bit of a question.</p></div>
<div class="comment-info" id="comment-21502-info">
<span class="comment-age">(13 Apr '13, 14:15)</span>
<a class="comment-user userinfo" href="/users/6106/montanalow">montanalow</a>
</div>
</div>
<a name="21535"></a>
<div class="comment" id="comment-21535">
<div class="comment-score" id="post-21535-score"></div>
<div class="comment-text"><p>Just guessing, but depending on how long ago you did the last update, is it possible that the database schema has changed since then? If it is easy to do (doesn't take to long as you are not using the full planet), you might want to try and re-import the data with the new version of the tools.</p></div>
<div class="comment-info" id="comment-21535-info">
<span class="comment-age">(15 Apr '13, 02:02)</span>
<a class="comment-user userinfo" href="/users/65/apmon">apmon</a>
</div>
</div>
<a name="21537"></a>
<div class="comment" id="comment-21537">
<div class="comment-score" id="post-21537-score"></div>
<div class="comment-text"><p>I started a fresh full planet import about 12 days ago,  with the most recent version of nominatim at the time.  This is the first time I've attempted an incremental update to nominatim.  Does nominatim include migrations to update the database schema that I should check?</p></div>
<div class="comment-info" id="comment-21537-info">
<span class="comment-age">(15 Apr '13, 03:02)</span>
<a class="comment-user userinfo" href="/users/6106/montanalow">montanalow</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-21497">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-21497-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/21497/nominatim-update-sql-error-in-placex_update?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/21497/nominatim-update-sql-error-in-placex_update?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/21497/nominatim-update-sql-error-in-placex_update?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/21497/nominatim-update-sql-error-in-placex_update?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="21573"></a>
<div class="answer" id="answer-container-21573">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/21573/up/" id="post-21573-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-21573-score" title="current number of votes">
    4
</div>
<a class="ajax-command post-vote down" href="/vote/21573/down/" id="post-21573-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The database schema changed with <a href="https://github.com/twain47/Nominatim/commit/23d303124e903e58e5c95890868de8c62304946f">this commit</a>. There are no migration scripts but the manual steps to do the migration are described in <a href="https://github.com/twain47/Nominatim/pull/45">this pull request</a>.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/21573/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>16 Apr '13, 08:21</strong>
</p>
<img alt="lonvia's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d888b712d85dee0aa304297f2dc697c7?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2921/lonvia">lonvia</a><br/>
<span class="score" title="6213 reputation points"><span class="">6.2k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="89 badges"><span class="bronze">●</span><span class="badgecount">89</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="lonvia has 43 accepted answers">40%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-21573">
<a name="21607"></a>
<div class="comment" id="comment-21607">
<div class="comment-score" id="post-21607-score"></div>
<div class="comment-text"><p>Thanks again, that fixed things up.</p></div>
<div class="comment-info" id="comment-21607-info">
<span class="comment-age">(16 Apr '13, 18:09)</span>
<a class="comment-user userinfo" href="/users/6106/montanalow">montanalow</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-21573">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-21573-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/21497/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="QiofX730xUjucAAVSQdqfgfFe2svZUfP"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>