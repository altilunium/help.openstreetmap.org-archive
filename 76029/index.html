<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/76029/error-while-extracting-merged-database-for-nominatim-help">Error while extracting merged database for Nominatim. Help!</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/76029/up/" id="post-76029-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-76029-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/76029/down/" id="post-76029-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/76029/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I merged Europe and North America .os.bz2 files from <strong><em><a href="http://download.geofabrik.de/">http://download.geofabrik.de/</a></em></strong> using the command <strong><em>osmium merge country1.osm.bz2 country2.osm.bz2 -o together.osm.bz2</em></strong>. Then I started extraction of the merged file using the command <strong><em>./utils/setup.php --osm-file together.osm.bz2 --all 2&gt;&amp;1 | tee setup.log</em></strong>. After running this command I got the error below:</p>
<pre><code>2020-08-05 01:40:59 == WARNING: resetting threads to 1
2020-08-05 01:40:59 == module path: /srv/nominatim/build/module
2020-08-05 01:40:59 == Create DB
2020-08-05 01:40:59 == Setup DB
Postgres version found: 10
Postgis version found: 2.4
 set_config
------------

(1 row)

2020-08-05 01:41:04 == Import data
osm2pgsql version 1.2.0 (v3.5.0-67-g8201c7f)

Allocating memory for dense node cache
Allocating dense node cache in one big chunk
Allocating memory for sparse node cache
Sharing dense sparse
Node-cache: cache=46413MB, maxblocks=742608*65536, allocation method=11
Mid: pgsql, cache=46413
Setting up table: planet_osm_nodes
Setting up table: planet_osm_ways
Setting up table: planet_osm_rels
Parsing gazetteer style file '/srv/nominatim/Nominatim/settings/import-full.style'.
Using projection SRS 4326 (Latlong)
NOTICE:  table "place" does not exist, skipping

Reading in file: /srv/nominatim/build/europe-north-america.osm.bz2
Using XML parser.
Processing: Node(3824539k 228.0k/s) Way(413495k 49.59k/s) Relation(6198427 5019.0/s)  parse time: 26344s
Node stats: total(3824539161), max(7771142999) in 16771s
Way stats: total(413495830), max(832369740) in 8338s
Relation stats: total(6198427), max(11366925) in 1235s
result COPY END for planet_osm_rels failed: ERROR:  duplicate key value violates unique constraint "planet_osm_rels_pkey"
DETAIL:  Key (id)=(11980) already exists.
CONTEXT:  COPY planet_osm_rels, line 3143

DB copy thread failed: Ending COPY mode
ERROR: No Data
string(7) "No Data"
</code></pre>
<p><strong>After this extraction stopped. What could have had caused it and how to solve this issue?</strong></p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-osmium" href="/tags/osmium/" rel="tag" title="see questions tagged 'osmium'">osmium</a>
<a class="post-tag tag-link-merge" href="/tags/merge/" rel="tag" title="see questions tagged 'merge'">merge</a>
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-extract" href="/tags/extract/" rel="tag" title="see questions tagged 'extract'">extract</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>06 Aug '20, 06:10</strong>
</p>
<img alt="Saurav1997's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/e268298e773338d7203d941c245ebff4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/18792/saurav1997">Saurav1997</a><br/>
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Saurav1997 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/76029/">
                edited
                <strong>09 Aug '20, 13:22</strong>
</a>
</p>
<img alt="scai's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/158/scai">scai ♦</a><br/>
<span class="score" title="33317 reputation points"><span class="">33.3k</span></span><span title="21 badges"><span class="badge1">●</span><span class="badgecount">21</span></span><span title="309 badges"><span class="silver">●</span><span class="badgecount">309</span></span><span title="459 badges"><span class="bronze">●</span><span class="badgecount">459</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-76029">
<a name="76030"></a>
<div class="comment" id="comment-76030">
<div class="comment-score" id="post-76030-score">1</div>
<div class="comment-text"><p>Please do not just paste an error here. Describe what you tried to do. This should also include a description where you got your data from and how you merged it.</p></div>
<div class="comment-info" id="comment-76030-info">
<span class="comment-age">(06 Aug '20, 07:49)</span>
<a class="comment-user userinfo" href="/users/2921/lonvia">lonvia</a>
</div>
</div>
<a name="76031"></a>
<div class="comment" id="comment-76031">
<div class="comment-score" id="post-76031-score">2</div>
<div class="comment-text"><p>Originally posted at <a href="https://github.com/osm-search/Nominatim/issues/1905">https://github.com/osm-search/Nominatim/issues/1905</a> (now closed as duplicate for this question)</p></div>
<div class="comment-info" id="comment-76031-info">
<span class="comment-age">(06 Aug '20, 07:49)</span>
<a class="comment-user userinfo" href="/users/2921/lonvia">lonvia</a>
</div>
</div>
<a name="76033"></a>
<div class="comment" id="comment-76033">
<div class="comment-score" id="post-76033-score"></div>
<div class="comment-text"><p>Sorry for not giving a proper description. I have added a new question with proper details. Link: <a href="https://help.openstreetmap.org/questions/76032/error-while-extracting-merged-database-for-nominatim">https://help.openstreetmap.org/questions/76032/error-while-extracting-merged-database-for-nominatim</a></p></div>
<div class="comment-info" id="comment-76033-info">
<span class="comment-age">(06 Aug '20, 08:06)</span>
<a class="comment-user userinfo" href="/users/18792/saurav1997">Saurav1997</a>
</div>
</div>
<a name="76034"></a>
<div class="comment" id="comment-76034">
<div class="comment-score" id="post-76034-score"></div>
<div class="comment-text"><p>Don't add a new question. Edit this question instead.</p></div>
<div class="comment-info" id="comment-76034-info">
<span class="comment-age">(06 Aug '20, 12:37)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="76036"></a>
<div class="comment" id="comment-76036">
<div class="comment-score" id="post-76036-score"></div>
<div class="comment-text"><p>I have edited it.</p></div>
<div class="comment-info" id="comment-76036-info">
<span class="comment-age">(06 Aug '20, 13:48)</span>
<a class="comment-user userinfo" href="/users/18792/saurav1997">Saurav1997</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-76029">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-76029-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/76029/error-while-extracting-merged-database-for-nominatim-help?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/76029/error-while-extracting-merged-database-for-nominatim-help?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/76029/error-while-extracting-merged-database-for-nominatim-help?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/76029/error-while-extracting-merged-database-for-nominatim-help?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="76078"></a>
<div class="answer" id="answer-container-76078">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/76078/up/" id="post-76078-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-76078-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/76078/down/" id="post-76078-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The error message isn't easy to read, but the important detail is this part: "planet_osm_rels failed: ERROR: duplicate key value violates unique constraint". And it even says what the id is: 11980. So presumably the relation 11980 was in together.osm.bz2 twice. This relation is the France relation and France has many overseas departments etc. so it might well be that it was in the Europe and North America extracts.</p>
<p>Now the question is why was it in the merged files twice? The most probably reason is that you downloaded the two original extracts at different points in time and they both contained different versions of the same relation. In that case osmium merge will leave both in there, as documented in the man page: "Do not use this command to merge non-history files with data from different points in time.  It will not work correctly." But this is guess work, because I don't know what's in the files you downloaded. You can check this with "osmium getid".</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/76078/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>09 Aug '20, 10:29</strong>
</p>
<img alt="Jochen%20Topf's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/2d4dfcdcde73aa5e2ffa4a9b3a7cb51d?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/112/jochen-topf">Jochen Topf</a><br/>
<span class="score" title="5244 reputation points"><span class="">5.2k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="50 badges"><span class="silver">●</span><span class="badgecount">50</span></span><span title="74 badges"><span class="bronze">●</span><span class="badgecount">74</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Jochen Topf has 32 accepted answers">31%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-76078">
</div>
<div class="comment-tools" id="comment-tools-76078">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-76078-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/76029/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="IycjYKyAl0nxOOGn2zPROufoq8gEWOFF"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>