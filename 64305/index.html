<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/64305/overpass-api-get-city-boundaries-within-a-country-slow-query">Overpass API: Get city boundaries within a country - slow query!</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/64305/up/" id="post-64305-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-64305-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/64305/down/" id="post-64305-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/64305/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I want to get the city boundaries within a specific country. The following query is fast but it's not bound to a country so that multiple city boundaries could be returned.</p>
<pre><code>[out:json];(rel[name='Herne'][type=boundary];);out geom;
</code></pre>
<p>I tried this query but it's extremely slow:</p>
<pre><code>( area["ISO3166-1:alpha2"="DE"];) -&gt;.a;
rel[name="Herne"]
(area.a);
(._;&gt;;);
out geom;
</code></pre>
<p>Is there a better and faster solution?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-openstreetmap" href="/tags/openstreetmap/" rel="tag" title="see questions tagged 'openstreetmap'">openstreetmap</a>
<a class="post-tag tag-link-overpass" href="/tags/overpass/" rel="tag" title="see questions tagged 'overpass'">overpass</a>
<a class="post-tag tag-link-overpass-turbo" href="/tags/overpass-turbo/" rel="tag" title="see questions tagged 'overpass-turbo'">overpass-turbo</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>21 Jun '18, 14:41</strong>
</p>
<img alt="OsmStorm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ee7b89e8765c04ab68ce284a9efb18ea?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/15280/osmstorm">OsmStorm</a><br/>
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="OsmStorm has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-64305">
<a name="64319"></a>
<div class="comment" id="comment-64319">
<div class="comment-score" id="post-64319-score">1</div>
<div class="comment-text"><p>crosspost: <a href="https://stackoverflow.com/questions/50967088/osm-overpass-api-get-city-boundaries-from-country-rate-limit">https://stackoverflow.com/questions/50967088/osm-overpass-api-get-city-boundaries-from-country-rate-limit</a></p></div>
<div class="comment-info" id="comment-64319-info">
<span class="comment-age">(22 Jun '18, 10:15)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-64305">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-64305-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    3 Answers:
                    </div>
<div class="tabsA"><a href="/questions/64305/overpass-api-get-city-boundaries-within-a-country-slow-query?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/64305/overpass-api-get-city-boundaries-within-a-country-slow-query?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/64305/overpass-api-get-city-boundaries-within-a-country-slow-query?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/64305/overpass-api-get-city-boundaries-within-a-country-slow-query?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="64332"></a>
<div class="answer" id="answer-container-64332">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/64332/up/" id="post-64332-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-64332-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/64332/down/" id="post-64332-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I've tried myself your slow query and it took me 90 seconds. Bear in mind that it hasn't the filter <code>[type="boundary"]</code>.</p>
<p>This one takes about 50 seconds, and does the same (it includes the <code>[type="boundary"]</code> filter):</p>
<pre><code>[out:json];
relation[name="Herne"][type="boundary"](area:3600051477);
out geom;
</code></pre>
<p>From my experience so far with Overpass, it takes normally a similar time for queries over a country of the size of Germany. But maybe somebody has a faster solution.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/64332/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>23 Jun '18, 17:23</strong>
</p>
<img alt="edvac's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d45c161edd4b471fd947a7ec574274ca?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3339/edvac">edvac</a><br/>
<span class="score" title="665 reputation points">665</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="19 badges"><span class="bronze">●</span><span class="badgecount">19</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="edvac has 4 accepted answers">15%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-64332">
<a name="64371"></a>
<div class="comment" id="comment-64371">
<div class="comment-score" id="post-64371-score"></div>
<div class="comment-text"><p>Thanks for your answer! But why is this query so much slower than the first one? The first one takes like 1-2 seconds compared to 50/90 seconds. I guess it would be faster to take one coordinate per polygon (city) and check via another query if it's inside the given country or not.
If someone finds a faster query or any other faster solution, please let me know.</p></div>
<div class="comment-info" id="comment-64371-info">
<span class="comment-age">(26 Jun '18, 07:06)</span>
<a class="comment-user userinfo" href="/users/15280/osmstorm">OsmStorm</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-64332">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-64332-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="64372"></a>
<div class="answer answered-by-owner" id="answer-container-64372">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/64372/up/" id="post-64372-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-64372-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/64372/down/" id="post-64372-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Is there maybe a way to detect which polygon belongs to which country by only going through the osm or geojson print? Maybe by help of the tags?</p>
<p>Herne Germany:</p>
<pre><code> "tags": {
    "TMC:cid_58:tabcd_1:Class": "Area",
    "TMC:cid_58:tabcd_1:LCLversion": "8.00",
    "TMC:cid_58:tabcd_1:LocationCode": "463",
    "admin_level": "6",
    "boundary": "administrative",
    "de:amtlicher_gemeindeschluessel": "05916000",
    "de:place": "city",
    "de:regionalschluessel": "059160000000",
    "name": "Herne",
    "name:prefix": "Stadt",
    "source": "http://wiki.openstreetmap.org/wiki/Import/Catalogue/Kreisgrenzen_Deutschland_2005",
    "type": "boundary",
    "wikidata": "Q2904",
    "wikipedia": "de:Herne"
  }
</code></pre>
<p>Herne Belgium:</p>
<pre><code>"tags": {
"admin_level": "8",
"boundary": "administrative",
"name": "Herne",
"name:ru": "Херне",
"ref:INS": "23032",
"type": "boundary",
"website": "http://www.herne.be",
"wikidata": "Q567808",
"wikipedia": "nl:Herne (België)"
</code></pre>
<p>}</p>
<p>But here, I could only take the wikipedia entry and decide by the prefix "de" / "nl" whereas "nl" would be wrong if I was looking for a Herne in the Netherlands.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/64372/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>26 Jun '18, 07:56</strong>
</p>
<img alt="OsmStorm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ee7b89e8765c04ab68ce284a9efb18ea?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/15280/osmstorm">OsmStorm</a><br/>
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="OsmStorm has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-64372">
</div>
<div class="comment-tools" id="comment-tools-64372">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-64372-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="70342"></a>
<div class="answer" id="answer-container-70342">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/70342/up/" id="post-70342-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-70342-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/70342/down/" id="post-70342-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>This should do it:</p>
<pre><code>[out:json];
area['admin_level'='2']['name'='Deutschland'];
(relation['admin_level'='8'](area););
out geom;
</code></pre>
<p>My understanding is that this line limits the query to just Germany:</p>
<pre><code>area['admin_level'='2']['name'='Deutschland'];
</code></pre>
<p>Then this line does the actual search of all cities within that area:</p>
<pre><code>(relation['admin_level'='8'](area););
</code></pre>
<p>If it's still too slow, you could run multiple queries - one for each State (which exist at admin level 4), based on this example for Brandenburg:</p>
<pre><code>[out:json];
area['ISO3166-2'~'^DE']['admin_level'='4']['name'='Brandenburg'];
(relation['admin_level'='8'](area););
out geom;
</code></pre>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/70342/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>08 Aug '19, 00:20</strong>
</p>
<img alt="JamesChevalier's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/0ada7b97d85873855231744286452af4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/7201/jameschevalier">JamesChevalier</a><br/>
<span class="score" title="151 reputation points">151</span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="7 badges"><span class="silver">●</span><span class="badgecount">7</span></span><span title="13 badges"><span class="bronze">●</span><span class="badgecount">13</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="JamesChevalier has one accepted answer">25%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/70342/">
                edited
                <strong>08 Aug '19, 00:21</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-70342">
</div>
<div class="comment-tools" id="comment-tools-70342">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-70342-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/64305/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="Gp7C43BqHtVboXMEjv0sxYVDrYXvm3ku"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>