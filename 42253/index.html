<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/42253/extract-tiled-xml-data-from-a-big-pbf-file">Extract tiled xml data from a big pbf file</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/42253/up/" id="post-42253-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-42253-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/42253/down/" id="post-42253-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/42253/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I'd like to extract small xml files of tiled osm data from a pbf file. These xml files should contain data square map boxes. I'd like to have one xml file for each tile that is touched by the original pbf file. I used osmosis to extract one tile, which took 10 minutes for a pbf file of 2GB. This is probably due to the size of the pbf file (and IO speed), and not dependent on the size of my bounding box. Is there a tool that lets me extract lots of bounding boxes at once?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-osmconvert" href="/tags/osmconvert/" rel="tag" title="see questions tagged 'osmconvert'">osmconvert</a>
<a class="post-tag tag-link-extract" href="/tags/extract/" rel="tag" title="see questions tagged 'extract'">extract</a>
<a class="post-tag tag-link-osmosis" href="/tags/osmosis/" rel="tag" title="see questions tagged 'osmosis'">osmosis</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>10 Apr '15, 17:51</strong>
</p>
<img alt="Marian's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/edf8c89adb71d4763f9c75a6892f1388?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/10818/marian">Marian</a><br/>
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Marian has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/42253/">
                edited
                <strong>10 Apr '15, 17:54</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-42253">
</div>
<div class="comment-tools" id="comment-tools-42253">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-42253-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    3 Answers:
                    </div>
<div class="tabsA"><a href="/questions/42253/extract-tiled-xml-data-from-a-big-pbf-file?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/42253/extract-tiled-xml-data-from-a-big-pbf-file?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/42253/extract-tiled-xml-data-from-a-big-pbf-file?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/42253/extract-tiled-xml-data-from-a-big-pbf-file?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="42254"></a>
<div class="answer" id="answer-container-42254">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/42254/up/" id="post-42254-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-42254-score" title="current number of votes">
    3
</div>
<a class="ajax-command post-vote down" href="/vote/42254/down/" id="post-42254-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>Yes, the <a href="https://github.com/MaZderMind/osm-history-splitter">OSM History Splitter</a> which processes history files as well as normal PBFs.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/42254/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>10 Apr '15, 18:29</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-42254">
<a name="42257"></a>
<div class="comment" id="comment-42257">
<div class="comment-score" id="post-42257-score"></div>
<div class="comment-text"><p>It doesn't compile on my ubuntu machine... (fails to find <code>boost/utility.hpp</code>)</p></div>
<div class="comment-info" id="comment-42257-info">
<span class="comment-age">(10 Apr '15, 21:57)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
<a name="42309"></a>
<div class="comment" id="comment-42309">
<div class="comment-score" id="post-42309-score"></div>
<div class="comment-text"><p><a href="http://help.openstreetmap.org/users/10818/marian">@Marian</a> Please install <code>libboost-dev</code>.</p></div>
<div class="comment-info" id="comment-42309-info">
<span class="comment-age">(13 Apr '15, 08:01)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="42387"></a>
<div class="comment" id="comment-42387">
<div class="comment-score" id="post-42387-score"></div>
<div class="comment-text"><p>I got it to run but it crashes if there are more than 30 bounding boxes in the config file.</p></div>
<div class="comment-info" id="comment-42387-info">
<span class="comment-age">(16 Apr '15, 13:25)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
<a name="42431"></a>
<div class="comment" id="comment-42431">
<div class="comment-score" id="post-42431-score"></div>
<div class="comment-text"><p>Turns out RAM usage grows quickly with the amount of bounding boxes so only a few bboxes can be extracted at a time.</p></div>
<div class="comment-info" id="comment-42431-info">
<span class="comment-age">(18 Apr '15, 12:41)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
<a name="42455"></a>
<div class="comment" id="comment-42455">
<div class="comment-score" id="post-42455-score">1</div>
<div class="comment-text"><p>You might want to try the <code>--hardcut</code> option which uses less RAM. Else just run the program multiple times. The problem is (you say you want to produce &gt; 100.000 extracts) that a list of nodes and ways needs to be kept in memory for all these, and most programs will use an array-like structure for efficiency. It might be possible to switch osm-history-splitter to a list-like structure using small changes in the code.</p></div>
<div class="comment-info" id="comment-42455-info">
<span class="comment-age">(19 Apr '15, 18:46)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-42254">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-42254-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="42255"></a>
<div class="answer" id="answer-container-42255">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/42255/up/" id="post-42255-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-42255-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/42255/down/" id="post-42255-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>You can try <a href="http://wiki.openstreetmap.org/wiki/Osmconvert">osmconvert</a> ... it has several clipping features.</p>
<p>Read the instructions in wiki page carefully.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/42255/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>10 Apr '15, 19:26</strong>
</p>
<img alt="stephan75's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/245b73d4390c3408fe3c6da759b9897f?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/99/stephan75">stephan75</a><br/>
<span class="score" title="12642 reputation points"><span class="">12.6k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="56 badges"><span class="silver">●</span><span class="badgecount">56</span></span><span title="210 badges"><span class="bronze">●</span><span class="badgecount">210</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="stephan75 has 37 accepted answers">6%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-42255">
<a name="42256"></a>
<div class="comment" id="comment-42256">
<div class="comment-score" id="post-42256-score"></div>
<div class="comment-text"><p>Can you provide an example of how to extract two bboxes from one pbf file using osmconvert?</p></div>
<div class="comment-info" id="comment-42256-info">
<span class="comment-age">(10 Apr '15, 19:54)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
<a name="42261"></a>
<div class="comment" id="comment-42261">
<div class="comment-score" id="post-42261-score"></div>
<div class="comment-text"><p>Did you try the clear example at</p>
<p><a href="http://wiki.openstreetmap.org/wiki/Osmconvert#Clipping_based_on_Longitude_and_Latitude">http://wiki.openstreetmap.org/wiki/Osmconvert#Clipping_based_on_Longitude_and_Latitude</a></p>
<p>If you want two bboxes extracted, you should call this command twice with diferent parameters ... Success?</p></div>
<div class="comment-info" id="comment-42261-info">
<span class="comment-age">(11 Apr '15, 06:48)</span>
<a class="comment-user userinfo" href="/users/99/stephan75">stephan75</a>
</div>
</div>
<a name="42302"></a>
<div class="comment" id="comment-42302">
<div class="comment-score" id="post-42302-score"></div>
<div class="comment-text"><p>I have to do this more than 100k times. I was wondering if there is a more efficient way than parsing the entire pbf file each time.</p></div>
<div class="comment-info" id="comment-42302-info">
<span class="comment-age">(12 Apr '15, 23:13)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-42255">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-42255-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="42456"></a>
<div class="answer" id="answer-container-42456">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/42456/up/" id="post-42456-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-42456-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/42456/down/" id="post-42456-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>If you want to create a huge number of extracts then perhaps installing a local Overpass database and extracting from there could be the fastest way. See <a href="http://overpass-api.de/no_frills.html">http://overpass-api.de/no_frills.html</a> for instructions. </p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/42456/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>19 Apr '15, 18:47</strong>
</p>
<img alt="Frederik%20Ramm's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a2b38d937e70ab39d895d17da0dd1ba4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/104/frederik-ramm">Frederik Ramm ♦</a><br/>
<span class="score" title="82494 reputation points"><span class="">82.5k</span></span><span title="92 badges"><span class="badge1">●</span><span class="badgecount">92</span></span><span title="720 badges"><span class="silver">●</span><span class="badgecount">720</span></span><span title="1273 badges"><span class="bronze">●</span><span class="badgecount">1273</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Frederik Ramm has 417 accepted answers">23%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-42456">
<a name="46519"></a>
<div class="comment" id="comment-46519">
<div class="comment-score" id="post-46519-score"></div>
<div class="comment-text"><p>Why do you recommend creating a local overpass database over using an existing overpass service? Even in production, 10000 requests per day is way beyond what I need. Is the local db faster?</p></div>
<div class="comment-info" id="comment-46519-info">
<span class="comment-age">(10 Nov '15, 23:21)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
<a name="46521"></a>
<div class="comment" id="comment-46521">
<div class="comment-score" id="post-46521-score"></div>
<div class="comment-text"><p>If you're just doing this once for 5 or 10 bounding boxes then I guess it's ok. Else you come close to abusing the existing Overpass server - the local db may not be faster but it sure is fairer!</p></div>
<div class="comment-info" id="comment-46521-info">
<span class="comment-age">(11 Nov '15, 01:26)</span>
<a class="comment-user userinfo" href="/users/104/frederik-ramm">Frederik Ramm ♦</a>
</div>
</div>
<a name="46522"></a>
<div class="comment" id="comment-46522">
<div class="comment-score" id="post-46522-score"></div>
<div class="comment-text"><p>The wiki page says 10.000 requests are ok. If 10 already is abuse, I'll sure set up my own. <a href="https://wiki.openstreetmap.org/wiki/Overpass_API">https://wiki.openstreetmap.org/wiki/Overpass_API</a></p></div>
<div class="comment-info" id="comment-46522-info">
<span class="comment-age">(11 Nov '15, 06:30)</span>
<a class="comment-user userinfo" href="/users/10818/marian">Marian</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-42456">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-42456-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/42253/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="WCMaQ42Yv2EwckH28p0Dvxm8UDBxkUMS"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>