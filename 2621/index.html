<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/2621/osm-structure-of-the-osm-file">Структура OSM файла / Structure of the OSM file</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/2621/up/" id="post-2621-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-2621-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/2621/down/" id="post-2621-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/2621/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p><strong>Уважаемые коллеги!</strong></p>
<p>Я хочу сделать парсер и получить из OSM-файла связанную информацию типа Область/Район/Населенный пункт/Улица/Дом.
Можно ли считать, что если начать с корневого relation страны, то спускаясь вниз по вложенным relation и далее по их way и node, я смогу получить всю информацию? Просто эксперименты показали, что в OSM-файле имеются "висящие" way и node. Т.е. например node входит в состав way, а way никуда не входит.
Попытки в таком случае определить принадлежность по координатам (вхождение внутрь полигона) тоже не всегда дает результат, т.к. многие населенные пункты (в основном деревни) вообще не имеют границ (way с ролью border).
Хочется знать, на какие вещи можно 100% полагаться.</p>
<p>Спасибо.</p>
<p>[ English translation via Google Translate ]</p>
<p>I want to make the parser and get the file from the OSM-related information such as State / District / Town / Street / House. Can I assume that if we start from the root relation of the country, descended down the nested relation and continue on their way and node, I can get all the information? Simple experiments showed that the OSM-file are "hanging" way and the node. Ie such node is part of the way, a way will not enter. Attempts in this case to determine the membership of the coordinates (entering into the landfill) do not always produce the result, because many communities (mostly villages) have no boundaries (way the role of the border). Want to know which things can be 100% relied upon.</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-node" href="/tags/node/" rel="tag" title="see questions tagged 'node'">node</a>
<a class="post-tag tag-link-lang-ru" href="/tags/lang-ru/" rel="tag" title="see questions tagged 'lang-ru'">lang-ru</a>
<a class="post-tag tag-link-parser" href="/tags/parser/" rel="tag" title="see questions tagged 'parser'">parser</a>
<a class="post-tag tag-link-relation" href="/tags/relation/" rel="tag" title="see questions tagged 'relation'">relation</a>
<a class="post-tag tag-link-way" href="/tags/way/" rel="tag" title="see questions tagged 'way'">way</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>31 Jan '11, 19:12</strong>
</p>
<img alt="askokov's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/b26842858cd8146631c18952f308ded4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/779/askokov">askokov</a><br/>
<span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="askokov has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/2621/">
                edited
                <strong>25 Jul '13, 21:41</strong>
</a>
</p>
<img alt="aseerel4c26's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/66f0dc05b44574e3894be07b0b37cf37?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/5179/aseerel4c26">aseerel4c26 ♦</a><br/>
<span class="score" title="32615 reputation points"><span class="">32.6k</span></span><span title="18 badges"><span class="badge1">●</span><span class="badgecount">18</span></span><span title="248 badges"><span class="silver">●</span><span class="badgecount">248</span></span><span title="554 badges"><span class="bronze">●</span><span class="badgecount">554</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-2621">
</div>
<div class="comment-tools" id="comment-tools-2621">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-2621-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/2621/osm-structure-of-the-osm-file?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/2621/osm-structure-of-the-osm-file?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/2621/osm-structure-of-the-osm-file?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/2621/osm-structure-of-the-osm-file?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="2640"></a>
<div class="answer" id="answer-container-2640">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/2640/up/" id="post-2640-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-2640-score" title="current number of votes">
    4
</div>
<a class="ajax-command post-vote down" href="/vote/2640/down/" id="post-2640-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The only reliable way to find all the towns and villages in a particular area is to treat the data as a <a href="http://en.wikipedia.org/wiki/Spatial_analysis">spatial dataset</a> and calculate the results using the coordinates. OSM data does not, and usually <em>should</em> not, have a hierarchy of places like you describe.</p>
<p>You should first describe the area that you are interested in in terms of a polygon of coordinates, then use that polygon with a suitable <a href="http://wiki.openstreetmap.org/wiki/Planet.osm#Extracts">planet file extract</a> and <a href="http://wiki.openstreetmap.org/wiki/Osmosis">osmosis</a> to generate data within that polygon. You can then find all the towns, villages etc by filtering for the nodes, and ways containing nodes, that you have within your area.</p>
<p>For most search / hierarchy challenges like this I would suggest starting with the <a href="http://wiki.openstreetmap.org/wiki/Nominatim">nominatim</a> software, which does all this processing for you.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/2640/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>01 Feb '11, 09:07</strong>
</p>
<img alt="Andy%20Allan's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/c3743b1b368f5e209eb8aad30164acc4?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/3/andy-allan">Andy Allan</a><br/>
<span class="score" title="12456 reputation points"><span class="">12.5k</span></span><span title="23 badges"><span class="badge1">●</span><span class="badgecount">23</span></span><span title="128 badges"><span class="silver">●</span><span class="badgecount">128</span></span><span title="153 badges"><span class="bronze">●</span><span class="badgecount">153</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Andy Allan has 46 accepted answers">28%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-2640">
</div>
<div class="comment-tools" id="comment-tools-2640">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-2640-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/2621/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="RTrU0tiKuyF4dlYvi2QAVKgv9LE1IPxu"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>