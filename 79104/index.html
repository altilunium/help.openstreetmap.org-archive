<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/79104/fastest-way-to-query-an-osm-file">Fastest way to query an OSM file</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/79104/up/" id="post-79104-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-79104-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/79104/down/" id="post-79104-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/79104/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I am writing a code in Python to find bus stops inside of different rectangles that depend on incoming data.I am able to this with the overpass Api and the python module overpy but query time is usually around 5 seconds and I would like to have it under 1 second. Moreover, the limit of queries is reached. My second attempt was to save a local osm copy and to cut the area of interest with osmosis, however, trimming the area takes nearly 2 minutes.
What is the fastest way to accomplish this ? </p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-python" href="/tags/python/" rel="tag" title="see questions tagged 'python'">python</a>
<a class="post-tag tag-link-query" href="/tags/query/" rel="tag" title="see questions tagged 'query'">query</a>
<a class="post-tag tag-link-busstops" href="/tags/busstops/" rel="tag" title="see questions tagged 'busstops'">busstops</a>
<a class="post-tag tag-link-postgis" href="/tags/postgis/" rel="tag" title="see questions tagged 'postgis'">postgis</a>
<a class="post-tag tag-link-optimize" href="/tags/optimize/" rel="tag" title="see questions tagged 'optimize'">optimize</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>02 Mar '21, 17:38</strong>
</p>
<img alt="fragodec's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/a09dbb622f7d7cd28396951b306e2c60?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/19749/fragodec">fragodec</a><br/>
<span class="score" title="16 reputation points">16</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="fragodec has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/79104/">
                edited
                <strong>02 Mar '21, 17:44</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-79104">
</div>
<div class="comment-tools" id="comment-tools-79104">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-79104-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/79104/fastest-way-to-query-an-osm-file?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/79104/fastest-way-to-query-an-osm-file?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/79104/fastest-way-to-query-an-osm-file?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/79104/fastest-way-to-query-an-osm-file?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="79106"></a>
<div class="answer accepted-answer" id="answer-container-79106">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/79106/up/" id="post-79106-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-79106-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/79106/down/" id="post-79106-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/79106/" rel="nofollow" title="fragodec has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The command line tool <a href="https://osmcode.org/osmium-tool/">Osmium</a> can do all sorts of things like creating extracts. It is much faster than Osmosis. I recommend the following way of processing OSM data:</p>
<ol>
<li>Download a suitable extract from <a href="https://download.geofabrik.de/">Geofabrik</a> </li>
<li>Use <code>osmium extract</code> to narrow this down to a smaller area if needed</li>
<li>Use <code>osmum tags-filter</code> to filter out roughly all the subject data you might need</li>
<li>Use your own Python script (possibly based on <a href="https://osmcode.org/pyosmium/">PyOsmium</a>) to do any specialized processing you need. </li>
</ol>
<p>Python code will be slower than the optimized C++ code of the Osmium command line tool, so it makes sense to do pre-filtering with the faster tool (step 2/3) and then use Python for the rest.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/79106/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>02 Mar '21, 20:46</strong>
</p>
<img alt="Jochen%20Topf's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/2d4dfcdcde73aa5e2ffa4a9b3a7cb51d?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/112/jochen-topf">Jochen Topf</a><br/>
<span class="score" title="5244 reputation points"><span class="">5.2k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="50 badges"><span class="silver">●</span><span class="badgecount">50</span></span><span title="74 badges"><span class="bronze">●</span><span class="badgecount">74</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Jochen Topf has 32 accepted answers">31%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-79106">
<a name="79110"></a>
<div class="comment" id="comment-79110">
<div class="comment-score" id="post-79110-score">1</div>
<div class="comment-text"><p>Thank you for your detailed answer. Two-follow up questions: </p>
<ol>
<li>
<p>I did some research and it seems quite difficult to install Osmium in Windows, is there a more or less straight-forward way of doing so?</p>
</li>
<li>
<p>The rectangles defining the current areas of interest are themselves generated in real-time with a Python code. Ideally I would like the code to call Osmium, do the extraction there and then recover the smaller osm file from Python. Is there a way to do this?</p>
</li>
</ol></div>
<div class="comment-info" id="comment-79110-info">
<span class="comment-age">(03 Mar '21, 07:55)</span>
<a class="comment-user userinfo" href="/users/19749/fragodec">fragodec</a>
</div>
</div>
<a name="79111"></a>
<div class="comment" id="comment-79111">
<div class="comment-score" id="post-79111-score">1</div>
<div class="comment-text"><p>to 1) No, unfortunately there isn't an easy way to install Osmium on Windows. You might be able to use WSL for this.</p>
<p>to 2) There is no special way for doing this, but you can run any program from Python with <code>os.system()</code>, so you can just build the right command line and run Osmium from it. You can run <code>osmium extract</code> with a bounding box on the command line or use a config file with many bounding boxes in it to efficiently create many extracts. So in your case it might make sense to create that config file from your Python script and then run <code>osmium extract</code> once.</p></div>
<div class="comment-info" id="comment-79111-info">
<span class="comment-age">(03 Mar '21, 08:33)</span>
<a class="comment-user userinfo" href="/users/112/jochen-topf">Jochen Topf</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-79106">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-79106-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/79104/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="vkLh2YG3u8TihjaDGrQBORZ0ISAkgT4x"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>