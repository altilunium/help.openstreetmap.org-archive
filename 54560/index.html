<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/54560/slow-generation-of-tiles-for-whole-europe">Slow generation of tiles for whole Europe</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/54560/up/" id="post-54560-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-54560-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/54560/down/" id="post-54560-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/54560/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi! I am using generate_tiles.py script to generate tiles but it is taking awfully long time for whole Europe. It was generating tiles really fast for just one town, but whole Europe seems to be taking forever. Basicaly I followed this tutorial: 
<a href="http://openstreetmapserverwindows.blogspot.ie/2015/11/osmopenstreetmap-tile-server.html">http://openstreetmapserverwindows.blogspot.ie/2015/11/osmopenstreetmap-tile-server.html</a>
to set up everything on Windows Server 2012 64-bit and we made it. Importing whole Europe from
<a href="http://download.geofabrik.de/">http://download.geofabrik.de/</a>
took 15 days (wow!) probably because we have HDD instead of SSD disk on our server. Our processor is Xenon 3.5 GHz and 32 GB RAM. I started generate_tiles.py 10 minutes ago for zoom level (3-16) 10 minutes ago and I got <em>only</em> 135 tiles so far ;-( (it is processing zoom level 6 now...). This is terribly slooow. How can we speed up this process so that we get all tiles for zoom level (3-16) in at least 1 month? :-) This is serious question. </p>
<p>Looking in Windows "Resource Monitor" I see 4 postgres.exe processes reading data with average speed between ~ 500 and ~ 2500 B/s - isn't this terribly slow ? Maybe we should tweak Postgres to speed it up ?</p>
<p>I can provide further technical details and settings I used in files if needed. Thank you. </p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-windows" href="/tags/windows/" rel="tag" title="see questions tagged 'windows'">windows</a>
<a class="post-tag tag-link-generate_tiles" href="/tags/generate_tiles/" rel="tag" title="see questions tagged 'generate_tiles'">generate_tiles</a>
<a class="post-tag tag-link-slow" href="/tags/slow/" rel="tag" title="see questions tagged 'slow'">slow</a>
<a class="post-tag tag-link-osm2pgsql" href="/tags/osm2pgsql/" rel="tag" title="see questions tagged 'osm2pgsql'">osm2pgsql</a>
<a class="post-tag tag-link-mapnik" href="/tags/mapnik/" rel="tag" title="see questions tagged 'mapnik'">mapnik</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>08 Feb '17, 23:05</strong>
</p>
<img alt="Koles500's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/f98ed179efe75af596090a497cefeb90?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/13229/koles500">Koles500</a><br/>
<span class="score" title="68 reputation points">68</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Koles500 has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/54560/">
                edited
                <strong>08 Feb '17, 23:10</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-54560">
</div>
<div class="comment-tools" id="comment-tools-54560">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-54560-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/54560/slow-generation-of-tiles-for-whole-europe?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/54560/slow-generation-of-tiles-for-whole-europe?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/54560/slow-generation-of-tiles-for-whole-europe?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/54560/slow-generation-of-tiles-for-whole-europe?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="54561"></a>
<div class="answer" id="answer-container-54561">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/54561/up/" id="post-54561-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-54561-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/54561/down/" id="post-54561-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The style your using should provide recommendations for partial indexes. Beyond that, general PostgreSQL tuning is applicable, mainly work_mem. <a href="https://www.geofabrik.de/media/2012-09-08-osm2pgsql-performance.pdf">https://www.geofabrik.de/media/2012-09-08-osm2pgsql-performance.pdf</a> has some recommendations, but mainly as they apply to importing, and for an older PostgreSQL version.</p>
<p>Most styles are slowest per tile at low zooms, particularly zoom 6-9.</p>
<p>If you are using <a href="https://svn.openstreetmap.org/applications/rendering/mapnik/generate_tiles.py">https://svn.openstreetmap.org/applications/rendering/mapnik/generate_tiles.py</a> you need to adjust the default NUM_THREADS to reflect your CPU. Unfortunately, generate_tiles.py generates tiles one by one instead of rendering a larger area and cutting the image to size like mod_tile. This probably makes it 4 to 16 times slower than mod_tile.</p>
<p>Pre-rendering to zoom 16 isn't practical with most styles. The OSMF rendering servers pre-render to zoom 12, and this takes about a day. Each zoom has 4x the number of tiles, so you're looking at about 300x as many tiles as zoom 12.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/54561/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>09 Feb '17, 00:21</strong>
</p>
<img alt="pnorman's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/5634c46072077e10f5b7c0da9b4bbb62?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/290/pnorman">pnorman</a><br/>
<span class="score" title="2352 reputation points"><span class="">2.4k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="21 badges"><span class="silver">●</span><span class="badgecount">21</span></span><span title="40 badges"><span class="bronze">●</span><span class="badgecount">40</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="pnorman has 9 accepted answers">18%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-54561">
</div>
<div class="comment-tools" id="comment-tools-54561">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-54561-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="54568"></a>
<div class="answer answered-by-owner" id="answer-container-54568">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/54568/up/" id="post-54568-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-54568-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/54568/down/" id="post-54568-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>OK, nevermind. I noticed there is generate_tiles_multiprocess.py script , I changed NUM_THREADS to 8 and used and it generated half million tiles over the night already :-) It is processing zoom level 12 now, so I think it should be done over next few days.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/54568/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>09 Feb '17, 13:58</strong>
</p>
<img alt="Koles500's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/f98ed179efe75af596090a497cefeb90?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/13229/koles500">Koles500</a><br/>
<span class="score" title="68 reputation points">68</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Koles500 has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-54568">
</div>
<div class="comment-tools" id="comment-tools-54568">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-54568-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/54560/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="j11jfQ3512tUniWScvaJHUoFsIvaDOYR"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>