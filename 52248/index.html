<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/52248/duplicate-key-value-violates-unique-constraint-users_display_name_idx">duplicate key value violates unique constraint "users_display_name_idx"</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/52248/up/" id="post-52248-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-52248-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/52248/down/" id="post-52248-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/52248/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>When i use the latest osmosis to import china-latest.psm.pbf into openstreetmap database, some error eccurs, it says that <strong>unable to insert user with id 3642735 into the database</strong>, <strong>duplicate key value violates unique constraint "users_display_name_idx", Key (display_name)=(Nodes&amp;Roads) already exists</strong>. I drop the openstreetmap database and re-create it before run the osmosis command, so the database is empty, but the error still appears. I also try to import other data file such as jordan-latest.osm.pbf, it runs successfully without any error. Only the china-latest.psm.pbf file can not import correctly. It confuses me serveral days and i still could not find out the solution, anyone can help me or give me some useful tips please,thank you.</p>
<p>The command line is <strong>osmosis --read-pbf planet/china-lastet.osm.pbf --write-apidb host="localhost" database="openstreetmap" user="osm" password="osm" validateSchemaVersion="no"</strong>.</p>
<p>And here is the error log:</p>
<p>Thread for task 1-read-pbf failed
org.openstreetmap.osmosis.core.OsmosisRuntimeException: Unable to insert user with id 3642735 into the database.
    at org.openstreetmap.osmosis.apidb.v0_6.impl.UserManager.insertUser(UserManager.java:143)
    at org.openstreetmap.osmosis.apidb.v0_6.impl.UserManager.addOrUpdateUser(UserManager.java:191)
    at org.openstreetmap.osmosis.apidb.v0_6.ApidbWriter.process(ApidbWriter.java:1098)
    at crosby.binary.osmosis.OsmosisBinaryParser.parseDense(OsmosisBinaryParser.java:138)
    at org.openstreetmap.osmosis.osmbinary.BinaryParser.parse(BinaryParser.java:124)
    at org.openstreetmap.osmosis.osmbinary.BinaryParser.handleBlock(BinaryParser.java:68)
    at org.openstreetmap.osmosis.osmbinary.file.FileBlock.process(FileBlock.java:135)
    at org.openstreetmap.osmosis.osmbinary.file.BlockInputStream.process(BlockInputStream.java:34)
    at crosby.binary.osmosis.OsmosisReader.run(OsmosisReader.java:45)
    at java.lang.Thread.run(Thread.java:745)
Caused by: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "users_display_name_idx"
  详细：Key (display_name)=(Nodes&amp;Roads) already exists.
    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2157)
    at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1886)
    at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:255)
    at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:555)
    at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:417)
    at org.postgresql.jdbc2.AbstractJdbc2Statement.executeUpdate(AbstractJdbc2Statement.java:363)
    at org.openstreetmap.osmosis.apidb.v0_6.impl.UserManager.insertUser(UserManager.java:140)
    ... 9 more</p>
<p>九月 28, 2016 10:04:30 上午 org.openstreetmap.osmosis.core.Osmosis main
严重: Execution aborted.
org.openstreetmap.osmosis.core.OsmosisRuntimeException: One or more tasks failed.
    at org.openstreetmap.osmosis.core.pipeline.common.Pipeline.waitForCompletion(Pipeline.java:146)
    at org.openstreetmap.osmosis.core.Osmosis.run(Osmosis.java:92)
    at org.openstreetmap.osmosis.core.Osmosis.main(Osmosis.java:37)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.codehaus.plexus.classworlds.launcher.Launcher.launchStandard(Launcher.java:328)
    at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:238)
    at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:408)
    at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:351)
    at org.codehaus.classworlds.Launcher.main(Launcher.java:31)</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-apidb" href="/tags/apidb/" rel="tag" title="see questions tagged 'apidb'">apidb</a>
<a class="post-tag tag-link-osmosis" href="/tags/osmosis/" rel="tag" title="see questions tagged 'osmosis'">osmosis</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>27 Sep '16, 15:36</strong>
</p>
<img alt="yuyy's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/3522efac952d508cf251cd2590e68ca5?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/12524/yuyy">yuyy</a><br/>
<span class="score" title="236 reputation points">236</span><span title="22 badges"><span class="badge1">●</span><span class="badgecount">22</span></span><span title="24 badges"><span class="silver">●</span><span class="badgecount">24</span></span><span title="31 badges"><span class="bronze">●</span><span class="badgecount">31</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="yuyy has one accepted answer">20%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/52248/">
                edited
                <strong>28 Sep '16, 03:05</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-52248">
<a name="52257"></a>
<div class="comment" id="comment-52257">
<div class="comment-score" id="post-52257-score"></div>
<div class="comment-text"><p>I assume you are using a download from geofabrik. </p>
<p>The error doesn't ring a bell. Can you give us the complete command line you are using an the complete error log (right now I would suspect a character encoding or similar error).</p></div>
<div class="comment-info" id="comment-52257-info">
<span class="comment-age">(27 Sep '16, 23:54)</span>
<a class="comment-user userinfo" href="/users/2053/simonpoole">SimonPoole ♦</a>
</div>
</div>
<a name="52266"></a>
<div class="comment" id="comment-52266">
<div class="comment-score" id="post-52266-score">1</div>
<div class="comment-text"><p>Please never add what should be a comment as an answer and then edit it. That makes it impossible to rearrange questions and comments as they should be.</p>
<p>Back to the question: this looks like an issue somewhere in the API code or the data dumper or on the extract side as this "should not happen".</p>
<p>We've checked and it seems to be a specific issue with the extract you are using. See answer below.</p></div>
<div class="comment-info" id="comment-52266-info">
<span class="comment-age">(28 Sep '16, 09:48)</span>
<a class="comment-user userinfo" href="/users/2053/simonpoole">SimonPoole ♦</a>
</div>
</div>
<a name="52267"></a>
<div class="comment" id="comment-52267">
<div class="comment-score" id="post-52267-score"></div>
<div class="comment-text"><p>Thanks to your reply, i will be more careful next time.</p></div>
<div class="comment-info" id="comment-52267-info">
<span class="comment-age">(28 Sep '16, 09:58)</span>
<a class="comment-user userinfo" href="/users/12524/yuyy">yuyy</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-52248">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-52248-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/52248/duplicate-key-value-violates-unique-constraint-users_display_name_idx?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/52248/duplicate-key-value-violates-unique-constraint-users_display_name_idx?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/52248/duplicate-key-value-violates-unique-constraint-users_display_name_idx?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/52248/duplicate-key-value-violates-unique-constraint-users_display_name_idx?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="52268"></a>
<div class="answer accepted-answer" id="answer-container-52268">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/52268/up/" id="post-52268-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-52268-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/52268/down/" id="post-52268-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/52268/" rel="nofollow" title="yuyy has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The extracts from Geofabrik are kept up to date by applying diffs, as a consequence when a contributor changes their display name this is not propagated to all the data contributed in the extract.</p>
<p>Or put differently: you cannot use Geofabrik extracts to populate an API database with osmosis except if you are very lucky, which you are not.</p>
<p>I would suggest checking with mapzen <a href="https://mapzen.com/data/metro-extracts/">https://mapzen.com/data/metro-extracts/</a> or another provider of extracts if they generate them differently.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/52268/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>28 Sep '16, 10:06</strong>
</p>
<img alt="SimonPoole's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/ad2513d6f8e3d709d576ace900c12fa5?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2053/simonpoole">SimonPoole ♦</a><br/>
<span class="score" title="44667 reputation points"><span class="">44.7k</span></span><span title="13 badges"><span class="badge1">●</span><span class="badgecount">13</span></span><span title="326 badges"><span class="silver">●</span><span class="badgecount">326</span></span><span title="701 badges"><span class="bronze">●</span><span class="badgecount">701</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="SimonPoole has 209 accepted answers">18%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/52268/">
                edited
                <strong>28 Sep '16, 10:08</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-52268">
</div>
<div class="comment-tools" id="comment-tools-52268">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-52268-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="52265"></a>
<div class="answer answered-by-owner" id="answer-container-52265">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/52265/up/" id="post-52265-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-52265-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/52265/down/" id="post-52265-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I transformed the china-latest.osm.pbf into .osc file, and i find that there are two different user_id use the same display_name, one is :</p>
<p>&lt;node id="221454099" version="4" timestamp="2016-02-19T01:31:31Z" uid="1708958" user="Nodes&amp;amp;Roads" changeset="37300193" lat="28.5580746" lon="98.4585189"/&gt;</p>
<p>Another is :</p>
<p>&lt;node id="224205729" version="3" timestamp="2016-02-20T00:02:20Z" uid="3642735" user="Nodes&amp;amp;Roads" changeset="37320893" lat="28.0394804" lon="99.5276968"/&gt;</p>
<p>Maybe we can change one of the display_name in the .osc file to solve the problem. But if i want use the .pbf file, what should i do? I don't know how to edit the .pbf file, i also asked another question <a href="https://help.openstreetmap.org/questions/52262/two-user_id-use-the-same-display_name-in-the-pbf-data-file">here</a>. If someone have some ideal, please answer <a href="https://help.openstreetmap.org/questions/52262/two-user_id-use-the-same-display_name-in-the-pbf-data-file">here</a>.  </p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/52265/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>28 Sep '16, 08:58</strong>
</p>
<img alt="yuyy's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/3522efac952d508cf251cd2590e68ca5?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/12524/yuyy">yuyy</a><br/>
<span class="score" title="236 reputation points">236</span><span title="22 badges"><span class="badge1">●</span><span class="badgecount">22</span></span><span title="24 badges"><span class="silver">●</span><span class="badgecount">24</span></span><span title="31 badges"><span class="bronze">●</span><span class="badgecount">31</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="yuyy has one accepted answer">20%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/52265/">
                edited
                <strong>28 Sep '16, 08:59</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-52265">
</div>
<div class="comment-tools" id="comment-tools-52265">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-52265-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/52248/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="JA7Sxuy24zC4O0NOtzbhMyakHWv5mavv"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>