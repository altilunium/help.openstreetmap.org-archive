<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/53527/how-to-query-osm-apis-and-polygonsopenstreetmapfr-properly">How to query OSM APIs and 'polygons.openstreetmap.fr' properly?</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/53527/up/" id="post-53527-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-53527-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/53527/down/" id="post-53527-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/53527/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi, I'm pretty new to OSM.  I'm working on web application in WebGL, and I have 2 major questions:</p>
<ol>
<li>
<p>I would like to know how to correctly query for city boundaries polygon. I've tried to use JSONP and http.get requests to get data form 'http://polygons.openstreetmap.fr/get_geojson.py?id=1582777' but i cant get it, because of CORS policy. This server seems to be JSONP disabled. Does any other kind of similar API exists?</p>
</li>
<li>
<p>To get proper relations of my address i'm querying 'nominatim.openstreetmap.org' multiple times, every time constructing new url. Query for address to get city, city to get country, etc. This works but feels really tiresome. How do I query nominatim, knowing street address and getting all info that I need (city, country, continent) ?</p>
</li>
</ol>
<p>Can you give me some hints?</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-usage" href="/tags/usage/" rel="tag" title="see questions tagged 'usage'">usage</a>
<a class="post-tag tag-link-query" href="/tags/query/" rel="tag" title="see questions tagged 'query'">query</a>
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-polygon" href="/tags/polygon/" rel="tag" title="see questions tagged 'polygon'">polygon</a>
<a class="post-tag tag-link-multipolygon" href="/tags/multipolygon/" rel="tag" title="see questions tagged 'multipolygon'">multipolygon</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>13 Dec '16, 09:53</strong>
</p>
<img alt="Treant's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/f417f1f6d3a7f0ab65f2c0e0db5a974f?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/13082/treant">Treant</a><br/>
<span class="score" title="26 reputation points">26</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="Treant has no accepted answers">0%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/53527/">
                edited
                <strong>14 Dec '16, 22:54</strong>
</a>
</p>
<img alt="aseerel4c26's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/66f0dc05b44574e3894be07b0b37cf37?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/5179/aseerel4c26">aseerel4c26 ♦</a><br/>
<span class="score" title="32615 reputation points"><span class="">32.6k</span></span><span title="18 badges"><span class="badge1">●</span><span class="badgecount">18</span></span><span title="248 badges"><span class="silver">●</span><span class="badgecount">248</span></span><span title="554 badges"><span class="bronze">●</span><span class="badgecount">554</span></span></p>
</div>
</div>
<div class="comments-container" id="comments-container-53527">
<a name="53533"></a>
<div class="comment" id="comment-53533">
<div class="comment-score" id="post-53533-score">2</div>
<div class="comment-text"><p>cross-posted: <a href="https://gis.stackexchange.com/questions/221219/proper-query-of-osm-apis">https://gis.stackexchange.com/questions/221219/proper-query-of-osm-apis</a></p></div>
<div class="comment-info" id="comment-53533-info">
<span class="comment-age">(13 Dec '16, 11:42)</span>
<a class="comment-user userinfo" href="/users/158/scai">scai ♦</a>
</div>
</div>
<a name="53538"></a>
<div class="comment" id="comment-53538">
<div class="comment-score" id="post-53538-score"></div>
<div class="comment-text"><p>Can you give examples of the Nominatim queries/URLs you're currently using?</p></div>
<div class="comment-info" id="comment-53538-info">
<span class="comment-age">(13 Dec '16, 15:25)</span>
<a class="comment-user userinfo" href="/users/150/mtmail">mtmail</a>
</div>
</div>
<a name="53549"></a>
<div class="comment" id="comment-53549">
<div class="comment-score" id="post-53549-score"></div>
<div class="comment-text"><p><a href="http://help.openstreetmap.org/users/150/mtmail">@mtmail</a> </p>
<p>I'm starting with osm_id and lonlat</p>
<p>Getting city name  -&gt;  from osm_id and lonlat:
<a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=51.7728321&amp;lon=19.4528033&amp;osm_id=246291409&amp;accept-language=en">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=51.7728321&amp;lon=19.4528033&amp;osm_id=246291409&amp;accept-language=en</a></p>
<p>Getting relation  -&gt;   from city name:
<a href="https://nominatim.openstreetmap.org/search.php?city=Łódź&amp;format=json">https://nominatim.openstreetmap.org/search.php?city=Łódź&amp;format=json</a></p>
<p>Getting polygon   -&gt;  from relation
<a href="http://polygons.openstreetmap.fr/get_geojson.py?id=1582777">http://polygons.openstreetmap.fr/get_geojson.py?id=1582777</a></p>
<p>I only have osm_id and lonlat available and I must query for city, relation, country, continent and so on. Can I do it with one url?</p></div>
<div class="comment-info" id="comment-53549-info">
<span class="comment-age">(14 Dec '16, 13:58)</span>
<a class="comment-user userinfo" href="/users/13082/treant">Treant</a>
</div>
</div>
<a name="53550"></a>
<div class="comment" id="comment-53550">
<div class="comment-score" id="post-53550-score">2</div>
<div class="comment-text"><p>Cross-posted again <a href="https://forum.openstreetmap.org/viewtopic.php?pid=622337#p622337">https://forum.openstreetmap.org/viewtopic.php?pid=622337#p622337</a> .</p></div>
<div class="comment-info" id="comment-53550-info">
<span class="comment-age">(14 Dec '16, 14:38)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-53527">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-53527-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/53527/how-to-query-osm-apis-and-polygonsopenstreetmapfr-properly?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/53527/how-to-query-osm-apis-and-polygonsopenstreetmapfr-properly?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/53527/how-to-query-osm-apis-and-polygonsopenstreetmapfr-properly?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/53527/how-to-query-osm-apis-and-polygonsopenstreetmapfr-properly?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="53552"></a>
<div class="answer accepted-answer" id="answer-container-53552">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/53552/up/" id="post-53552-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-53552-score" title="current number of votes">
    4
</div>
<a class="ajax-command post-vote down" href="/vote/53552/down/" id="post-53552-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/53552/" rel="nofollow" title="Treant has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The <code>osm_id</code> of your initial search seems to be a street <a href="http://www.openstreetmap.org/way/246291409">http://www.openstreetmap.org/way/246291409</a></p>
<p>To look up the hierarchy starting from the street to the country try <a href="http://nominatim.openstreetmap.org/hierarchy.php?osmid=246291409&amp;osmtype=W">http://nominatim.openstreetmap.org/hierarchy.php?osmid=246291409&amp;osmtype=W</a>
and you need to parse the links in the first line. Then for each type and id you have to do more lookups.</p>
<p>Doing a forward search for "Łódź" is too risky as you might get the wrong place back. Searching by ids (and type N,W,R) is better.</p>
<p>OSM data doesn't contain continents.</p>
<p>The reverse search can include polygons: <a href="http://nominatim.openstreetmap.org/reverse?format=json&amp;osm_id=1582777&amp;osm_type=R&amp;polygon_geojson=1">http://nominatim.openstreetmap.org/reverse?format=json&amp;osm_id=1582777&amp;osm_type=R&amp;polygon_geojson=1</a> (for the polygon parameters see) <a href="https://wiki.openstreetmap.org/wiki/Nominatim#Parameters_2">https://wiki.openstreetmap.org/wiki/Nominatim#Parameters_2</a></p>
<p>State and country polygons can become large (several megabytes). In this case set &amp;polygon_threshold to a value between 0 and 1 to simplify the polygon in the result. 0.1 is usually a good compromise.</p>
<p>The public Nominatim service has a usage policy (<a href="https://wiki.openstreetmap.org/wiki/Nominatim_usage_policy).">https://wiki.openstreetmap.org/wiki/Nominatim_usage_policy).</a> Both polygon search, especially with large polygons and the hierarchy lookup are "expensive" (take more server resources than usual queries). If you crawl whole countries you will get blocked. If you send requests too fast you will get blocked. If your goal is to create a website for (paying?) customers and require high availability real-time results you should setup your own Nominatim server.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/53552/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>14 Dec '16, 17:23</strong>
</p>
<img alt="mtmail's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/96aad1e1801b7ea36fba50687924c935?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/150/mtmail">mtmail</a><br/>
<span class="score" title="4757 reputation points"><span class="">4.8k</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="74 badges"><span class="bronze">●</span><span class="badgecount">74</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="mtmail has 50 accepted answers">27%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-53552">
<a name="53606"></a>
<div class="comment" id="comment-53606">
<div class="comment-score" id="post-53606-score">1</div>
<div class="comment-text"><p>Thanks for your help, this pretty much solves it.</p></div>
<div class="comment-info" id="comment-53606-info">
<span class="comment-age">(19 Dec '16, 08:30)</span>
<a class="comment-user userinfo" href="/users/13082/treant">Treant</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-53552">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-53552-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/53527/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="KTwRJ07Z1CQnI4PZCNrXB4DKFwsBASPD"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>