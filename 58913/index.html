<meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../style.css"><div id="CALeft">
<div class="headNormal">
<h1><a href="/questions/58913/mapnik-svg-output-not-working">Mapnik: SVG output not working</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/58913/up/" id="post-58913-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-58913-score" title="current number of votes">
    2
</div>
<a class="ajax-command post-vote down" href="/vote/58913/down/" id="post-58913-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/58913/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
   1
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>I want to generate SVG maps in Python using Mapnik 3.0.13 (built from source). I'm using version 3.0.13 of the Python bindings as well, built with PYCAIRO. My code:</p>
<pre><code>f = open('/tmp/test.svg', 'w')
surface = cairo.SVGSurface(f.name, map.width, map.height)
mapnik.render(map, surface)
surface.finish()
</code></pre>
<p>The output SVG file looks like this:</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="4961pt" height="3508pt" viewBox="0 0 4961 3508" version="1.1"&gt;
&lt;defs&gt;
&lt;image id="image3198" width="20671" height="14617" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAUL8A ...
</code></pre>
<p>Followed by ~200 MB of base64-encoded PNG garbage.</p>
<p>I tried recompiling my library and bindings to use the native svg_renderer instead of Cairo, but got the same result.</p>
<p>How do I get a "real" SVG? This is just a PNG file wrapped inside an SVG (in an extremely inefficient way).</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-python" href="/tags/python/" rel="tag" title="see questions tagged 'python'">python</a>
<a class="post-tag tag-link-svg" href="/tags/svg/" rel="tag" title="see questions tagged 'svg'">svg</a>
<a class="post-tag tag-link-mapnik" href="/tags/mapnik/" rel="tag" title="see questions tagged 'mapnik'">mapnik</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>01 Sep '17, 17:44</strong>
</p>
<img alt="derkartograf's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/2380c889f144fa299eccba2983a60826?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/14150/derkartograf">derkartograf</a><br/>
<span class="score" title="81 reputation points">81</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="derkartograf has one accepted answer">100%</span>
</p>
</div>
<div class="post-update-info post-update-info-edited">
<p style="line-height:12px;">
<a href="/revisions/58913/">
                edited
                <strong>01 Sep '17, 17:51</strong>
</a>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-58913">
<a name="58978"></a>
<div class="comment" id="comment-58978">
<div class="comment-score" id="post-58978-score"></div>
<div class="comment-text"><p>I have the same issue. PDF export works properly though (outputs a vector PDF)</p></div>
<div class="comment-info" id="comment-58978-info">
<span class="comment-age">(05 Sep '17, 10:48)</span>
<a class="comment-user userinfo" href="/users/14170/knowname">knowname</a>
</div>
</div>
<a name="58979"></a>
<div class="comment" id="comment-58979">
<div class="comment-score" id="post-58979-score"></div>
<div class="comment-text"><p>See <a href="https://github.com/mapnik/python-mapnik/issues/137">https://github.com/mapnik/python-mapnik/issues/137</a> - this appears to be a Mapnik issue.</p></div>
<div class="comment-info" id="comment-58979-info">
<span class="comment-age">(05 Sep '17, 11:08)</span>
<a class="comment-user userinfo" href="/users/5/richard">Richard ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-58913">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-58913-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    2 Answers:
                    </div>
<div class="tabsA"><a href="/questions/58913/mapnik-svg-output-not-working?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/58913/mapnik-svg-output-not-working?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/58913/mapnik-svg-output-not-working?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/58913/mapnik-svg-output-not-working?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="58980"></a>
<div class="answer accepted-answer answered-by-owner" id="answer-container-58980">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/58980/up/" id="post-58980-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-58980-score" title="current number of votes">
    1
</div>
<a class="ajax-command post-vote down" href="/vote/58980/down/" id="post-58980-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/58980/" rel="nofollow" title="SomeoneElse has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>I created a Mapnik issue for this:
<a href="https://github.com/mapnik/mapnik/issues/3749">https://github.com/mapnik/mapnik/issues/3749</a></p>
<p>Turns out this happens when your style uses compositing operations like <code>comp-op="multiply"</code>. These lead to rasterization of the map.</p>
<p>Removing all <code>comp-op</code> filters produces a "real" SVG. Alternatively, PDF output works as mentioned by <a href="https://help.openstreetmap.org/users/14170/knowname">@knowname</a> above.</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/58980/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>05 Sep '17, 11:15</strong>
</p>
<img alt="derkartograf's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/2380c889f144fa299eccba2983a60826?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/14150/derkartograf">derkartograf</a><br/>
<span class="score" title="81 reputation points">81</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="derkartograf has one accepted answer">100%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-58980">
<a name="58990"></a>
<div class="comment" id="comment-58990">
<div class="comment-score" id="post-58990-score"></div>
<div class="comment-text"><p>I've accepted your answer here - hope that's OK!</p></div>
<div class="comment-info" id="comment-58990-info">
<span class="comment-age">(05 Sep '17, 13:01)</span>
<a class="comment-user userinfo" href="/users/387/someoneelse">SomeoneElse ♦</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-58980">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-58980-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<a name="67970"></a>
<div class="answer" id="answer-container-67970">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/67970/up/" id="post-67970-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-67970-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/67970/down/" id="post-67970-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The problem has been found to be something with SVG version support. You can build Mapnik with this patch applied:</p>
<p><a href="https://github.com/mapnik/mapnik/pull/4029#issue-251451960">https://github.com/mapnik/mapnik/pull/4029#issue-251451960</a></p>
<p>or just use python-cairo with a code like:</p>
<p><code>surface.restrict_to_version(cairo.SVG_VERSION_1_2)</code></p>
<p>See also <a href="https://help.openstreetmap.org/questions/65497/is-there-any-change-in-svg-exports/67940">https://help.openstreetmap.org/questions/65497/is-there-any-change-in-svg-exports/67940</a></p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/67970/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>11 Feb '19, 23:41</strong>
</p>
<img alt="kocio's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/e228dd20b7da2a6c8f559e2118ce08d3?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/11332/kocio">kocio</a><br/>
<span class="score" title="2054 reputation points"><span class="">2.1k</span></span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="23 badges"><span class="silver">●</span><span class="badgecount">23</span></span><span title="41 badges"><span class="bronze">●</span><span class="badgecount">41</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="kocio has 14 accepted answers">20%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-67970">
</div>
<div class="comment-tools" id="comment-tools-67970">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-67970-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/58913/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="kbj73fTZFMbcJGNP15JbW4YL3L6GT1Kv"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>