<meta charset="utf-8"/><link href="../style.css" rel="stylesheet" type="text/css"/><div id="CALeft"><center><a href="../"><img id="ll" src="https://help.openstreetmap.org/upfiles/osm_help_logo_6.png"/></a></center>
<div class="headNormal">
<h1><a href="/questions/31439/state-is-missing-in-reverse-geocoding">state is missing in reverse geocoding</a></h1>
</div>
<div class="" id="main-body">
<div id="askform">
<table id="question-table" style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/31439/up/" id="post-31439-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-31439-score" title="current number of votes">
    0
</div>
<a class="ajax-command post-vote down" href="/vote/31439/down/" id="post-31439-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="ajax-command favorite-mark" href="/mark_favorite/31439/" id="favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </a>
<div class="favorite-count" id="favorite-count">
</div>
</div>
</td>
<td>
<div id="item-right">
<div class="question-body">
<p>Hi,</p>
<p>I installed a local Nominatim server, including TIGER data.</p>
<p>In some reverse-geocoding queries for locations in the US, I'm not getting back the state. </p>
<p>For example, for the following query, I get a similar result on my local server, minus the state:</p>
<p><a href="http://nominatim.openstreetmap.org/reverse?lat=25.760901249584499&amp;lon=-80.145328467942463">http://nominatim.openstreetmap.org/reverse?lat=25.760901249584499&amp;lon=-80.145328467942463</a></p>
<p>Does anyone know what could be the reason for this?</p>
<p>Thanks,
Raz</p>
</div>
<div class="tags-container tags" id="question-tags">
<a class="post-tag tag-link-reversegeocoding" href="/tags/reversegeocoding/" rel="tag" title="see questions tagged 'reversegeocoding'">reversegeocoding</a>
<a class="post-tag tag-link-reversegeolocation" href="/tags/reversegeolocation/" rel="tag" title="see questions tagged 'reversegeolocation'">reversegeolocation</a>
<a class="post-tag tag-link-nominatim" href="/tags/nominatim/" rel="tag" title="see questions tagged 'nominatim'">nominatim</a>
<a class="post-tag tag-link-state" href="/tags/state/" rel="tag" title="see questions tagged 'state'">state</a>
</div>
<div class="post-controls" id="question-controls">
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        asked
        <strong>11 Mar '14, 09:45</strong>
</p>
<img alt="RazAlon's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/84ebb95a07dd884e34f0170b07b1d652?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/8079/razalon">RazAlon</a><br/>
<span class="score" title="61 reputation points">61</span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="9 badges"><span class="silver">●</span><span class="badgecount">9</span></span><span title="14 badges"><span class="bronze">●</span><span class="badgecount">14</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="RazAlon has no accepted answers">0%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-31439">
<a name="31443"></a>
<div class="comment" id="comment-31443">
<div class="comment-score" id="post-31443-score">2</div>
<div class="comment-text"><p>Did you import the entire planet or a US extract only?</p></div>
<div class="comment-info" id="comment-31443-info">
<span class="comment-age">(11 Mar '14, 12:48)</span>
<a class="comment-user userinfo" href="/users/2921/lonvia">lonvia</a>
</div>
</div>
<a name="31444"></a>
<div class="comment" id="comment-31444">
<div class="comment-score" id="post-31444-score">1</div>
<div class="comment-text"><p>the entire planet, the file is from early January 2014</p></div>
<div class="comment-info" id="comment-31444-info">
<span class="comment-age">(11 Mar '14, 13:46)</span>
<a class="comment-user userinfo" href="/users/8079/razalon">RazAlon</a>
</div>
</div>
<a name="68604"></a>
<div class="comment" id="comment-68604">
<div class="comment-score" id="post-68604-score"></div>
<div class="comment-text"><p><a href="https://help.openstreetmap.org/users/2921/lonvia">@lonvia</a> does it matter whether one import the whole planet or only a particular country please? I'm struggling with same problem</p></div>
<div class="comment-info" id="comment-68604-info">
<span class="comment-age">(02 Apr '19, 10:05)</span>
<a class="comment-user userinfo" href="/users/16479/yura">Yura</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-31439">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-31439-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
<hr/>
<div class="tabBar">
<a name="sort-top"></a>
<div class="headQuestions">
                    One Answer:
                    </div>
<div class="tabsA"><a href="/questions/31439/state-is-missing-in-reverse-geocoding?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/31439/state-is-missing-in-reverse-geocoding?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/31439/state-is-missing-in-reverse-geocoding?sort=newest" title="newest answers will be shown first">newest answers</a><a class="on" href="/questions/31439/state-is-missing-in-reverse-geocoding?sort=votes" title="most voted answers will be shown first">popular answers</a></div>
</div>
<a name="31462"></a>
<div class="answer accepted-answer" id="answer-container-31462">
<table style="width:100%;">
<tr>
<td style="width:30px;vertical-align:top">
<div class="vote-buttons">
<a class="ajax-command post-vote up" href="/vote/31462/up/" id="post-31462-upvote" rel="nofollow" title="I like this post (click again to cancel)"> </a>
<div class="post-score" id="post-31462-score" title="current number of votes">
    3
</div>
<a class="ajax-command post-vote down" href="/vote/31462/down/" id="post-31462-downvote" rel="nofollow" title="I dont like this post (click again to cancel)"> </a>
<a class="accept-answer on" href="/accept_answer/31462/" rel="nofollow" title="RazAlon has selected this answer as the correct answer">
</a>
</div>
</td>
<td>
<div class="item-right">
<div class="answer-body">
<p>The Florida relation was broken in early January. It has been fixed in the meantime but you still caught the bad version with your import, so the boundary for Florida is missing. Here is a way to update your database for such broken objects without a reimport:</p>
<ol>
<li>
<p>Import the latest version of the object in question. You need to find the OSM type and id of the object, for example by searching on osm.org. Florida is <a href="http://www.openstreetmap.org/relation/162050">here</a>. For the import, the update script can be used, i.e</p>
<pre><code>./utils/update.php --import-relation 162050 --index
</code></pre>
</li>
<li>
<p>Check that the import worked by searching for the object in your local instance. If it didn't work, the object might still be broken and you have to fix it in OSM first. Find out the place_id of the object by looking up details in your instance. For example, Florida on the osm.org instance is <a href="http://nominatim.openstreetmap.org/details.php?place_id=97976186">here</a>, so the place_id is 97976186. The ids are different for every instance.</p>
</li>
<li>
<p>Update any places in your database that depend on the object, e.g. for Florida again:</p>
<pre><code> psql -d nominatim -c 'select place_force_update(97976186)'
 ./utils/update.php --index --index-instances 2
</code></pre>
<p>Be warned that this may take a long time for an area as large as Florida.</p>
</li>
</ol>
<p>If you run updates on your database, (1) will happen automatically. Dependent places, however, will not be updated for larger areas for performance reasons, so you may still want to do (2) and (3).</p>
</div>
<div class="answer-controls post-controls">
<span class="action-link"><a class="ajax-command withprompt copy" href="/answer_link/31462/" rel="nofollow" title="answer permanent link">permanent link</a></span>
</div>
<div class="post-update-info-container">
<div class="post-update-info post-update-info-user">
<p style="line-height:12px;">
        answered
        <strong>11 Mar '14, 22:50</strong>
</p>
<img alt="lonvia's gravatar image" class="gravatar" height="32" src="https://secure.gravatar.com/avatar/d888b712d85dee0aa304297f2dc697c7?s=32&amp;d=identicon&amp;r=g" width="32"/>
<p><a href="/users/2921/lonvia">lonvia</a><br/>
<span class="score" title="6213 reputation points"><span class="">6.2k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="89 badges"><span class="bronze">●</span><span class="badgecount">89</span></span><br/>
<span class="accept_rate" title="Rate of the user's accepted answers">accept rate:</span>
<span title="lonvia has 43 accepted answers">40%</span>
</p>
</div>
</div>
<div class="comments-container" id="comments-container-31462">
<a name="31472"></a>
<div class="comment" id="comment-31472">
<div class="comment-score" id="post-31472-score">1</div>
<div class="comment-text"><p>Thank you, that explains about 93% of my missing states. I do see the same problem in other states too, for example Kansas:</p>
<p><a href="http://nominatim.openstreetmap.org/reverse?lat=39.062966597302903&amp;lon=-94.608148997737700">http://nominatim.openstreetmap.org/reverse?lat=39.062966597302903&amp;lon=-94.608148997737700</a></p>
<p>Are there any other general known problems?
Thanks,
Raz</p></div>
<div class="comment-info" id="comment-31472-info">
<span class="comment-age">(12 Mar '14, 09:19)</span>
<a class="comment-user userinfo" href="/users/8079/razalon">RazAlon</a>
</div>
</div>
<a name="31474"></a>
<div class="comment" id="comment-31474">
<div class="comment-score" id="post-31474-score">2</div>
<div class="comment-text"><p>The Kansas example is a road that goes over the state boundary and clearly has a problem with that (after reindexing, it's visible on osm.org, too). That is a bug worth reporting.</p></div>
<div class="comment-info" id="comment-31474-info">
<span class="comment-age">(12 Mar '14, 09:44)</span>
<a class="comment-user userinfo" href="/users/2921/lonvia">lonvia</a>
</div>
</div>
<a name="31775"></a>
<div class="comment" id="comment-31775">
<div class="comment-score" id="post-31775-score"></div>
<div class="comment-text"><p>thanks, I reported it on github</p></div>
<div class="comment-info" id="comment-31775-info">
<span class="comment-age">(23 Mar '14, 10:52)</span>
<a class="comment-user userinfo" href="/users/8079/razalon">RazAlon</a>
</div>
</div>
</div>
<div class="comment-tools" id="comment-tools-31462">
</div>
<div class="clear"></div>
<div class="comment-form-container" id="comment-31462-form-container">
</div>
<div class="clear"></div>
</div>
</td>
</tr>
</table>
</div>
<div class="paginator-container-left">
</div>
<form action="/questions/31439/answer/" id="fmanswer" method="post">
<input name="csrfmiddlewaretoken" type="hidden" value="qMxwX08bxrJt46wDnkrirdZVlNz2c4iu"/>
<div style="clear:both">
</div>
</form>
</div>
</div>
</div>